---
title: Развертывание контейнеров в Azure
description: Развертывание контейнеров в Azure с помощью реестра контейнеров Azure, службы Kubernetes Azure и Azure Dev Spaces.
ms.date: 04/13/2020
ms.openlocfilehash: ba2854323ee0f1394a3cff0dd3756cb3c7c32d5b
ms.sourcegitcommit: 27db07ffb26f76912feefba7b884313547410db5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2020
ms.locfileid: "83614153"
---
# <a name="deploying-containers-in-azure"></a>Развертывание контейнеров в Azure

В этой главе мы обсуждали контейнеры и в главе 1. Мы увидели, что контейнеры предоставляют множество преимуществ для облачных приложений, включая переносимость. В облаке Azure вы можете развернуть одни и те же контейнерные службы в промежуточной и рабочей средах. Azure предоставляет несколько вариантов размещения этих контейнерных рабочих нагрузок:

- Службы Azure Kubernetes (AKS)
- Экземпляр контейнера Azure (ACI).
- Веб-приложения Azure для контейнеров

## <a name="azure-container-registry"></a>Реестр контейнеров Azure

Когда вы контейнеризация микрослужбу, вы сначала создаете контейнер сборки "Image". Образ является двоичным представлением кода службы, зависимостей и среды выполнения. Хотя вы можете вручную создать образ с помощью `Docker Build` команды из API DOCKER, лучшим подходом является создание его в рамках автоматизированного процесса сборки.

После создания образы контейнеров хранятся в реестрах контейнеров. Они позволяют создавать и хранить образы контейнеров, а также управлять ими. Существует множество доступных реестров, как открытых, так и закрытых. Реестр контейнеров Azure (запись контроля доступа) — это полностью управляемая служба реестра контейнеров в облаке Azure. Он сохраняет образы в сети Azure, уменьшая время на их развертывание на узлах контейнеров Azure. Их также можно защитить с помощью тех же процедур безопасности и идентификации, которые используются для других ресурсов Azure.

Реестр контейнеров Azure создается с помощью средств [портал Azure](https://docs.microsoft.com/azure/container-registry/container-registry-get-started-portal), [Azure CLI](https://docs.microsoft.com/azure/container-registry/container-registry-get-started-azure-cli)или [PowerShell](https://docs.microsoft.com/azure/container-registry/container-registry-get-started-powershell). Создание реестра в Azure выполняется просто. Для этого требуется подписка Azure, Группа ресурсов и уникальное имя. На рис. 3-11 показаны основные параметры для создания реестра, который будет размещаться в `registryname.azurecr.io` .

![Создание реестра контейнеров](./media/create-container-registry.png)

**Рис. 3-11**. Создание реестра контейнеров

После создания реестра необходимо выполнить его проверку подлинности, прежде чем его можно будет использовать. Как правило, вы входите в реестр с помощью команды Azure CLI:

```azurecli
az acr login --name *registryname*
```

После проверки подлинности можно использовать команды DOCKER для отправки в нее образов контейнеров. Однако перед тем, как это сделать, необходимо пометить образ полным именем (URL-адресом) сервера входа в систему контроля доступа. Он будет иметь формат *регистринаме*. azurecr.IO.

```console
docker tag mycontainer myregistry.azurecr.io/mycontainer:v1
```

После маркировки образа используйте `docker push` команду, чтобы передать образ в экземпляр записи контроля доступа.

```console
docker push myregistry.azurecr.io/mycontainer:v1
```

После отправки образа в реестр рекомендуется удалить образ из локальной среды DOCKER, выполнив следующую команду:

```console
docker rmi myregistry.azurecr.io/mycontainer:v1
```

Рекомендуется вручную отправлять образы в реестр контейнеров. Вместо этого этот процесс должен быть ответственным за создание конвейера сборки, определенного в средстве, например GitHub или Azure DevOps. Дополнительные сведения см. в [разделе, посвященном облаку, в машинном DevOps](devops.md).

## <a name="acr-tasks"></a>Задачи ACR

[Задачи записи контроля](https://docs.microsoft.com/azure/container-registry/container-registry-tasks-overview) доступа — это набор функций, доступных в реестре контейнеров Azure. Он расширяет [цикл разработки внутреннего цикла](https://docs.microsoft.com/dotnet/architecture/containerized-lifecycle/design-develop-containerized-apps/docker-apps-inner-loop-workflow) , создавая образы контейнеров и управляя ими в облаке Azure. Вместо того `docker build` , чтобы вызывать и `docker push` локально на компьютере разработки, они автоматически обрабатываются ЗАДАЧами контроля доступа в облаке.

Следующая команда AZ CLI строит образ контейнера и отправляет его в запись контроля доступа:

```azurecli
# create a container registry
az acr create --resource-group myResourceGroup --name myContainerRegistry008 --sku Basic

# build container image in ACR and push it into your container regsitry
az acr build --image sample/hello-world:v1  --registry myContainerRegistry008 --file Dockerfile .
```

Как видно из предыдущего блока команд, нет необходимости устанавливать на компьютер разработки приложение DOCKER Desktop. Кроме того, можно настроить триггеры задач записи контроля доступа для перестроения образов контейнеров как в исходном коде, так и в базовых обновлениях образа.

## <a name="azure-kubernetes-service"></a>Служба Azure Kubernetes

В этой главе мы обсуждали службу Azure Kubernetes Service (AKS). Мы видели, что это де-факто контейнер Orchestrator, управляющий контейнерными приложениями в машинном облаке.

После развертывания образа в реестре, например записи контроля доступа, можно настроить AKS для автоматического извлечения и развертывания. С помощью конвейера CI/CD вы можете настроить стратегию [выпуска ранний](https://martinfowler.com/bliki/CanaryRelease.html) , чтобы снизить риск, связанный с быстро развертываемыми обновлениями. Новая версия приложения изначально настраивается в рабочей среде без маршрутизации трафика. Затем система будет направлять небольшой процент пользователей на только что развернутую версию. По мере того, как группа получает уверенность в новой версии, она может развернуть больше экземпляров и прекратить старую версию. AKS легко поддерживает этот стиль развертывания.

Как и в случае с большинством ресурсов в Azure, вы можете создать кластер службы Kubernetes Azure с помощью портала, командной строки или средств автоматизации, таких как Helm или terraform. Чтобы начать работу с новым кластером, необходимо предоставить следующие сведения:

- Подписка Azure
- Группа ресурсов
- Имя кластера Kubernetes
- Регион
- Версия Kubernetes
- Префикс DNS-имени
- Размер узла
- Число узлов

Эти сведения достаточно для начала работы. В рамках процесса создания портал Azure можно также настроить параметры для следующих функций кластера:

- Масштабирование
- Аутентификация
- Сеть
- Наблюдение
- Теги

Это [Краткое руководство содержит инструкции по развертыванию кластера AKS с помощью портал Azure](https://docs.microsoft.com/azure/aks/kubernetes-walkthrough-portal).

## <a name="azure-dev-spaces"></a>Azure Dev Spaces

Облачные приложения могут быстро увеличиваться и быть сложными, что требует выполнения значительных вычислений. В этих сценариях приложение не может размещаться на компьютере разработки (особенно на ноутбуке). Azure Dev Spaces предназначен для решения этой проблемы с помощью AKS. Он позволяет разработчикам работать с локальной версией своих служб при размещении остального приложения в кластере AKS Development.

Разработчики совместно используют выполняющийся экземпляр (Development) в кластере AKS, который содержит все контейнерные приложения. Но они используют личные пространства, настроенные на своем компьютере, чтобы локально разрабатывать свои службы. При готовности они проверяются от сквозного кластера в кластере AKS без репликации зависимостей. Azure Dev Spaces выполняет слияние кода с локального компьютера со службами в AKS. Разработчики могут быстро выполнять итерацию и отладку кода непосредственно в Kubernetes с помощью Visual Studio или Visual Studio Code.

Чтобы понять ценность Azure Dev Spaces, предоставьте мне общий доступ к этому предложению из Гейб Монрой, а также ведущих контейнеров на Microsoft Azure:

> "Представьте, что вы являетесь новым сотрудником, который пытается исправить ошибку в сложном приложении микрослужб, состоящем из десятков компонентов, каждый из которых имеет собственную конфигурацию и резервные службы. Чтобы приступить к работе, необходимо настроить локальную среду разработки, чтобы она могла имитировать работу, включая настройку интегрированной среды разработки, сборку цепочки инструментов, контейнерные зависимости служб, локальную среду Kubernetes, макеты для резервных служб и многое другое. Во время настройки среды разработки исправление этой первой ошибки может занять дни.
> Также можно использовать пространства разработки и AKS ".

Процесс работы с Azure Dev Spaces состоит из следующих этапов.

1. Создайте пространство разработки.
2. Настройте корневое пространство разработки.
3. Настройка дочернего пространства разработки (для собственной версии системы).
4. Подключитесь к пространству разработки.

Все эти действия можно выполнить с помощью Azure CLI и новых `azds` средств командной строки. Например, чтобы создать новое пространство разработки Azure для данного кластера Kubernetes, используйте следующую команду:

```azurecli
az aks use-dev-spaces -g my-aks-resource-group -n MyAKSCluster
```

Затем можно использовать `azds prep` команду, чтобы создать необходимые ресурсы диаграммы DOCKER и Helm для запуска приложения. Затем выполняется код в AKS с помощью `azds up` . При первом выполнении этой команды будет установлена диаграмма Helm. Контейнеры будут созданы и развернуты в соответствии с вашими инструкциями. Эта задача может занять несколько минут при первом запуске. Однако после внесения изменений можно подключиться к своему дочернему пространству разработки с помощью `azds space select` , а затем развернуть и отладить обновления в изолированном дочернем пространстве разработки. После создания и запуска пространства разработки можно отправить в него обновления, выполнив `azds up` команду или используя встроенные средства в Visual Studio или Visual Studio Code. С помощью VS Code палитра команд используется для подключения к пространству разработки. На рис. 3-12 показано, как запустить веб-приложение с помощью Azure Dev Spaces в Visual Studio.

![Подключение к Azure Dev Spaces в Visual Studio ](./media/azure-dev-spaces-visual-studio-launchsettings.png)
 **рис. 3-12**. Подключение к Azure Dev Spaces в Visual Studio

>[!div class="step-by-step"]
>[Назад](combine-containers-serverless-approaches.md)
>[Вперед](scale-containers-serverless.md)
