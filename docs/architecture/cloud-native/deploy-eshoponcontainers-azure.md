---
title: Развертывание eShopOnContainers в Azure
description: Развертывание приложения eShopOnContainers с помощью службы Kubernetes Azure, Helm и Девспацес.
ms.date: 05/13/2020
ms.openlocfilehash: 93a2848f095d7593e1e169f4a6c6c1818a76217d
ms.sourcegitcommit: 27db07ffb26f76912feefba7b884313547410db5
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/19/2020
ms.locfileid: "83614101"
---
# <a name="deploying-eshoponcontainers-to-azure"></a>Развертывание eShopOnContainers в Azure

Приложение eShopOnContainers можно развернуть на различных платформах Azure. Рекомендуется развернуть приложение в Azure Kubernetes Services (AKS). Helm, средство развертывания Kubernetes, доступно для упрощения развертывания. Кроме того, разработчики могут реализовать Azure Dev Spaces для Kubernetes, чтобы упростить процесс разработки.

## <a name="azure-kubernetes-service"></a>Служба Azure Kubernetes

Чтобы разместить Ешоп в AKS, первым делом нужно создать кластер AKS. Для этого можно использовать портал Azure, который поможет выполнить необходимые действия. Кроме того, можно создать кластер из Azure CLI, позаботиться о включении управления доступом на основе ролей (RBAC) и маршрутизации приложений. В документации по eShopOnContainers подробно описаны действия по созданию собственного кластера AKS. После создания вы сможете получать доступ к кластеру и управлять им с помощью панели мониторинга Kubernetes.

Теперь приложение Ешоп можно развернуть в кластере, используя Helm и.

## <a name="deploying-to-azure-kubernetes-service-using-helm"></a>Развертывание в службе Azure Kubernetes с помощью Helm

Helm — это средство диспетчера пакетов приложений, которое работает непосредственно с Kubernetes. Он помогает определять, устанавливать и обновлять приложения Kubernetes. Хотя простые приложения можно развертывать в AKS с помощью пользовательских сценариев CLI или простых файлов развертывания, сложные приложения могут содержать множество объектов Kubernetes и использовать преимущества Helm.

С помощью Helm приложения включают текстовые файлы конфигурации, которые называются диаграммами Helm, которые декларативно описывают приложение и конфигурацию в пакетах Helm. Диаграммы используют стандартные файлы в формате YAML для описания связанного набора ресурсов Kubernetes. Они являются версиями вместе с кодом приложения, который они описывают. Helm диаграммы находятся в диапазоне от простых до сложных в зависимости от требований установки, которые они описывают.

Helm состоит из клиентского средства командной строки, которое использует диаграммы Helm и запускает команды для серверного компонента с именем, наименее. Чтобы обеспечить правильную подготовку контейнерных рабочих нагрузок, он взаимодействует с API Kubernetes. Helm поддерживается облачной вычислительной средой.

Следующий файл YAML представляет шаблон Helm:

```yaml
apiVersion: v1
kind: Service
metadata:
  name: {{ .Values.app.svc.marketing }}
  labels:
    app: {{ template "marketing-api.name" . }}
    chart: {{ template "marketing-api.chart" . }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
spec:
  type: {{ .Values.service.type }}
  ports:
    - port: {{ .Values.service.port }}
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app: {{ template "marketing-api.name" . }}
    release: {{ .Release.Name }}
```

Обратите внимание, что шаблон описывает динамический набор пар "ключ-значение". При вызове шаблона значения, заключенные в фигурные скобки, извлекаются из других файлов конфигурации на основе YAML.

Диаграммы eShopOnContainers Helm находятся в папке/K8S/Helm. На рис. 2-6 показано, как различные компоненты приложения организованы в структуру папок, используемую Helm для определения и управления развертываниями.

![Архитектура eShopOnContainers ](./media/eshoponcontainers-helm-folder.png)
 **рис. 2-6**. Папка eShopOnContainers Helm.

Каждый отдельный компонент устанавливается с помощью `helm install` команды. Ешоп включает сценарий "развернуть все", который выполняет цикл по и устанавливает компоненты с помощью соответствующих диаграмм Helm. Результатом является повторяемый процесс, имеющий версию приложения в системе управления версиями, который любой участник группы может развернуть в кластере AKS с помощью однострочной команды сценария.

> Обратите внимание, что версия 3 Helm официально устраняет необходимость в компоненте сервера. Дополнительные сведения об этом улучшении можно найти [здесь](https://medium.com/better-programming/why-is-tiller-missing-in-helm-3-2347c446714).

## <a name="azure-dev-spaces"></a>Azure Dev Spaces

Облачные приложения могут быстро увеличиваться и быть сложными, что требует выполнения значительных вычислений. В этих сценариях приложение не может размещаться на компьютере разработки (особенно на ноутбуке). Azure Dev Spaces предназначен для решения этой проблемы с помощью AKS. Он позволяет разработчикам работать с локальной версией своих служб при размещении остального приложения в кластере AKS Development.

Разработчики совместно используют выполняющийся экземпляр (Development) в кластере AKS, который содержит все контейнерные приложения. Но они используют личные пространства, настроенные на своем компьютере, чтобы локально разрабатывать свои службы. При готовности они проверяются от сквозного кластера в кластере AKS без репликации зависимостей. Azure Dev Spaces выполняет слияние кода с локального компьютера со службами в AKS. Члены команды могут увидеть, как их изменения будут вести себя в реальной среде AKS. Разработчики могут быстро выполнять итерацию и отладку кода непосредственно в Kubernetes с помощью Visual Studio 2017 или Visual Studio Code.

На рис. 2-7 вы видите, что разработчик Лилия развернул обновленную версию микрослужбы велосипедов в своем пространстве разработки. Затем она может проверить свои изменения с помощью настраиваемого URL-адреса, начинающегося с имени своего пространства (susie.s.dev.myapp.eus.azds.io).

![Архитектура eShopOnContainers ](./media/azure-devspaces-one.png)
 **рис. 2-7**. Разработчик Лилия развертывает собственную версию микрослужбы велосипедов и тестирует ее.

В то же время разработчик Джон настраивает микрослужбу резервирования и должен протестировать свои изменения. Он развертывает свои изменения в своем собственном пространстве разработки без конфликта с изменениями Лилия, как показано на рисунке 2-8. Затем Джон проверяет свои изменения с помощью собственного URL-адреса, который имеет префикс с именем своего пространства (john.s.dev.myapp.eus.azds.io).

![Архитектура eShopOnContainers ](./media/azure-devspaces-two.png)
 **рис. 2-8**. Разработчик Джон развертывает собственную версию микрослужбы резервирования и тестирует ее без конфликтов с другими разработчиками.

С помощью Azure Dev Spaces команды могут работать непосредственно с AKS, одновременно изменяя, развертывая и тестируя свои изменения. Такой подход сокращает потребность в отдельных выделенных средах размещения, так как каждый разработчик эффективно имеет собственную среду AKS. Разработчики могут работать с Azure Dev Spaces с помощью интерфейса командной строки или запускать свое приложение для Azure Dev Spaces непосредственно из Visual Studio. [Узнайте больше о том, как Azure Dev Spaces работает и настроена.](https://docs.microsoft.com/azure/dev-spaces/how-dev-spaces-works)

## <a name="azure-functions-and-logic-apps-serverless"></a>Функции и Logic Apps Azure (бессерверные)

Образец eShopOnContainers включает поддержку отслеживания маркетинговых кампаний. Функция Azure используется для мониторинга сведений о маркетинговой кампании для заданного идентификатора кампании. Вместо создания полной микрослужбы одна функция Azure является более простой и достаточной. Функции Azure имеют простую модель сборки и развертывания, особенно при настройке для запуска в Kubernetes. Развертывание функции в скрипте осуществляется с помощью шаблонов Azure Resource Manager (ARM) и Azure CLI. Эта служба кампаний не ориентирована на клиентов и вызывает одну операцию, делая ее отличным кандидатом для функций Azure. Функция требует минимальной конфигурации, включая данные строки подключения к базе данных и параметры базового URI изображения. Вы настраиваете функции Azure в портал Azure.

>[!div class="step-by-step"]
>[Назад](map-eshoponcontainers-azure-services.md)
>[Вперед](centralized-configuration.md)
