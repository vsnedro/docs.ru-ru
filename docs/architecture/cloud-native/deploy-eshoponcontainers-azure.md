---
title: Развертывание eShopOnContainers в Azure
description: Развертывание приложения eShopOnContainers с помощью службы Kubernetes Azure, Helm и Девспацес.
ms.date: 05/13/2020
ms.openlocfilehash: b3871dae2b414709bfe24b6f7bdbf06de1689d12
ms.sourcegitcommit: 5b475c1855b32cf78d2d1bbb4295e4c236f39464
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/24/2020
ms.locfileid: "91160727"
---
# <a name="deploying-eshoponcontainers-to-azure"></a><span data-ttu-id="5c356-103">Развертывание eShopOnContainers в Azure</span><span class="sxs-lookup"><span data-stu-id="5c356-103">Deploying eShopOnContainers to Azure</span></span>

<span data-ttu-id="5c356-104">Приложение eShopOnContainers можно развернуть на различных платформах Azure.</span><span class="sxs-lookup"><span data-stu-id="5c356-104">The eShopOnContainers application can be deployed to a variety of Azure platforms.</span></span> <span data-ttu-id="5c356-105">Рекомендуется развернуть приложение в Azure Kubernetes Services (AKS).</span><span class="sxs-lookup"><span data-stu-id="5c356-105">The recommended approach is to deploy the application to Azure Kubernetes Services (AKS).</span></span> <span data-ttu-id="5c356-106">Helm, средство развертывания Kubernetes, доступно для упрощения развертывания.</span><span class="sxs-lookup"><span data-stu-id="5c356-106">Helm, a Kubernetes deployment tool, is available to reduce deployment complexity.</span></span> <span data-ttu-id="5c356-107">Кроме того, разработчики могут реализовать Azure Dev Spaces для Kubernetes, чтобы упростить процесс разработки.</span><span class="sxs-lookup"><span data-stu-id="5c356-107">Optionally, developers may implement Azure Dev Spaces for Kubernetes to streamline their development process.</span></span>

## <a name="azure-kubernetes-service"></a><span data-ttu-id="5c356-108">Служба Azure Kubernetes</span><span class="sxs-lookup"><span data-stu-id="5c356-108">Azure Kubernetes Service</span></span>

<span data-ttu-id="5c356-109">Чтобы разместить Ешоп в AKS, первым делом нужно создать кластер AKS.</span><span class="sxs-lookup"><span data-stu-id="5c356-109">To host eShop in AKS, the first step is to create an AKS cluster.</span></span> <span data-ttu-id="5c356-110">Для этого можно использовать портал Azure, который поможет выполнить необходимые действия.</span><span class="sxs-lookup"><span data-stu-id="5c356-110">To do so, you might use the Azure portal, which will walk you through the required steps.</span></span> <span data-ttu-id="5c356-111">Кроме того, можно создать кластер из Azure CLI, позаботиться о включении управления доступом на основе ролей (RBAC) и маршрутизации приложений.</span><span class="sxs-lookup"><span data-stu-id="5c356-111">You could also create a cluster from the Azure CLI, taking care to enable Role-Based Access Control (RBAC) and application routing.</span></span> <span data-ttu-id="5c356-112">В документации по eShopOnContainers подробно описаны действия по созданию собственного кластера AKS.</span><span class="sxs-lookup"><span data-stu-id="5c356-112">The eShopOnContainers' documentation details the steps for creating your own AKS cluster.</span></span> <span data-ttu-id="5c356-113">После создания вы сможете получать доступ к кластеру и управлять им с помощью панели мониторинга Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="5c356-113">Once created, you can access and manage the cluster from the Kubernetes dashboard.</span></span>

<span data-ttu-id="5c356-114">Теперь приложение Ешоп можно развернуть в кластере, используя Helm и.</span><span class="sxs-lookup"><span data-stu-id="5c356-114">You can now deploy the eShop application to the cluster leveraging Helm and Tiller.</span></span>

## <a name="deploying-to-azure-kubernetes-service-using-helm"></a><span data-ttu-id="5c356-115">Развертывание в службе Azure Kubernetes с помощью Helm</span><span class="sxs-lookup"><span data-stu-id="5c356-115">Deploying to Azure Kubernetes Service using Helm</span></span>

<span data-ttu-id="5c356-116">Helm — это средство диспетчера пакетов приложений, которое работает непосредственно с Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="5c356-116">Helm is an application package manager tool that works directly with Kubernetes.</span></span> <span data-ttu-id="5c356-117">Он помогает определять, устанавливать и обновлять приложения Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="5c356-117">It helps you define, install, and upgrade Kubernetes applications.</span></span> <span data-ttu-id="5c356-118">Хотя простые приложения можно развертывать в AKS с помощью пользовательских сценариев CLI или простых файлов развертывания, сложные приложения могут содержать множество объектов Kubernetes и использовать преимущества Helm.</span><span class="sxs-lookup"><span data-stu-id="5c356-118">While simple apps can be deployed to AKS with custom CLI scripts or simple deployment files, complex apps can contain many Kubernetes objects and benefit from Helm.</span></span>

<span data-ttu-id="5c356-119">С помощью Helm приложения включают текстовые файлы конфигурации, которые называются диаграммами Helm, которые декларативно описывают приложение и конфигурацию в пакетах Helm.</span><span class="sxs-lookup"><span data-stu-id="5c356-119">Using Helm, applications include text-based configuration files, called Helm charts, which declaratively describe the application and configuration in Helm packages.</span></span> <span data-ttu-id="5c356-120">Диаграммы используют стандартные файлы в формате YAML для описания связанного набора ресурсов Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="5c356-120">Charts use standard YAML-formatted files to describe a related set of Kubernetes resources.</span></span> <span data-ttu-id="5c356-121">Они являются версиями вместе с кодом приложения, который они описывают.</span><span class="sxs-lookup"><span data-stu-id="5c356-121">They're versioned alongside the application code they describe.</span></span> <span data-ttu-id="5c356-122">Helm диаграммы находятся в диапазоне от простых до сложных в зависимости от требований установки, которые они описывают.</span><span class="sxs-lookup"><span data-stu-id="5c356-122">Helm Charts range from simple to complex depending on the requirements of the installation they describe.</span></span>

<span data-ttu-id="5c356-123">Helm состоит из клиентского средства командной строки, которое использует диаграммы Helm и запускает команды для серверного компонента с именем, наименее.</span><span class="sxs-lookup"><span data-stu-id="5c356-123">Helm is composed of a command-line client tool, which consumes helm charts and launches commands to a server component named, Tiller.</span></span> <span data-ttu-id="5c356-124">Чтобы обеспечить правильную подготовку контейнерных рабочих нагрузок, он взаимодействует с API Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="5c356-124">Tiller communicates with the Kubernetes API to ensure the correct provisioning of your containerized workloads.</span></span> <span data-ttu-id="5c356-125">Helm поддерживается облачной вычислительной средой.</span><span class="sxs-lookup"><span data-stu-id="5c356-125">Helm is maintained by the Cloud-native Computing Foundation.</span></span>

<span data-ttu-id="5c356-126">Следующий файл YAML представляет шаблон Helm:</span><span class="sxs-lookup"><span data-stu-id="5c356-126">The following yaml file presents a Helm template:</span></span>

```yaml
apiVersion: v1
kind: Service
metadata:
  name: {{ .Values.app.svc.marketing }}
  labels:
    app: {{ template "marketing-api.name" . }}
    chart: {{ template "marketing-api.chart" . }}
    release: {{ .Release.Name }}
    heritage: {{ .Release.Service }}
spec:
  type: {{ .Values.service.type }}
  ports:
    - port: {{ .Values.service.port }}
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app: {{ template "marketing-api.name" . }}
    release: {{ .Release.Name }}
```

<span data-ttu-id="5c356-127">Обратите внимание, что шаблон описывает динамический набор пар "ключ-значение".</span><span class="sxs-lookup"><span data-stu-id="5c356-127">Note how the template describes a dynamic set of key/value pairs.</span></span> <span data-ttu-id="5c356-128">При вызове шаблона значения, заключенные в фигурные скобки, извлекаются из других файлов конфигурации на основе YAML.</span><span class="sxs-lookup"><span data-stu-id="5c356-128">When the template is invoked, values that enclosed in curly braces are pulled in from other yaml-based configuration files.</span></span>

<span data-ttu-id="5c356-129">Диаграммы eShopOnContainers Helm находятся в папке/K8S/Helm.</span><span class="sxs-lookup"><span data-stu-id="5c356-129">You'll find the eShopOnContainers helm charts in the /k8s/helm folder.</span></span> <span data-ttu-id="5c356-130">На рис. 2-6 показано, как различные компоненты приложения организованы в структуру папок, используемую Helm для определения и управления развертываниями.</span><span class="sxs-lookup"><span data-stu-id="5c356-130">Figure 2-6 shows how the different components of the application are organized into a folder structure used by helm to define and managed deployments.</span></span>

<span data-ttu-id="5c356-131">![Архитектура eShopOnContainers ](./media/eshoponcontainers-helm-folder.png)
 **рис. 2-6**.</span><span class="sxs-lookup"><span data-stu-id="5c356-131">![eShopOnContainers Architecture](./media/eshoponcontainers-helm-folder.png)
**Figure 2-6**.</span></span> <span data-ttu-id="5c356-132">Папка eShopOnContainers Helm.</span><span class="sxs-lookup"><span data-stu-id="5c356-132">The eShopOnContainers helm folder.</span></span>

<span data-ttu-id="5c356-133">Каждый отдельный компонент устанавливается с помощью `helm install` команды.</span><span class="sxs-lookup"><span data-stu-id="5c356-133">Each individual component is installed using a `helm install` command.</span></span> <span data-ttu-id="5c356-134">Ешоп включает сценарий "развернуть все", который выполняет цикл по и устанавливает компоненты с помощью соответствующих диаграмм Helm.</span><span class="sxs-lookup"><span data-stu-id="5c356-134">eShop includes a "deploy all" script that loops through and installs the components using their respective helm charts.</span></span> <span data-ttu-id="5c356-135">Результатом является повторяемый процесс, имеющий версию приложения в системе управления версиями, который любой участник группы может развернуть в кластере AKS с помощью однострочной команды сценария.</span><span class="sxs-lookup"><span data-stu-id="5c356-135">The result is a repeatable process, versioned with the application in source control, that anyone on the team can deploy to an AKS cluster with a one-line script command.</span></span>

> <span data-ttu-id="5c356-136">Обратите внимание, что версия 3 Helm официально устраняет необходимость в компоненте сервера.</span><span class="sxs-lookup"><span data-stu-id="5c356-136">Note that version 3 of Helm officially removes the need for the Tiller server component.</span></span> <span data-ttu-id="5c356-137">Дополнительные сведения об этом улучшении можно найти [здесь](https://medium.com/better-programming/why-is-tiller-missing-in-helm-3-2347c446714).</span><span class="sxs-lookup"><span data-stu-id="5c356-137">More information on this enhancement can be found [here](https://medium.com/better-programming/why-is-tiller-missing-in-helm-3-2347c446714).</span></span>

## <a name="azure-dev-spaces"></a><span data-ttu-id="5c356-138">Azure Dev Spaces</span><span class="sxs-lookup"><span data-stu-id="5c356-138">Azure Dev Spaces</span></span>

<span data-ttu-id="5c356-139">Облачные приложения могут быстро увеличиваться и быть сложными, что требует выполнения значительных вычислений.</span><span class="sxs-lookup"><span data-stu-id="5c356-139">Cloud-native applications can quickly grow large and complex, requiring significant compute resources to run.</span></span> <span data-ttu-id="5c356-140">В этих сценариях приложение не может размещаться на компьютере разработки (особенно на ноутбуке).</span><span class="sxs-lookup"><span data-stu-id="5c356-140">In these scenarios, the entire application can't be hosted on a development machine (especially a laptop).</span></span> <span data-ttu-id="5c356-141">Azure Dev Spaces предназначен для решения этой проблемы с помощью AKS.</span><span class="sxs-lookup"><span data-stu-id="5c356-141">Azure Dev Spaces is designed to address this problem using AKS.</span></span> <span data-ttu-id="5c356-142">Он позволяет разработчикам работать с локальной версией своих служб при размещении остального приложения в кластере AKS Development.</span><span class="sxs-lookup"><span data-stu-id="5c356-142">It enables developers to work with a local version of their services while hosting the rest of the application in an AKS development cluster.</span></span>

<span data-ttu-id="5c356-143">Разработчики совместно используют выполняющийся экземпляр (Development) в кластере AKS, который содержит все контейнерные приложения.</span><span class="sxs-lookup"><span data-stu-id="5c356-143">Developers share a running (development) instance in an AKS cluster that contains the entire containerized application.</span></span> <span data-ttu-id="5c356-144">Но они используют личные пространства, настроенные на своем компьютере, чтобы локально разрабатывать свои службы.</span><span class="sxs-lookup"><span data-stu-id="5c356-144">But they use personal spaces set up on their machine to locally develop their services.</span></span> <span data-ttu-id="5c356-145">При готовности они проверяются от сквозного кластера в кластере AKS без репликации зависимостей.</span><span class="sxs-lookup"><span data-stu-id="5c356-145">When ready, they test from end-to-end in the AKS cluster - without replicating dependencies.</span></span> <span data-ttu-id="5c356-146">Azure Dev Spaces выполняет слияние кода с локального компьютера со службами в AKS.</span><span class="sxs-lookup"><span data-stu-id="5c356-146">Azure Dev Spaces merges code from the local machine with services in AKS.</span></span> <span data-ttu-id="5c356-147">Члены команды могут увидеть, как их изменения будут вести себя в реальной среде AKS.</span><span class="sxs-lookup"><span data-stu-id="5c356-147">Team members can see how their changes will behave in a real AKS environment.</span></span> <span data-ttu-id="5c356-148">Разработчики могут быстро выполнять итерацию и отладку кода непосредственно в Kubernetes с помощью Visual Studio 2017 или Visual Studio Code.</span><span class="sxs-lookup"><span data-stu-id="5c356-148">Developers can rapidly iterate and debug code directly in Kubernetes using Visual Studio 2017 or Visual Studio Code.</span></span>

<span data-ttu-id="5c356-149">На рис. 2-7 вы видите, что разработчик Лилия развернул обновленную версию микрослужбы велосипедов в своем пространстве разработки.</span><span class="sxs-lookup"><span data-stu-id="5c356-149">In Figure 2-7, you can see that Developer Susie has deployed an updated version of the Bikes microservice into her dev space.</span></span> <span data-ttu-id="5c356-150">Затем она может проверить свои изменения с помощью настраиваемого URL-адреса, начинающегося с имени своего пространства (susie.s.dev.myapp.eus.azds.io).</span><span class="sxs-lookup"><span data-stu-id="5c356-150">She's then able to test her changes using a custom URL starting with the name of her space (susie.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="5c356-151">![Архитектура eShopOnContainers ](./media/azure-devspaces-one.png)
 **рис. 2-7**.</span><span class="sxs-lookup"><span data-stu-id="5c356-151">![eShopOnContainers Architecture](./media/azure-devspaces-one.png)
**Figure 2-7**.</span></span> <span data-ttu-id="5c356-152">Разработчик Лилия развертывает собственную версию микрослужбы велосипедов и тестирует ее.</span><span class="sxs-lookup"><span data-stu-id="5c356-152">Developer Susie deploys her own version of the Bikes microservice and tests it.</span></span>

<span data-ttu-id="5c356-153">В то же время разработчик Джон настраивает микрослужбу резервирования и должен протестировать свои изменения.</span><span class="sxs-lookup"><span data-stu-id="5c356-153">At the same time, developer John is customizing the Reservations microservice and needs to test his changes.</span></span> <span data-ttu-id="5c356-154">Он развертывает свои изменения в своем собственном пространстве разработки без конфликта с изменениями Лилия, как показано на рисунке 2-8.</span><span class="sxs-lookup"><span data-stu-id="5c356-154">He deploys his changes to his own dev space without conflicting with Susie's changes as shown in Figure 2-8.</span></span> <span data-ttu-id="5c356-155">Затем Джон проверяет свои изменения с помощью собственного URL-адреса, который имеет префикс с именем своего пространства (john.s.dev.myapp.eus.azds.io).</span><span class="sxs-lookup"><span data-stu-id="5c356-155">John then tests his changes using his own URL that is prefixed with the name of his space (john.s.dev.myapp.eus.azds.io).</span></span>

<span data-ttu-id="5c356-156">![Архитектура eShopOnContainers ](./media/azure-devspaces-two.png)
 **рис. 2-8**.</span><span class="sxs-lookup"><span data-stu-id="5c356-156">![eShopOnContainers Architecture](./media/azure-devspaces-two.png)
**Figure 2-8**.</span></span> <span data-ttu-id="5c356-157">Разработчик Джон развертывает собственную версию микрослужбы резервирования и тестирует ее без конфликтов с другими разработчиками.</span><span class="sxs-lookup"><span data-stu-id="5c356-157">Developer John deploys his own version of the Reservations microservice and tests it without conflicting with other developers.</span></span>

<span data-ttu-id="5c356-158">С помощью Azure Dev Spaces команды могут работать непосредственно с AKS, одновременно изменяя, развертывая и тестируя свои изменения.</span><span class="sxs-lookup"><span data-stu-id="5c356-158">Using Azure Dev Spaces, teams can work directly with AKS while independently changing, deploying, and testing their changes.</span></span> <span data-ttu-id="5c356-159">Такой подход сокращает потребность в отдельных выделенных средах размещения, так как каждый разработчик эффективно имеет собственную среду AKS.</span><span class="sxs-lookup"><span data-stu-id="5c356-159">This approach reduces the need for separate dedicated hosted environments since every developer effectively has their own AKS environment.</span></span> <span data-ttu-id="5c356-160">Разработчики могут работать с Azure Dev Spaces с помощью интерфейса командной строки или запускать свое приложение для Azure Dev Spaces непосредственно из Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="5c356-160">Developers can work with Azure Dev Spaces using its CLI or launch their application to Azure Dev Spaces directly from Visual Studio.</span></span> [<span data-ttu-id="5c356-161">Узнайте больше о том, как Azure Dev Spaces работает и настроена.</span><span class="sxs-lookup"><span data-stu-id="5c356-161">Learn more about how Azure Dev Spaces works and is configured.</span></span>](/azure/dev-spaces/how-dev-spaces-works)

## <a name="azure-functions-and-logic-apps-serverless"></a><span data-ttu-id="5c356-162">Функции и Logic Apps Azure (бессерверные)</span><span class="sxs-lookup"><span data-stu-id="5c356-162">Azure Functions and Logic Apps (Serverless)</span></span>

<span data-ttu-id="5c356-163">Образец eShopOnContainers включает поддержку отслеживания маркетинговых кампаний.</span><span class="sxs-lookup"><span data-stu-id="5c356-163">The eShopOnContainers sample includes support for tracking online marketing campaigns.</span></span> <span data-ttu-id="5c356-164">Функция Azure используется для мониторинга сведений о маркетинговой кампании для заданного идентификатора кампании.</span><span class="sxs-lookup"><span data-stu-id="5c356-164">An Azure Function is used to track marketing campaign details for a given campaign ID.</span></span> <span data-ttu-id="5c356-165">Вместо создания полной микрослужбы одна функция Azure является более простой и достаточной.</span><span class="sxs-lookup"><span data-stu-id="5c356-165">Rather than creating a full microservice, a single Azure Function is simpler and sufficient.</span></span> <span data-ttu-id="5c356-166">Функции Azure имеют простую модель сборки и развертывания, особенно при настройке для запуска в Kubernetes.</span><span class="sxs-lookup"><span data-stu-id="5c356-166">Azure Functions have a simple build and deployment model, especially when configured to run in Kubernetes.</span></span> <span data-ttu-id="5c356-167">Развертывание функции в скрипте осуществляется с помощью шаблонов Azure Resource Manager (ARM) и Azure CLI.</span><span class="sxs-lookup"><span data-stu-id="5c356-167">Deploying the function is scripted using Azure Resource Manager (ARM) templates and the Azure CLI.</span></span> <span data-ttu-id="5c356-168">Эта служба кампаний не ориентирована на клиентов и вызывает одну операцию, делая ее отличным кандидатом для функций Azure.</span><span class="sxs-lookup"><span data-stu-id="5c356-168">This campaign service isn't customer-facing and invokes a single operation, making it a great candidate for Azure Functions.</span></span> <span data-ttu-id="5c356-169">Функция требует минимальной конфигурации, включая данные строки подключения к базе данных и параметры базового URI изображения.</span><span class="sxs-lookup"><span data-stu-id="5c356-169">The function requires minimal configuration, including a database connection string data and image base URI settings.</span></span> <span data-ttu-id="5c356-170">Вы настраиваете функции Azure в портал Azure.</span><span class="sxs-lookup"><span data-stu-id="5c356-170">You configure Azure Functions in the Azure portal.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="5c356-171">[Назад](map-eshoponcontainers-azure-services.md)
>[Вперед](centralized-configuration.md)</span><span class="sxs-lookup"><span data-stu-id="5c356-171">[Previous](map-eshoponcontainers-azure-services.md)
[Next](centralized-configuration.md)</span></span>
