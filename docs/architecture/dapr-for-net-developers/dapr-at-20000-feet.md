---
title: 'Dapr: общее представление'
description: Общий обзор того, что такое ДАПР, что он делает и как он работает.
author: robvet
ms.date: 02/07/2021
ms.openlocfilehash: f0efb4652aaa35961d59979cb561941e5280a575
ms.sourcegitcommit: 46cfed35d79d70e08c313b9c664c7e76babab39e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/10/2021
ms.locfileid: "102604753"
---
# <a name="dapr-at-20000-feet"></a>Dapr: общее представление

В главе 1 мы обсуждали привлекательность распределенных приложений микрослужб. Но мы также указали, что они радикально увеличивают сложность архитектуры и эксплуатации. С учетом этого вопрос превращается в то, как можно «подать торт» и «EAT»?». То есть, как можно воспользоваться преимуществами гибкой распределенной архитектуры и максимально упростить ее сложность?

ДАПР или *Распределенная среда выполнения приложений*— это новый способ создания современных распределенных приложений.

То, что было запущено как прототип, превратилось в высокоудачный проект с открытым исходным кодом. Его спонсор корпорации Майкрософт тесно взаимодействует с клиентами и сообществом с открытым кодом для проектирования и создания ДАПР. Проект ДАПР объединяет разработчиков со всех фоновых рисунков, чтобы решить некоторые из самых сложных трудностей, связанных с разработкой распределенных приложений.

В этой книге рассматривается ДАПР от точки зрения разработчика .NET. В этой главе вы создадите концептуальное представление о ДАПР и принципах его работы. Позже мы представим практическую инструкцию по использованию ДАПР в своих приложениях.

Представьте себе перелета в Jet на 20 000 футов. Вы выйдете из окна и увидите альбомную ориентацию с широкой точки зрения. Сделаем то же самое для ДАПР. Визуализируйте себя по Дапру в 20 000 метров. Что вы видите?

## <a name="dapr-and-the-problem-it-solves"></a>ДАПР и проблема, с которой она решается

ДАПР решает большую проблему, присущую современным распределенным приложениям: **сложность**.

Благодаря архитектуре подключаемых компонентов ДАПР значительно упрощает работу распределенных приложений. Он обеспечивает **динамическое** связывание, которое связывает приложение с возможностями инфраструктуры из среды выполнения ДАПР. Например, приложению может потребоваться хранилище состояний. Вы можете написать пользовательский код для целевого кэша Redis и внедрить его в службу во время выполнения. Однако ДАПР упрощает работу, предоставляя готовые возможности распределенного кэша. Служба вызывает **стандартный блок** ДАПР, который динамически привязывается к **компоненту** кэша Redis через **конфигурацию** ДАПР. В этой модели служба делегирует вызов ДАПР, который вызывает Redis от вашего имени. У вашей службы нет пакета SDK, библиотеки или прямой ссылки на Redis. Вы запрограммироване на общий API управления состоянием ДАПР, а не через API кэша Redis.

На рис. 2-1 показан ДАПР с 20 000 футов.

![ДАПР на ](./media/dapr-at-20000-feet/dapr-high-level.png)
 **рис. 2-1** 20 000 футов. ДАПР в 20 000 метров.

В верхней строке рисунка Обратите внимание на то, как ДАПР предоставляет пакеты SDK для конкретных языков для популярных платформ разработки. ДАПР v 1,0 включает поддержку Go, Node.js, Python, .NET, Java и JavaScript. Эта книга посвящена пакету SDK для ДАПР .NET, который также обеспечивает прямую поддержку интеграции ASP.NET Core.

Хотя пакеты SDK для конкретного языка улучшают работу разработчиков, ДАПР не зависит от платформы. Внутри ДАПР модель программирования предоставляет возможности через стандартные протоколы связи HTTP/gRPC. Любая платформа программирования может вызывать ДАПР через собственные API-интерфейсы HTTP и gRPC.  

Синие рамки в центре фигуры представляют стандартные блоки ДАПР. Каждый из них предоставляет возможности распределенного приложения, которые может использовать приложение.

В нижней строке выделяется переносимость ДАПР и различные среды, в которых она может работать.

## <a name="dapr-architecture"></a>Архитектура ДАПР

На этом этапе модуль Jet превращается в ДАПР, по убыванию по высоте, что дает более подробное представление о том, как работает ДАПР.

### <a name="building-blocks"></a>Стандартные блоки

С новой перспективы вы увидите более подробное представление **стандартных блоков** ДАПР.

Стандартный блок инкапсулирует возможности распределенной инфраструктуры. Доступ к функциональным возможностям можно получить через API-интерфейсы HTTP или gRPC. На рис. 2-2 показаны доступные блоки для ДАПР v 1,0.

![Стандартные блоки ДАПР](./media/dapr-at-20000-feet/building-blocks.png)

**Рис. 2-2**. ДАПР стандартные блоки.

В следующей таблице описаны службы инфраструктуры, предоставляемые каждым блоком.

| Стандартный блок | Описание |
|----------------|-------------|
| [Управление состоянием](state-management.md) | Поддержка контекстной информации для долгосрочных служб с отслеживанием состояния. |
| [Вызов службы](service-invocation.md) | Вызов прямых и безопасных вызовов между службами с помощью независимых от платформы протоколов и хорошо известных конечных точек. |
| [Публикация и подписка](publish-subscribe.md) | Реализуйте защищенный масштабируемый обмен сообщениями между службами. |
| [Привязки](bindings.md) | Активация кода из событий, вызванных внешними ресурсами с двунаправленным обменом данными. |
| [Наблюдаемость](observability.md) | Отслеживание и измерение вызовов сообщений в сетевых службах. |
| [Секреты](secrets.md) | Безопасный доступ к внешним хранилищам секретов. |
| Субъекты | Инкапсулировать логику и данные в повторно используемых объектах субъекта. |

Стандартные блоки являются абстрактной реализацией возможностей распределенных приложений из служб. Это взаимодействие показано на рисунке 2-3.

![Интеграция стандартных блоков ДАПР](./media/dapr-at-20000-feet/building-blocks-integration.png)

**Рис. 2-3**. Интеграция ДАПР стандартных блоков.

Стандартные блоки вызывают компоненты ДАПР, которые предоставляют конкретную реализацию для каждого ресурса. Код службы учитывает только стандартный блок. Он не зависит от внешних пакетов SDK или библиотек — ДАПР обрабатывает эти коммуникации. Каждый стандартный блок является независимым. В приложении можно использовать один, несколько или все из них. Как вариант добавления, ДАПР стандартные блоки внедрить в отраслевых рекомендациях, включая всестороннее наблюдаемое значение.

В будущих главах мы предоставляем подробные пояснения и примеры кода для каждого стандартного блока ДАПР. На этом этапе модуль Jet в большей мере еще больше. С новой перспективы вы увидите более подробное представление о слое компонентов ДАПР.

### <a name="components"></a>Компоненты

Хотя стандартные блоки предоставляют API для вызова возможностей распределенного приложения, компоненты ДАПР обеспечивают конкретную реализацию, чтобы сделать ее возможной.

Рассмотрим, компонент **хранилища состояний** ДАПР. Он обеспечивает единообразный способ управления состоянием операций CRUD. Без изменения кода службы можно переключаться между любым из следующих компонентов состояния ДАПР:

- AWS DynamoDB
- аероспике
- хранилище BLOB-объектов Azure
- Azure CosmosDB
- Хранилище таблиц Azure
- Cassandra
- Cloud Фиресторе (режим хранилища данных)
- клаудстате
- Couchbase
- Etcd
- HashiCorp Consul
- хазелкаст
- Memcached
- MongoDB
- PostgreSQL
- Redis
- ресинкдб
- SQL Server
- Zookeeper

Каждый компонент предоставляет необходимую реализацию через общий интерфейс управления состоянием:

```go
 type Store interface {
   Init(metadata Metadata) error
   Delete(req *DeleteRequest) error
   BulkDelete(req []DeleteRequest) error
   Get(req *GetRequest) (*GetResponse, error)
   Set(req *SetRequest) error
   BulkSet(req []SetRequest) error
}
```

> [!TIP]
> Среда выполнения ДАПР, а также все компоненты ДАПР были написаны на языке Golang или go. Go — популярный язык в сообществе с открытым исходным кодом и аттестации для межплатформенных обязательств по ДАПР.

Возможно, вы начинаете с кэша Redis для Azure в качестве хранилища состояний. Укажите его в следующей конфигурации:

 ```yaml
 apiVersion: dapr.io/v1alpha1
 kind: Component
 metadata:
   name: statestore
   namespace: default
 spec:
   type: state.redis
   version: v1
   metadata:
   - name: redisHost
     value: <HOST>
   - name: redisPassword
     value: <PASSWORD>
   - name: enableTLS
     value: <bool> # Optional. Allowed: true, false.
   - name: failover
     value: <bool> # Optional. Allowed: true, false.
 ```

В разделе **спецификаций** вы настраиваете ДАПР для использования кэша Redis для управления состоянием. Раздел также содержит метаданные для конкретного компонента. В этом случае можно использовать его для настройки дополнительных параметров Redis.

В дальнейшем приложение будет готово к работе в рабочей среде. Для рабочей среды может потребоваться изменить управление состоянием в хранилище таблиц Azure. Хранилище таблиц Azure предоставляет возможности управления состоянием, которые являются доступными и надежными.

На момент написания этой статьи в ДАПР предоставляются следующие типы компонентов:

| Компонент | Описание |
|-----------|-------------|
| [обнаружение служб;](https://github.com/dapr/components-contrib/tree/master/nameresolution) | Используется стандартным блоком вызова службы для интеграции со средой размещения для обеспечения обнаружения между службами. |
| [Состояние](https://github.com/dapr/components-contrib/tree/master/state) | Предоставляет унифицированный интерфейс для взаимодействия с широким спектром реализаций хранилища состояний. |
| [Pub/подпапка](https://github.com/dapr/components-contrib/tree/master/pubsub) | Предоставляет унифицированный интерфейс для взаимодействия с широким спектром реализаций шины сообщений. |
| [Привязки](https://github.com/dapr/components-contrib/tree/master/bindings) | Предоставляет универсальный интерфейс для активации событий приложения из внешних систем и вызова внешних систем с дополнительными полезными данными. |
| [ПО промежуточного слоя](https://github.com/dapr/components-contrib/tree/master/middleware) | Позволяет пользовательскому по промежуточного слоя подключаться к конвейеру обработки запросов и вызывать дополнительные действия с запросом или ответом. |
| [Секретные хранилища](https://github.com/dapr/components-contrib/tree/master/secretstores) | Предоставляет единый интерфейс для взаимодействия с внешними хранилищами секретов, включая облачные, граничные и коммерческие службы с открытым исходным кодом. |

По мере того, как модуль Jet завершает свое переключение на ДАПР, вы сможете взглянуть еще раз и увидеть, как он соединяется вместе.

### <a name="sidecar-architecture"></a>Архитектура расширения

ДАПР предоставляет свои стандартные блоки и компоненты через [архитектуру расширения](/azure/architecture/patterns/sidecar). Расширения позволяет выполнять ДАПР в отдельном процессе памяти или отдельном контейнере вместе со службой. Сидекарс обеспечивают изоляцию и инкапсуляцию, так как они не являются частью службы, но подключены к ней. Это разделение позволяет каждому из них иметь собственную среду выполнения и создаваться на разных платформах программирования. На рис. 2-4 показан шаблон расширения.

![Архитектура расширения](./media/dapr-at-20000-feet/sidecar-generic.png)

**Рис. 2-4**. Архитектура расширения.

Он называется расширением, так как напоминает коляску, присоединенную к мотоциклу. На предыдущем рисунке обратите внимание на то, как ДАПР расширения присоединяется к службе для предоставления возможностей распределенного приложения.

### <a name="hosting-environments"></a>Среды размещения

ДАПР поддерживает кросс-платформенную поддержку и может выполняться во многих разных средах. К таким средам относятся Kubernetes, группа виртуальных машин или граничные среды, такие как Azure IoT Edge.

Для локальной разработки проще всего начать работу с [автономным режимом](https://docs.dapr.io/concepts/overview/#self-hosted). В автономном режиме микрослужбы и ДАПР сидекарс выполняются в отдельных локальных процессах без контейнера Orchestrator, такого как Kubernetes. Дополнительные сведения см. [в статье Загрузка и установка интерфейса командной строки ДАПР](https://docs.dapr.io/getting-started/install-dapr/).

На рис. 2-5 показано приложение и ДАПР, размещенные в двух отдельных процессах памяти, взаимодействующих через HTTP или gRPC.

![Локально размещенная Архитектура расширения](./media/dapr-at-20000-feet/self-hosted-dapr-sidecar.png)

**Рис. 2-5**. Локально размещенное расширения ДАПР.

По умолчанию ДАПР устанавливает контейнеры DOCKER для Redis и Зипкин, чтобы обеспечить управление состоянием по умолчанию и наблюдаемость. Если вы не хотите устанавливать DOCKER на локальном компьютере, можно даже [запустить ДАПР в режиме с автономным размещением без контейнеров DOCKER](https://docs.dapr.io/operations/hosting/self-hosted/self-hosted-no-docker/). Однако необходимо установить компоненты по умолчанию, такие как Redis для управления состоянием и Pub/подпапка, вручную.

ДАПР также работает в [контейнерных средах](https://docs.dapr.io/concepts/overview/#kubernetes-hosted), таких как Kubernetes. На рис. 2-6 показан ДАПР, работающий в отдельном контейнере, а также контейнер приложения в том же Kubernetes Pod.

![Kubernetes-размещенная Архитектура расширения](./media/dapr-at-20000-feet/kubernetes-hosted-dapr-sidecar.png)

**Рис. 2-6**. Kubernetes-Hosted ДАПР расширения.

## <a name="dapr-performance-considerations"></a>Вопросы производительности ДАПР

Как вы видели, ДАПР предоставляет архитектуру расширения для отделения приложения от возможностей распределенных приложений. Для вызова операции ДАПР требуется по крайней мере один необработанный сетевой вызов. На рис. 2-7 представлен пример шаблона трафика ДАПР.

![Шаблоны трафика ДАПР](./media/dapr-at-20000-feet/dapr-traffic-patterns.png)

**Рис. 2-7**. Шаблоны трафика ДАПР.

Взглянув на предыдущий рисунок, один из них может дать вопрос о задержке и дополнительной нагрузке для каждого вызова.  

Группа Дапра сильно затратила производительность. Огромный объем работ по проектированию ДАПР эффективно. Вызовы между ДАПР сидекарс всегда устанавливаются с помощью gRPC, что обеспечивает высокую производительность и небольшие двоичные данные. В большинстве случаев дополнительные издержки должны быть в миллисекундах.

Для повышения производительности разработчики могут вызывать стандартные блоки ДАПР с помощью gRPC.

gRPC — это современная высокопроизводительная платформа, которая используется для развития устаревшего протокола [удаленного вызова процедур (RPC)](https://en.wikipedia.org/wiki/Remote_procedure_call) . gRPC использует HTTP/2 для транспортного протокола, что обеспечивает значительное повышение производительности по сравнению со службой HTTP RESTFUL, в том числе:

- Поддержка мультиплексирования для отправки нескольких параллельных запросов через одно подключение — HTTP 1,1 ограничивает обработку одного сообщения "запрос-ответ" за раз.
- Двунаправленный дуплексный обмен данными для одновременной отправки клиентских запросов и ответов сервера.
- Встроенная потоковая передача, позволяющая запросам и ответам асинхронного потока больших наборов данных.

## <a name="dapr-and-service-meshes"></a>ДАПР и сети служб

Сеть службы — это еще одна быстро развивающаяся технология для распределенных приложений.

Сетка служб — это настраиваемый уровень инфраструктуры со встроенными возможностями для обработки связи между службами, устойчивости, балансировки нагрузки и сбора данных телеметрии. Он перенесет ответственность за эти проблемы из служб и на уровне сетки служб. Как и ДАПР, сеть службы также соответствует архитектуре расширения.

На рис. 2-8 показано приложение, реализующее технологию сетки служб.

![Сеть службы](./media/dapr-at-20000-feet/service-mesh-with-side-car.png)

**Рис. 2-8**. Сеть службы с побочным автомобилем.

На предыдущем рисунке показано, как сообщения перехватываются прокси-сервером, который выполняется параллельно с каждой службой. Каждый прокси-сервер можно настроить с помощью правил трафика, относящихся к службе. Он распознает сообщения и может маршрутизировать их во всех службах и во внешнем мире.

Итак, вопрос выглядит так: «ДАПР в сеть службы?».

Хотя используется архитектура расширения, каждая технология имеет разные цели. ДАПР предоставляет функции распределенного приложения. Сетка служб предоставляет выделенный уровень сетевой инфраструктуры.

Все они работают на разных уровнях и могут совместно работать в одном приложении. Например, сеть службы может обеспечить сетевую связь между службами. ДАПР может предоставлять службы приложений, такие как управление состоянием или службы субъектов.

На рис. 2-9 показано приложение, которое реализует технологию ДАПР и технологии сетки служб.

![ДАПР и совместная работа между службами](./media/dapr-at-20000-feet/dapr-and-service-mesh.png)

**Рис. 2-9**. ДАПР и совместная работа между службами.

В книге, [Learning ДАПР](https://www.amazon.com/Learning-Dapr-Building-Distributed-Applications/dp/1492072427/ref=sr_1_1?dchild=1&keywords=dapr&qid=1604794794&sr=8-1), Authors хайши Баи Bai and Ярон Schneider, охватывают интеграцию ДАПР и сети услуг.

## <a name="summary"></a>Итоги

В этой главе мы предоставили вам ДАПР среду выполнения распределенного приложения.

ДАПР — это проект с открытым исходным кодом, который спонсор Майкрософт закрывает сотрудничество с клиентами и сообществом с открытым кодом.

По сути, ДАПР помогает снизить сложность распределенных приложений микрослужб. Он построен на основе концепции стандартных блоков API. Стандартные блоки ДАПР предоставляют распространенные возможности распределенного приложения, такие как управление состоянием, вызов между службами и обмен сообщениями в формате публикации и подсистемы. Компоненты ДАПР находятся под стандартными блоками и предоставляют конкретную реализацию для каждой возможности. Приложения связываются с различными компонентами через файлы конфигурации.

В следующих главах мы представим практическое практическое руководство по использованию ДАПР в приложениях.

### <a name="references"></a>Ссылки

- [Документация по ДАПР](https://dapr.io/)
- [Learning ДАПР](https://www.amazon.com/Learning-Dapr-Building-Distributed-Applications/dp/1492072427/ref=sr_1_1?dchild=1&keywords=dapr&qid=1604794794&sr=8-1)
- [Микрослужбы .NET: архитектура контейнерных приложений .NET](https://dotnet.microsoft.com/download/thank-you/microservices-architecture-ebook)
- [Разработка архитектуры приложений Cloud-Native .NET для Azure](https://dotnet.microsoft.com/download/e-book/cloud-native-azure/pdf)

> [!div class="step-by-step"]
> [Назад](the-world-is-distributed.md)
> [Вперед](getting-started.md)
