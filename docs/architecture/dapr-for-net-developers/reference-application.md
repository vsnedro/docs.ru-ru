---
title: Введение в Справочное приложение Ешопондапр
description: Обзор эталонного приложения Ешопондапр и его журнала.
author: amolenk
ms.date: 02/07/2021
ms.openlocfilehash: d05d47399b9be539597778a4f7856e06d3b16a6c
ms.sourcegitcommit: 42d436ebc2a7ee02fc1848c7742bc7d80e13fc2f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "102401864"
---
# <a name="dapr-reference-application"></a>Эталонное приложение ДАПР

Ранее в книге вы узнали о базовых преимуществах ДАПР. Вы узнали, как ДАПР может помочь вашей команде конструировать распределенные приложения, уменьшая сложность архитектуры и сложности. Кстати, у вас есть возможность создавать небольшие ДАПР приложения. Теперь пора изучить комплексное приложение микрослужбы, демонстрирующее ДАПР стандартные блоки и компоненты.

Но сначала немного журнал.

## <a name="eshop-on-containers"></a>Ешоп в контейнерах

Несколько лет назад корпорация Майкрософт, в связи с ведущими экспертами сообщества, выпустила популярную книгу рекомендаций с [микрослужбами .NET для упакованных в контейнеры приложений .NET](https://dotnet.microsoft.com/download/e-book/microservices-architecture/pdf). На рис. 3-1 показана книга:

![Разработка контейнерных приложений .NET для микрослужб.](./media/reference-application/architecting-microservices-book.png)

**Рис. 3-1**. Микрослужбы .NET: архитектура для контейнерных приложений .NET.

В книге довеся принципы, шаблоны и рекомендации по созданию распределенных приложений. В него входит полнофункциональное Справочное приложение по микрослужбам, в котором были показаны основные понятия архитектуры. Право, [eShopOnContainers](https://github.com/dotnet-architecture/eShopOnContainers), приложение показывает магазин электронной коммерции, который продает различные элементы .NET, включая одежда и кофе кружки.  Приложение, встроенное в .NET Core, является межплатформенным и может работать в контейнерах Linux или Windows. На рис. 3-2 показана исходная архитектура Ешоп.

![Эталонная архитектура приложения eShopOnContainers.](./media/reference-application/eshop-on-containers.png)

**Рис. 3-2**. Исходное `ShopOnContainers` эталонное приложение.

Как видите, eShopOnContainers включает множество движущихся частей:

1. Три разных клиентского интерфейса.
1. Шлюз приложений для абстракции серверной части с внешнего интерфейса.
1. Несколько внутренних основных микрослужб.
1. Компонент шины событий, обеспечивающий асинхронный общий обмен сообщениями.

Эталонное приложение eShopOnContainers широко принято в рамках сообщества .NET и используется для моделирования многих крупных коммерческих приложений микрослужб.

## <a name="eshop-on-dapr"></a>Ешоп в ДАПР

Эта книга поставляется с альтернативной версией приложения Ешоп. Он называется [ешопондапр](https://github.com/dotnet-architecture/eShopOnDapr). Обновленная версия развивается ранее eShopOnContainers приложение, интегрируя стандартные блоки и компоненты ДАПР. На рис. 3-3 показана новая архитектура упрощенного решения:  

![Эталонная архитектура приложения Ешопондапр.](./media/reference-application/eshop-on-dapr.png)

**Рис. 3-3**. Эталонная архитектура приложения Ешопондапр.

По мере того как фокус в эталонном приложении Ешопондапр находится на ДАПР, исходное приложение было обновлено. Архитектура состоит из следующих компонентов:

1. Интерфейс [одностраничного приложения](/archive/msdn-magazine/2013/november/asp-net-single-page-applications-build-modern-responsive-web-apps-with-asp-net) , написанный на популярной платформе в угловом Spa. Он отправляет запросы пользователей в микрослужбу шлюза API.

1. Шлюз API абстрагирует основные микрослужбы ядра серверной части от клиентского клиента. Он реализуется с помощью [делегата](https://www.envoyproxy.io/), высокопроизводительного прокси-сервера службы с открытым исходным кодом. Представитель направляет входящие запросы к различным микрослужбам серверной части. Большинство запросов являются простыми операциями CRUD (например, получить список торговых марок из каталога) и обрабатываться прямым вызовом серверной микрослужбы.

1. Другие запросы логически сложны и для совместной работы требуется несколько микрослужб. В таких случаях Ешопондапр реализует [микрослужбу агрегатора](../cloud-native/service-to-service-communication.md#service-aggregator-pattern) , которая координирует рабочий процесс по микрослужбам, необходимым для выполнения операции.

1. Набор основных серверных микрослужб включает функции, необходимые для магазина электронной коммерции. Каждый из них самодостаточен и не зависит от других. В следующих широко принятых шаблонах разбиения доменов каждая микрослужба изолирует определенную *бизнес-возможность*:

   - Служба корзины управляет возможностями покупательской корзины.
   - Служба каталога управляет элементами продуктов, доступными для продажи.
   - Служба удостоверений управляет проверкой подлинности и удостоверением.
   - Служба упорядочения обрабатывает все аспекты размещения заказов и управления ими.
   - Служба платежей взаимодействует с оплатой клиента.

   Каждая служба имеет собственное постоянное хранилище. При соблюдении [рекомендаций](../cloud-native/distributed-data.md#database-per-microservice-why)по микрослужбам не существует общего хранилища данных, с которым взаимодействуют все службы.

   Проектирование каждой микрослужбы основано на индивидуальных требованиях. Простые службы используют базовые операции CRUD для доступа к базовым хранилищам данных. Дополнительные службы, например упорядочение, используют подход Domain-Driven проектирования для управления сложными бизнес-процессами. При необходимости службы могут быть построены в различных технологических стеках, таких как .NET Core, Java, Go, NodeJS и т. д.

1. Наконец, шина событий создает оболочку для компонентов публикации и подписки ДАПР. Она позволяет асинхронно публиковать и подписывать сообщения в микрослужбах. Разработчики могут подключать любой брокер сообщений, поддерживаемый ДАПР.

### <a name="application-of-dapr-building-blocks"></a>Применение стандартных блоков ДАПР

База кода Ешопондапр более рациональна, чем база кода eShopOnContainers. ДАПР стандартные блоки заменяют большой объем коммуникационного кода, подверженного ошибкам.

На рис. 3-4 показана интеграция ДАПР в справочном приложении Ешоп.

![Архитектура эталонного приложения Ешопондапр](./media/reference-application/eshop-on-dapr-buildingblocks.png)

**Рис. 3-4**. Интеграция ДАПР в Ешопондапр.

На предыдущем рисунке видно, какие службы используют ДАПР стандартные блоки.

1. Исходное приложение eShopOnContainers демонстрирует понятия и шаблоны DDD в службе упорядочения. В обновленном Ешопондапр служба упорядочения использует *стандартный блок субъекта* в качестве альтернативной реализации. Модель доступа на основе поворачивания субъектов позволяет легко реализовать процесс упорядочения с отслеживанием состояния с поддержкой отмены.
1. Служба упорядочения отправляет сообщения электронной почты с подтверждением заказа с помощью [стандартного блока привязки](bindings.md).
1. Серверные службы обмениваются данными асинхронно с помощью [стандартного блока publish & Subscribe](publish-subscribe.md).
1. Управление секретами выполняется в [стандартном блоке секретов](secrets.md).
1. Службы "шлюз API" и "Статистическая обработка веб-покупок" используют [стандартный блок вызова службы](service-invocation.md) для вызова методов серверных служб.
1. Служба корзины использует [стандартный блок управления состоянием](state-management.md) для хранения состояния корзины покупателя.

### <a name="benefits-of-applying-dapr-to-eshop"></a>Преимущества применения ДАПР к Ешоп

Как правило, использование стандартных блоков ДАПР добавляет наблюдаемую и гибкую гибкость в приложение:

1. Наблюдаемость. используя стандартные блоки ДАПР, вы получаете широкие возможности распределенной трассировки для обоих вызовов между службами и для ДАПР компонентов без необходимости написания кода. В eShopOnContainers для получения ценных сведений используется большое количество пользовательских журналов.
1. Гибкость *. Теперь можно* отменять инфраструктуру, просто изменяя файл конфигурации компонента. Изменения кода не требуются.

Ниже приведены некоторые дополнительные примеры преимуществ, предоставляемых конкретными стандартными блоками.

- **Вызов службы**
  - Благодаря поддержке ДАПР для [mTLS](https://blog.cloudflare.com/introducing-tls-client-auth/)службы теперь обмениваются данными через зашифрованные каналы.
  - При возникновении временных ошибок вызовы служб автоматически повторяются.
  - Автоматическое обнаружение служб сокращает объем конфигурации, необходимой для того, чтобы службы нашли друг друга.

- **Публикация и подписка**
  - Ешопонконтаинер включал в себя большой объем пользовательского кода для поддержки служебной шины Azure и RabbitMQ. Разработчики использовали служебную шину Azure для рабочей среды и RabbitMQ для локальной разработки и тестирования. `IEventBus`Для включения переключения между этими брокерами сообщений был создан слой абстракции. Этот слой состоит из приблизительно *700 строк кода, подверженного ошибкам*. Для обновленной реализации с ДАПР требуется всего *35 строк кода*. Это **5%** исходных строк кода! Что более важно, реализация проста и проста в понимании.
  - Ешопондапр использует богатую ASP.NET Coreную интеграцию ДАПР для использования Pub/reby. Добавьте `Topic` атрибуты в методы контроллера ASP.NET Core, чтобы подписываться на сообщения. Поэтому нет необходимости писать отдельный цикл обработчика сообщений для каждого брокера сообщений.
  - Сообщения, направляемые в службу как вызовы HTTP, позволяют использовать по промежуточного слоя ASP.NET Core для добавления функциональных возможностей без введения новых концепций или пакетов SDK для изучения.

- **Привязки**
  - Решение eShopOnContainers содержало *готовый* элемент для отправки подтверждения заказа клиенту по электронной почте. Казалось бы, что в конечном итоге реализовать сторонние API электронной почты, например SendGrid. В ДАПР реализация уведомления по электронной почте была так же простой, как и Настройка привязки ресурса. Не нужно изучать внешние API или пакеты SDK.

> [!NOTE]
> Стандартный блок субъектов не рассматривается в первой версии этой книги. В обновление 1,1 будет включена обширная глава по стандартному блоку субъекта и его интеграции с Ешопондапр.

## <a name="summary"></a>Итоги

В этой главе вы предоставили Справочное приложение Ешопондапр. Это эволюция широко популярных справочных приложений на микрослужбах eShopOnContainers. Ешопондапр заменяет большой объем пользовательских функций с помощью стандартных блоков и компонентов ДАПР, значительно упрощая сложность, необходимые для создания приложения микрослужб.

### <a name="references"></a>Ссылки

- [ешопондапр](https://github.com/dotnet-architecture/eShopOnDapr)

- [eShopOnContainers](https://github.com/dotnet-architecture/eShopOnContainers)

- [Микрослужбы .NET для упакованных в контейнеры приложений .NET](https://dotnet.microsoft.com/download/e-book/microservices-architecture/pdf)

- [Разработка архитектуры приложений Cloud-Native .NET для Azure](https://dotnet.microsoft.com/download/e-book/cloud-native-azure/pdf)

> [!div class="step-by-step"]
> [Назад](getting-started.md)
> [Вперед](state-management.md)
