---
title: Определение последовательности переносимых проектов
description: Крупные приложения обычно не переносятся на новые платформы одновременно, но в ряде небольших этапов. Узнайте, как спланировать шаги для переноса приложения ASP.NET MVC в ASP.NET Core.
author: ardalis
ms.date: 11/13/2020
ms.openlocfilehash: 452898da5839f8979a5e4f9ebf5d4c21b250e1fa
ms.sourcegitcommit: 42d436ebc2a7ee02fc1848c7742bc7d80e13fc2f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "102401763"
---
# <a name="identify-sequence-of-projects-to-migrate"></a>Определение последовательности переносимых проектов

Для решений, использующих несколько интерфейсных приложений, лучше перенести приложения по одному. Например, создайте решение, которое включает только одно приложение внешнего интерфейса и его зависимости, чтобы можно было легко определить объем выполняемой работы. Решения являются упрощенными, и при необходимости можно включать проекты в несколько решений. Воспользуйтесь преимуществами решений в качестве организационного средства при миграции.

Определив приложение ASP.NET для переноса и настроив его зависимые проекты (в идеале в решении), следующим этапом является определение зависимостей платформы и NuGet. Определив все зависимости, простейший подход к миграции — это «снизу вверх» подход. При таком подходе сначала переносится самый низкий уровень зависимостей. Затем переносится следующий уровень зависимостей, вплоть до конца остается только клиентское приложение. На рис. 3-1 показан пример набора проектов, составляющих приложение. Низкоуровневые библиотеки классов находятся внизу, а проект ASP.NET MVC находится в верхней части.

![Зависимости проектов](./media/Figure3-1.png)

**Рис. 3-1**. Граф зависимостей проекта.

Выберите конкретное клиентское приложение, проект ASP.NET MVC 5/Web API 2. Определить его зависимости в решении и сопоставлять их зависимости, пока не появится полный список. Схема, подобная показанной на рисунке 3-1, может быть полезной при сопоставлении зависимостей проекта. Visual Studio может создать [схему зависимостей для вашего решения](/visualstudio/modeling/create-layer-diagrams-from-your-code)в зависимости от используемого выпуска. [Анализатор переносимости .NET](../../standard/analyzers/portability-analyzer.md) также может создавать схемы зависимостей.

На рис. 3-2 показан установщик для [расширения Visual Studio анализатора переносимости .NET](https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityAnalyzer):

![Установка расширения анализатора переносимости .NET](./media/Figure3-2.png)

**Рис. 3-2.** Установщик анализатора переносимости .NET.

Расширение поддерживает Visual Studio 2017 и более поздние версии. После установки его необходимо настроить из меню **анализ**  >  **параметров анализатора переносимости** , как показано на рис. 3-3.

![Настройка расширения анализатора переносимости .NET](./media/Figure3-3.png)

**Рис. 3-3.** Настройка анализатора переносимости .NET.

Анализатор создает подробный отчет для каждой сборки. Отчет:

* Описание совместимости каждого проекта с заданной целевой платформой, например .NET Core 3,1 или .NET Standard 2,0.
* Помогает группам оценивать усилия, необходимые для переноса определенного проекта на определенную целевую платформу.

Сведения об этом анализе рассматриваются в следующем разделе.

После того как вы сопоставили проекты и их связи друг с другом, вы можете определить порядок, в котором будут перенесены проекты. Начните с проектов, которые не имеют зависимостей. Затем проработайте дерево с проектами, которые зависят от этих проектов.

В примере, показанном на рис. 3-1, следует начать с проекта *contoso. utils* , так как он не зависит от других проектов. После этого *contoso. Data* зависит только от "utils". Затем перенесите библиотеку «сборки businesslogic» и, наконец, проект веб-интерфейса ASP.NET «Web». При этом подходе "снизу вверх" хорошо подходит для сравнительно мелких и хорошо организованных приложений, которые можно перенести как единое целое после переноса всех проектов. Более крупные приложения с большей степенью сложности или кодом, который занимает больше времени на миграцию, может потребовать больше добавочных стратегий.

## <a name="unit-tests"></a>Модульные тесты

На предыдущих диаграммах отсутствуют проекты модульных тестов. Будем надеяться, что есть тесты, охватывающие по крайней мере некоторые из существующих поведений библиотек, для которых выполняется перенос.

При наличии модульных тестов рекомендуется сначала преобразовать эти проекты. Необходимо продолжить тестирование изменений в проекте, над которым вы работаете. Помните, что перенос в .NET Core является значительным изменением в базе кода.

.NET Core поддерживает все основные платформы: MSTest, xUnit и NUnit. Если в настоящее время тесты для приложения отсутствуют, рассмотрите возможность создания некоторых тестовых проверок, которые проверяют текущее поведение системы. Преимущество заключается в том, что после завершения миграции можно подтвердить, что поведение приложения остается неизменным.

## <a name="considerations-for-migrating-many-apps"></a>Рекомендации по миграции многих приложений

В некоторых организациях будет несколько различных приложений для миграции, и перенос каждого из них может потребовать тенабле слишком большого количества ресурсов. В таких ситуациях рекомендуется использовать некоторый уровень автоматизации. Шаги, описанные в этой главе, можно автоматизировать. Структурные изменения, такие как различия в файлах проекта и обновления для общих пакетов, могут применяться скриптами. Эти скрипты можно уточнять, так как они выполняются итеративно для нескольких проектов. При каждом запуске изучите, какие действия необходимо выполнить вручную для каждого проекта. Автоматизируйте эти ручные действия, если это возможно. При таком подходе Организация должна увеличиваться быстрее и лучше при переносе приложений с течением времени, в то время как улучшенная поддержка автоматизации выполняется каждый шаг.

Просмотрите общие сведения о том, как использовать этот подход в [дотнетконф презентации Лиззи Галлагхер MasterCard](https://www.youtube.com/watch?v=C-2haqb60No). В этой презентации участвуют пять этапов.

- Перенос сторонних зависимостей NuGet
- Перенос приложений для использования нового формата файла *. csproj*
- Перенос приложений в ASP.NET Core (нацеливание платформа .NET Framework)
- Обновление внутренних зависимостей NuGet для .NET Standard
- Обновите все приложения, чтобы они нацелились на .NET Core 3,1

При автоматизации большого набора приложений это значительно упрощается при соблюдении нормативных руководств по написанию кода и организации проекта. Эффективность автоматизации зависит от этой согласованности. Помимо анализа и переноса файлов проекта, распространенные шаблоны кода могут быть перенесены автоматически. Некоторые примеры шаблонов кода включают различия в объявлении действий контроллера или о том, как они возвращают результаты.

Например, скрипт миграции может искать файлы, соответствующие *Controller.CS* , для строк кода, соответствующих одному из следующих шаблонов:

```csharp
   return new HttpStatusCodeResult(200);
   // or
   return new HttpStatusCodeResult(HttpStatusCode.OK);
```

В ASP.NET Core любая из приведенных выше строк кода может быть заменена на:

```csharp
    return Ok();
```

## <a name="summary"></a>Итоги

Лучшим подходом к переносу большого платформа .NET Framework приложения в .NET Core является:

1. Выявление зависимостей проекта.
1. Анализируйте, что требуется для переноса каждого проекта.
1. Начните с нижнего края.

Анализатор переносимости .NET можно использовать для определения того, как совместимые существующие библиотеки могут быть назначены целевым платформам. Автоматические тесты помогут гарантировать, что при переносе приложения не будут введены критические изменения. Эти тестовые проекты должны быть между первыми перенесенными проектами.

## <a name="references"></a>Ссылки

- [Перенос кода в .NET Core из .NET Framework](../../core/porting/index.md)
- [Анализатор переносимости .NET](../../standard/analyzers/portability-analyzer.md)
- [Канал 9. Краткий обзор анализатора переносимости .NET (видео)](https://channel9.msdn.com/Blogs/Seth-Juarez/A-Brief-Look-at-the-NET-Portability-Analyzer)
- [2 года, 200 приложений: миграция .NET Core в масштабе (видео)](https://www.youtube.com/watch?v=C-2haqb60No)

>[!div class="step-by-step"]
>[Назад](migrate-large-solutions.md)
>[Вперед](understand-update-dependencies.md)
