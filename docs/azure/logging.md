---
title: Ведение журнала с помощью пакета Azure SDK для .NET
description: Узнайте, как включить ведение журнала с помощью пакета клиентских библиотек Azure SDK для .NET
ms.date: 03/20/2020
ms.custom: azure-sdk-dotnet
ms.author: casoper
author: camsoper
ms.openlocfilehash: 5a1fb35aeca034a7cdd1caa813a3839919a5f926
ms.sourcegitcommit: cb27c01a8b0b4630148374638aff4e2221f90b22
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/09/2020
ms.locfileid: "86174864"
---
# <a name="logging-with-the-azure-sdk-for-net"></a>Ведение журнала с помощью пакета Azure SDK для .NET

Клиентские библиотеки [пакета Azure SDK](https://azure.microsoft.com/downloads/) для .NET включают возможность ведения журнала операций клиентской библиотеки. Это позволяет отслеживать запросы ввода-вывода, которые клиентские библиотеки отправляют службам Azure, и ответы на эти запросы. Как правило, журналы используются для отладки или диагностики проблем связи. В этой статье описываются три подхода к включению ведения журнала с помощью пакета Azure SDK для .NET:

- Ведение журнала в окне консоли
- Ведение журнала с помощью трассировки диагностики .NET
- Настраиваемое ведение журнала

> [!IMPORTANT]
> Эта статья применяется к клиентским библиотекам, использующим последние версии пакета Azure SDK для .NET. Чтобы узнать, поддерживается ли библиотека, обратитесь к списку [последних выпусков Azure SDK](https://azure.github.io/azure-sdk/releases/latest/index.html). Если приложение использует более раннюю версию клиентских библиотек пакета Azure SDK, ознакомьтесь с конкретными инструкциями в соответствующей документации службы.

## <a name="log-information"></a>Сведения о журнале

Пакет SDK записывает в журнал следующие сведения, выполняя очистку значений параметров запроса и заголовка для удаления персональных данных.

Запись HTTP-запроса в журнале:

- Уникальный идентификатор
- Метод HTTP
- URI
- Заголовки исходящего запроса

Запись HTTP-ответа в журнале:

- Длительность операции ввода-вывода (прошедшее время)
- Request ID (ИД запроса)
- HTTP status code (Код состояния HTTP)
- Описание причины HTTP
- Заголовки ответов
- Сведения об ошибке, если применимо

Для содержимого запроса и ответа:

- Поток содержимого в виде текста или байтов в зависимости от заголовка Content-Type.
     > [!NOTE} Ведение журнала для содержимого по умолчанию отключено. Чтобы включить его, задайте для `Diagnostics.IsLoggingContentEnabled` значение `true` в `ClientOptions`.

Обычно используется один из трех следующих уровней ведения журнала:

- "Информационный" — для событий запроса и ответа
- "Предупреждение" — для ошибок
- "Подробный" — для записи подробных сообщений и содержимого

## <a name="enable-logging-with-built-in-methods"></a>Включение ведения журнала с помощью встроенных методов

Клиентские библиотеки пакета Azure SDK для .NET регистрируют события в трассировке событий Windows (ETW) с помощью [класса `EventSource`](/dotnet/api/system.diagnostics.tracing.eventsource), что является типичным для .NET. Источники событий позволяют использовать структурированное ведение журнала в коде приложения с минимальным влиянием на производительность. Чтобы получить доступ к этим журналам событий, необходимо зарегистрировать прослушиватели событий.

Пакет SDK включает класс `Azure.Core.Diagnostics.AzureEventSourceListener` (определенный в пакете NuGet Azure.Core), который содержит два статических метода, упрощающих подробное ведение журнала для приложения .NET: `CreateConsoleLogger` и `CreateTraceLogger`. Эти методы принимают необязательный параметр, задающий уровень ведения журнала.

### <a name="log-to-the-console-window"></a>Ведение журнала в окне консоли

Основным принципом клиентских библиотек пакета Azure SDK для .NET является упрощение просмотра подробных журналов в режиме реального времени. Метод `CreateConsoleLogger` позволяет отправлять журналы в окно консоли с помощью одной строки кода:

```csharp
using AzureEventSourceListener listener = AzureEventSourceListener.CreateConsoleLogger();
```

### <a name="log-to-diagnostic-traces"></a>Ведение журнала с помощью трассировки диагностики

При реализации прослушивателей трассировки можно использовать метод `CreateTraceLogger` для входа в стандартный механизм трассировки событий .NET ([`System.Diagnostics.Tracing`](/dotnet/api/system.diagnostics.tracing)). Дополнительные сведения о трассировке событий в .NET см. в разделе [Прослушиватели трассировки](/dotnet/framework/debug-trace-profile/trace-listeners). В этом примере задается уровень детализации журнала:

```csharp
using AzureEventSourceListener listener = AzureEventSourceListener.CreateTraceLogger(EventLevel.Verbose);
```

## <a name="configure-custom-logging"></a>Настраиваемое ведение журнала

Как упоминалось выше, для получения сообщений журнала из пакета SDK Azure для .NET необходимо зарегистрировать прослушиватели событий. Если вам не требуется реализовывать подробное ведение журнала с помощью одного из упрощенных методов, описанных выше, можно создать экземпляр класса `AzureEventSourceListener` и передать ему функцию обратного вызова, написанную вами. Эта функция будет получать сообщения журнала, и вы можете обрабатывать их так, как это необходимо. Кроме того, при создании экземпляра можно указать включаемые уровни сообщения журнала.

В следующем примере создается прослушиватель событий, который отправляет события журнала в консоль с использованием настраиваемого ведения журнала и фильтрует основные события Azure на уровне "Подробный".

```csharp
using AzureEventSourceListener listener = new AzureEventSourceListener((e, message) =>
    {
        // Only log messages from Azure-Core event source
        if (e.EventSource.Name == "Azure-Core")
        {
            Console.WriteLine($"{DateTime.Now} {message}");
        }
    },
    level: EventLevel.Verbose);
```

## <a name="next-steps"></a>Следующие шаги

- [Включение функции ведения журналов диагностики для приложений в Службе приложений Azure](/azure/app-service/troubleshoot-diagnostic-logs)
- Просмотрите параметры [ведения журнала безопасности и аудита в Azure](/azure/security/fundamentals/log-audit)
- Узнайте о том, как работать с [журналами платформы Azure](/azure/azure-monitor/platform/platform-logs-overview)
- Ознакомьтесь с дополнительными сведениями о [Ведении журнала и трассировке в .NET Core](/dotnet/core/diagnostics/logging-tracing)
