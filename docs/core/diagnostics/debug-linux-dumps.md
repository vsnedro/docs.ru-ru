---
title: Отладка дампов Linux
description: В этой статье вы узнаете, как выполнять сбор и анализ дампов из сред Linux.
ms.date: 08/27/2020
ms.openlocfilehash: d62295e165f56e32ef73ab628ca9ebd77a4435d1
ms.sourcegitcommit: 43d5aca3fda42bad8843f6c4e72f6bd52daa55f1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/09/2020
ms.locfileid: "89598306"
---
# <a name="debug-linux-dumps"></a>Отладка дампов Linux

**Эта статья относится к:** ✔️ пакету SDK для .NET Core 3.0 и более поздних версий

## <a name="collect-dumps-on-linux"></a>Сбор дампов в Linux

Два рекомендуемых способа сбора дампов в Linux — это средства [`dotnet-dump`](dotnet-dump.md) или [`createdump`](https://github.com/dotnet/runtime/blob/master/docs/design/coreclr/botr/xplat-minidump-generation.md).

### <a name="managed-dumps-with-dotnet-dump"></a>Управляемые дампы с помощью `dotnet-dump`

Средство [`dotnet-dump`](dotnet-dump.md) просто в использовании и не зависит от каких-либо отладчиков машинного кода. `dotnet-dump` работает на различных платформах Linux (например, Alpine или ARM32/ARM64), где традиционные средства отладки могут быть недоступны. Однако `dotnet-dump` фиксирует только управляемое состояние, поэтому его нельзя использовать для отладки в машинном коде. Дампы, собранные `dotnet-dump`, анализируются в среде с той же ОС и архитектурой, в которой был создан дамп. Средство [`dotnet-gcdump`](dotnet-gcdump.md) можно использовать в качестве альтернативного варианта, которое фиксирует только сведения о куче GC, но создает дампы, которые можно проанализировать в Windows.

### <a name="core-dumps-with-createdump"></a>Дампы ядра с помощью `createdump`

Вместо `dotnet-dump`, создающего только управляемые дампы, [`createdump`](https://github.com/dotnet/runtime/blob/master/docs/design/coreclr/botr/xplat-minidump-generation.md) рекомендуется для создания основных дампов в Linux, содержащих как собственные, так и управляемые данные. Другие средства, такие как gdb или gcore, можно также использовать для создания основных дампов, однако они могут не учитывать состояние, необходимое для управляемой отладки, что приводит к неизвестному типу или именам функций во время анализа.

Средства `createdump` устанавливаются вместе со средой выполнения .NET Core. Их можно найти вместе с libcoreclr.so (обычно в папке "/usr/share/dotnet/shared/Microsoft.NETCore.App/[версия]"). Средство использует идентификатор процесса для получения дампа в качестве основного аргумента, а также может принимать необязательные параметры, указывающие, какой тип дампа следует сохранять (по умолчанию используется малый дамп с кучей). Возможны следующие значения.

- **`<input-filename>`**

  Исходный файл трассировки для преобразования. По умолчанию используется значение *trace.nettrace*.

### <a name="options"></a>Параметры

- **`-f|--name <output-filename>`**

  Файл, в который записывается дамп. Значение по умолчанию — "/tmp/coredump.%p", где % p — это идентификатор целевого процесса.

- **`-n|--normal`**

  Создание минидампа.

- **`-h|--withheap`**

  Создание минидампа с кучей (по умолчанию).

- **`-t|--triage`**

  Создание минидампа для рассмотрения.

- **`-u|--full`**

  Создайте полного дампа ядра.

- **`-d|--diag`**

  Включение диагностических сообщений.

Обратите внимание, что для сбора дампов ядра требуется либо возможность `SYS_PTRACE`, либо `createdump` необходимо запустить с помощью sudo или su.

## <a name="analyze-dumps-on-linux"></a>Анализ дампов в Linux

Как управляемые дампы, собранные с помощью `dotnet-dump`, так и дампы ядра, собранные с помощью `createdump`, можно проанализировать с помощью средства `dotnet-dump`, используя команду `dotnet-dump analyze`. `dotnet dump` требует, чтобы среда, в которой анализируется дамп, использовала ту же ОС и архитектуру, что и среда, в которой был записан дамп.

Кроме того, [LLDB](https://lldb.llvm.org/) можно использовать для анализа основных дампов в Linux, что позволяет выполнять анализ как управляемых, так и собственных кадров. LLDB использует расширение SOS для отладки управляемого кода. Средство [`dotnet-sos`](dotnet-sos.md) CLI можно использовать для установки SOS, в котором содержится [много полезных команд](https://github.com/dotnet/diagnostics/blob/master/documentation/sos-debugging-extension.md) для отладки управляемого кода. Чтобы проанализировать дампы .NET Core, для LLDB и SOS требуются следующие двоичные файлы .NET Core из среды, в которой был создан дамп.

1. libmscordaccore.so
2. libcoreclr.so
3. dotnet (узел, используемый для запуска приложения)

В большинстве случаев эти двоичные файлы можно скачать с помощью средства [`dotnet-symbol`](dotnet-symbol.md). Если необходимые двоичные файлы невозможно загрузить с помощью `dotnet-symbol` (например, если используется частная версия .NET Core, построенная на основе источника), может потребоваться скопировать перечисленные выше файлы из среды, в которой был создан дамп. Если файлы не расположены вместе с файлом дампа, можно использовать команду LLDB/SOS `setclrpath <path>`, чтобы задать путь, из которого они должны быть загружены, и `setsymbolserver -directory <path>`, чтобы задать путь для поиска файлов символов.

После того как необходимые файлы будут доступны, можно загрузить дамп в LLDB, указав узел dotnet в качестве исполняемого файла для отладки:

```console
lldb --core <dump-file> <host-program>
```

В приведенной выше командной строке `<dump-file>` — это путь к дампу для анализа, а `<host-program>` — это собственная программа, запускающая приложение .NET Core. Обычно это двоичный файл `dotnet`, если приложение не является автономным. В этом случае это имя приложения без расширения DLL.

После запуска LLDB может потребоваться использовать команду `setsymbolserver`, чтобы указать правильное расположение символов (`setsymbolserver -ms`, чтобы использовать сервер символов корпорации Майкрософт, или `setsymbolserver -directory <path>` для указания локального пути). Собственные символы можно загрузить, запустив `loadsymbols`. На этом этапе для анализа дампа можно использовать [команды SOS](https://github.com/dotnet/diagnostics/blob/master/documentation/sos-debugging-extension.md).

## <a name="see-also"></a>См. также раздел

- [dotnet-sos](dotnet-sos.md) для получения дополнительных сведений об установке расширения SOS.
- [dotnet-symbol](dotnet-symbol.md) для получения дополнительных сведений об установке и использовании средства скачивания символов.
- [Репозиторий диагностики .NET Core](https://github.com/dotnet/diagnostics/blob/master/documentation/) для получения дополнительных сведений об отладке, включая полезные часто задаваемые вопросы.
- [Установка LLDB](https://github.com/dotnet/diagnostics/blob/master/documentation/sos.md#getting-lldb) для получения инструкций по установке LLDB в Linux или Mac.
