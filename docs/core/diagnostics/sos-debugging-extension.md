---
title: Расширение отладки SOS для .NET
description: Сведения о расширении отладки SOS для .NET, которое предоставляет информацию о внутренней среде CLR.
ms.date: 12/21/2020
helpviewer_keywords:
- debugging extensions
- SOS debugging extensions
- SOS.dll
ms.openlocfilehash: a24b946c4ffda59e17f61c065d2846dc1a6effe0
ms.sourcegitcommit: c0b803bffaf101e12f071faf94ca21b46d04ff30
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/24/2020
ms.locfileid: "97764972"
---
# <a name="sos-debugging-extension"></a>Расширение отладки SOS

Расширение отладки SOS позволяет просматривать сведения о коде, выполняемом в среде выполнения .NET Core, для активных процессов и дампов. Это расширение предустанавливается с помощью [dotnet-dump](dotnet-dump.md) и [Windbg/dbg](/windows-hardware/drivers/debugger/debugger-download-tools). Также его можно [скачать](dotnet-sos.md) для использования с LLDB.  С помощью расширения отладки SOS можно получать сведения об управляемой куче, искать повреждения кучи, отображать внутренние типы данных, используемые средой выполнения, и просматривать информацию о любом управляемом коде, запущенном в среде выполнения.

## <a name="syntax"></a>Синтаксис

### <a name="windows"></a>Windows

`![command] [options]`

### <a name="linux-and-macos"></a>Linux и macOS

`sos [command] [options]`

У многих команд в lldb есть псевдонимы или ярлыки:

`clrstack [options]`

## <a name="commands"></a>Команды

Следующую таблицу команд можно также просмотреть в разделе **Справка** или с помощью команды **soshelp**.  Справку по отдельным командам можно просмотреть с помощью команды `soshelp <command>`.

|Get-Help|Описание|
|-------------|-----------------|
|**bpmd** [ **-nofuturemodule**] [\<*module name*> \<*method name*>] [ **-md** <`MethodDesc`>] **-list** **-clear** \<*pending breakpoint number*> **-clearall**|Создает точку останова в указанном методе указанного модуля.<br /><br /> Если указанные модуль и метод не загружены, команда ожидает уведомления о загрузке модуля и выполнении JIT-компиляции, прежде чем создавать точку останова.<br /><br /> Списком ожидающих точек останова можно управлять с помощью параметров **-list**, **-clear** и **-clearall**.<br /><br /> Параметр **-list** создает список всех ожидающих точек останова. Если ожидающая точка останова имеет идентификатор модуля, отличный от нуля, эта точка останова связана с функцией в конкретном загруженном модуле. Если ожидающая точка останова имеет нулевой идентификатор модуля, такая точка останова применяется к еще не загруженным модулям.<br /><br /> Чтобы удалить из списка ожидающие точки останова, следует использовать параметр **-clear** или **-clearall**.|
|**CLRStack** [ **-a**] [ **-l**] [ **-p**] [ **-n**] [ **-f**] [ **-r**] [ **-all**]|Обеспечивает трассировку стека только для управляемого кода.<br /><br /> Параметр **-p** задает отображение аргументов управляемой функции.<br /><br /> Параметр **-l** задает отображение сведений о локальных переменных в кадре. Расширение отладки SOS не позволяет извлекать локальные имена, поэтому выходные данные для локальных имен выводятся в формате \<*local address*> **=** \<*value*>.<br /><br /> Параметр **-a** заменяет собой комбинацию параметров **-l** и **-p**.<br /><br /> Параметр **-n** отключает отображение имен исходных файлов и номеров строк. Если для отладчика указан параметр "SYMOPT_LOAD_LINES", расширение отладки SOS ищет символы для каждого управляемого кадра и в случае успеха отображает соответствующее имя исходного файла и номер строки. Такое поведение можно отключить, задав параметр **-n** (без номеров строк).<br /><br />Параметр **-f** (полный режим) отображает кадры машинного кода, в которых используются управляемые кадры, а также имя сборки и смещение функции для управляемых кадров.  Этот параметр не отображает машинные кадры при использовании совместно с `dotnet-dump`.<br /><br />Параметр **-r** создает дампы регистров для каждого кадра стека.<br /><br />Параметр **-all** создает дампы для стеков всех управляемых потоков.|
|**COMState**|Выдает список моделей контейнера COM для каждого потока и указатель `Context`, если он имеется. Эта команда поддерживается только в Windows.|
|**DumpArray** [ **-start** \<*startIndex*>] [ **-length** \<*length*>] [ **-details**] [ **-nofields**] \<*array object address*><br /><br /> -или-<br /><br /> **DA** [ **-start** \<*startIndex*>] [ **-length** \<*length*>] [ **-detail**] [ **-nofields**] *адрес объекта массива*>|Анализирует элементы объекта массива.<br /><br /> Параметр **-start** задает индекс, начиная с которого отображаются элементы.<br /><br /> Параметр **-length** задает количество отображаемых элементов.<br /><br /> Параметр **-details** задает отображение сведений об элементе в формате **DumpObj** и **DumpVC**.<br /><br /> Параметр **-nofields** отменяет отображение массивов. Этот параметр можно использовать, только если задан параметр **-detail**.|
|**DumpAsync** (**dumpasync**) [ **-mt** \<*MethodTable address*>] [ **-type** \<*partial type name*>] [ **-waiting**] [ **-roots**]|Команда DumpAsync просматривает кучу, собранную сборщиком мусора, в поисках объектов, представляющих асинхронные конечные автоматы, которые были созданы при передаче состояния асинхронного метода в кучу.  Эта команда распознает асинхронные конечные автоматы, определяемые как `async void`, `async Task`, `async Task<T>`, `async ValueTask` и `async ValueTask<T>`.<br /><br />В выходных данных содержится блок сведений для каждого найденного объекта асинхронного конечного автомата. Они могут включать:<br />—строку для типа объекта асинхронного конечного автомата, включающую адрес его структуры MethodTable, адрес его объекта, его размер и имя его типа;<br />— строку для имени типа конечного автомата, содержащуюся в объекте;<br />— список всех полей конечного автомата;<br />— строку для продолжения из этого объекта конечного автомата, если таких объектов зарегистрировано несколько;<br />— обнаруженные корневые элементы сборки мусора для этого объекта асинхронного конечного автомата.<br />|
|**DumpAssembly** \<*assembly address*>|Отображает сведения о сборке.<br /><br /> Команда **DumpAssembly** выводит список модулей, если они существуют.<br /><br /> Адрес сборки можно получить с помощью команды **DumpDomain**.|
|**DumpClass** \<*EEClass address*>|Отображает сведения о структуре `EEClass`, связанной с типом.<br /><br /> Команда **DumpClass** отображает значения статических полей, но значения нестатических полей не отображаются.<br /><br /> Используйте команду **DumpMT**, **DumpObj**, **Name2EE** или **Token2EE**, чтобы получить адрес структуры `EEClass`.|
|**DumpDomain** [\<*domain address*>]|Перечисляет все объекты <xref:System.Reflection.Assembly>, загруженные по указанному адресу объекта <xref:System.AppDomain>.  При вызове без параметров команда **DumpDomain** выводит список всех объектов <xref:System.AppDomain> в составе процесса. Поскольку в .NET Core есть только один объект <xref:System.AppDomain>, команда **DumpDomain** возвращает только один объект.|
|**DumpHeap** [ **-stat**] [ **-strings**] [ **-short**] [ **-min** \<*size*>] [ **-max** \<*size*>] [ **-thinlock**] [ **-startAtLowerBound**] [ **-mt** \<*MethodTable address*>] [ **-type** \<*partial type name*>][*start* [*end*]]|Отображает сведения о куче со сборкой мусора и статистику сбора мусора по объектам.<br /><br /> В случае чрезмерной фрагментации кучи сборщика мусора команда **DumpHeap** выдает соответствующее предупреждение.<br /><br /> Параметр **-stat** ограничивает выводимую информацию статистической сводкой по типам.<br /><br /> Параметр **-strings** ограничивает выводимую информацию статистической сводкой по значениям строк.<br /><br /> Параметр **-short** ограничивает вывод только адресом каждого объекта. Благодаря такому подходу можно легко передавать результат из одной команды отладчика в другую команду с целью автоматизации.<br /><br /> Параметр **-min** задает пропуск объектов, размер которых меньше значения параметра `size`, указанного в байтах.<br /><br /> Параметр **-max** задает пропуск объектов, размер которых больше значения параметра `size`, указанного в байтах.<br /><br /> Параметр **-thinlock** сообщает о блокировках ThinLock.  Дополнительные сведения см. в описании команды **SyncBlk**.<br /><br /> Параметр `-startAtLowerBound` приводит к тому, что обход кучи начинается с нижней границы предоставленного диапазона адресов. На стадии планирования куча часто является неанализируемой, поскольку объекты перемещаются. Этот параметр заставляет **DumpHeap** начать проверку с указанной нижней границы. Чтобы задействовать этот параметр, необходимо указать адрес допустимого объекта в качестве нижней границы. Можно отобразить память по адресу неверного объекта, чтобы вручную найти следующую таблицу методов. Если сборка мусора выполняется в момент вызова `memcopy`, также можно найти адрес следующего объекта путем добавления размера к начальному адресу, который указан как параметр.<br /><br /> Параметр **-mt** задает вывод только тех объектов, которые соответствуют указанной структуре `MethodTable`.<br /><br /> Параметр **-type** задает вывод только тех объектов, имя типа которых содержит указанную строку.<br /><br /> Параметр `start` задает составление списка, начиная с указанного адреса.<br /><br /> Параметр `end` прекращает составление списка на указанном адресе.|
|**DumpIL** \<*Managed DynamicMethod object*> &#124;       \<*DynamicMethodDesc pointer*> &#124;        \<*MethodDesc pointer*>|Отображает язык CIL, связанный с управляемым методом.<br /><br /> Динамический язык MSIL генерируется иначе, чем язык MSIL, загруженный из сборки. Динамический язык CIL ссылается на объекты в массиве управляемых объектов, а не на токены метаданных.|
|**DumpLog** [ **-addr** \<*addressOfStressLog*>] [<*имя_файла*>]|Записывает в указанный файл содержимое журнала нагрузок, хранящегося в памяти. Если имя не указано, команда создает файл "StressLog.txt" в текущем каталоге.<br /><br /> Хранящийся в памяти журнал нагрузок помогает при диагностике сбоев, вызываемых нагрузкой, без использования блокировки или ввода-вывода. Чтобы разрешить ведение журнала нагрузок, задайте следующие значения в разделе HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\\.NETFramework.<br /><br /> (DWORD) StressLog = 1<br /><br /> (DWORD) LogFacility = 0xffffffff<br /><br /> (DWORD) StressLogSize = 65536<br /><br /> С помощью необязательного параметра `-addr` можно указать журнал нагрузки, отличный от журнала по умолчанию.|
|**DumpMD** \<*MethodDesc address*>|Отображает сведения о структуре `MethodDesc`, находящейся по указанному адресу.<br /><br /> Чтобы получить адрес структуры `MethodDesc` из управляемой функции, можно использовать команду **IP2MD**.|
|**DumpMT** [ **-MD**] \<*MethodTable address*>|Отображает сведения о таблице методов, расположенной по указанному адресу. Параметр **-MD** задает вывод списка всех методов, определенных вместе с объектом.<br /><br /> Каждый управляемый объект содержит указатель на таблицу методов.|
|**DumpModule** [ **-mt**] \<*Module address*>|Отображает информацию о модуле, находящемся по указанному адресу. Параметр **-mt** задает отображение типов, определенных в модуле, и типов, на которые имеются ссылки в модуле<br /><br /> Чтобы получить адрес модуля, можно использовать команду **DumpDomain** или **DumpAssembly**.|
|**DumpObj** [ **-nofields**] \<*object address*><br /><br /> -или-<br /><br /> **DO** \<*object address*>|Отображает сведения об объекте, находящемся по указанному адресу. Команда **DumpObj** отображает список полей, сведения о структуре `EEClass`, таблицу методов и размер объекта.<br /><br /> Чтобы получить адрес объекта, можно использовать команду **DumpStackObjects**.<br /><br /> Команду **DumpObj** можно выполнять для полей типа `CLASS`, поскольку они также являются объектами.<br /><br /> Параметр `-`**nofields** не предотвращает отображение полей объекта, что удобно для таких объектов, как String.|
|**DumpRuntimeTypes**|Отображает объекты типы среды выполнения в куче сборщика мусора и выводит список связанных с ними имен типов и таблиц методов.|
|**DumpStack** [ **-EE**] [ **-n**] [`top` *stack* [`bottom` *stac*`k`]]|Отображает трассировку стека.<br /><br /> Параметр **-EE** команды **DumpStack** задает отображение только управляемых функций. Параметры `top` и `bottom` позволяют ограничить состав отображаемых кадров стека на платформах x86.<br /><br /> Параметр **-n** отключает отображение имен исходных файлов и номеров строк. Если для отладчика указан параметр "SYMOPT_LOAD_LINES", расширение отладки SOS ищет символы для каждого управляемого кадра и в случае успеха отображает соответствующее имя исходного файла и номер строки. Такое поведение можно отключить, задав параметр **-n** (без номеров строк).<br /><br />
|**DumpSig** \<*sigaddr*> \<*moduleaddr*>|Отображает сведения о структуре `Sig`, находящейся по указанному адресу.|
|**DumpSigElem** \<*sigaddr*> \<*moduleaddr*>|Отображает единственный элемент объекта сигнатуры. В большинстве случаев следует использовать **DumpSig** для просмотра отдельных объектов сигнатур. Тем не менее, если сигнатура каким-либо образом повреждена, можно использовать **DumpSigElem** для чтения ее допустимых частей.|
|**DumpStackObjects** [ **-verify**] [`top` *stack* [`bottom` *stack*]]<br /><br /> -или-<br /><br /> **DSO** [ **-verify**] [`top` *stack* [`bottom` *stack*]]|Отображает все управляемые объекты, обнаруженные в пределах границ текущего стека.<br /><br /> Параметр **-verify** задает проверку каждого нестатического поля `CLASS` в поле объекта.<br /><br /> Для определения значений локальных переменных и параметров используйте команду **DumpStackObject** вместе с командами трассировки стека, такими как **K** (windbg) или **bt** (lldb) и **clrstack**.|
|**DumpVC** \<*MethodTable address*> \<*Address*>|Отображает сведения о полях класса значений, находящегося по указанному адресу.<br /><br /> Параметр **MethodTable** позволяет команде **DumpVC** правильно интерпретировать поля. В классах значений первое поле не содержит таблицу методов.|
|**EEHeap** [ **-gc**] [ **-loader**]|Отображение сведений о памяти процесса, занимаемой внутренними структурами данных среды выполнения.<br /><br /> Параметры **-gc** и **-loader** ограничивают выходные данные этой команды только сведениями о структурах данных сборщика мусора и загрузчика.<br /><br /> Сведения о сборщике мусора включает в себя диапазоны каждого сегмента в управляемой куче.  Если указатель попадает в диапазон сегмента, заданный параметром **-gc**, значит, он является указателем объекта.|
|**EEStack** [ **-short**] [ **-EE**]|Выполняет команду **DumpStack** для всех потоков в составе процесса.<br /><br /> Параметр **-EE** передается непосредственно в команду **DumpStack**. Параметр **-short** ограничивает выходные данные следующими видами потоков.<br /><br />Потоки с блокировкой.<br /><br />Потоки, остановленные для сбора мусора.<br /><br /> Потоки, которые в данный момент находятся в управляемом коде.|
|**EHInfo** [\<*MethodDesc address*>] [\<*Code address*>]|Отображает блоки обработки исключений в указанном методе.  Данная команда выводит адреса кода и смещения для блока предложений (блока `try`) и блока обработчика (блока `catch`).|
|**FAQ**|Отображает вопросы и ответы.  Не поддерживается в `dotnet-dump`.|
|**FinalizeQueue** [ **-detail**] &#124; [ **-allReady**] [ **-short**]|Отображает все объекты, зарегистрированные для заключительной обработки.<br /><br /> Параметр **-detail** задает вывод дополнительной информации обо всех блоках `SyncBlocks`, которые необходимо очистить, и оболочках `RuntimeCallableWrappers`, ожидающих очистки. Поток завершения кэширует и очищает обе эти структуры данных.<br /><br /> Параметр `-allReady` отображает все объекты, которые уже готовы к завершению без учета того, помечены они для сборки мусора или будут помечены следующей сборкой мусора. Объекты, отсутствующие в списке "готовые для завершения", — это завершаемые объекты, которые больше не являются корневым. Применение этого параметра может быть очень затратным, поскольку проверяется, все ли объекты в завершаемых очередях по-прежнему являются корневыми.<br /><br /> Параметр `-short` ограничивает вывод адресом каждого объекта. При использовании в сочетании с **-allReady** он перечисляет все объекты с методом завершения, которые больше не являются корневыми. При независимом использовании создает список всех объектов в очередях "поддерживающие завершение" и "готовые для завершения".|
|**FindAppDomain** \<*Object address*>|Определяет домен приложения для объекта, находящегося по указанному адресу.|
|**FindRoots** **-gen** \<*N*> &#124; **-gen any** &#124;\<*object address*>|Вызывает остановку отладчика в отлаживаемом объекте следующей коллекции заданного поколения. Эффект сбрасывается, как только произойдет останов. Чтобы остановиться на следующей коллекции, необходимо повторное выполнение команды. Форма *\<object address>* этой команды используется после возникновения останова, вызванного **-gen** или **-gen any**. В этот момент отлаживаемый объект находится в правильном состоянии для **FindRoots** для идентификации корневых элементов для объектов из поколений, уничтожаемых в данный момент. Поддерживается только в Windows.|
|**GCHandles** [ **-perdomain**]|Отображает статистику дескрипторов сборщика мусора в составе процесса.<br /><br /> Параметр **-perdomain** упорядочивает статистику по доменам приложений.<br /><br /> Команда **GCHandles** служит для поиска утечек памяти, вызываемых утечками дескрипторов сборщика мусора. Например, утечка памяти происходит, когда в коде продолжает использоваться большой массив, поскольку на него еще указывает строгий дескриптор сборщика мусора, а сам дескриптор удаляется без освобождения памяти. <br /><br />Поддерживается только в Windows.|
|**GCHandleLeaks**|Ищет в памяти ссылки на строгие и закрепленные дескрипторы сборщика мусора в рамках процесса и отображает результаты. При обнаружении дескриптора команда **GCHandleLeaks** отображает адрес ссылки. Если дескриптор в памяти не найден, выдается уведомление. Поддерживается только в Windows.|
|**GCInfo** \<*MethodDesc address*>\<*Code address*>|Отображает данные, показывающие, содержатся ли управляемые объекты в регистрах или ячейках стека. Если производится сбор мусора, сборщик должен знать расположение ссылок на объекты, чтобы их можно было обновить новыми значениями указателей объектов.|
|**GCRoot** [ **-nostacks**] [ **-all**] \<*Object address*>|Отображает информацию о ссылках (или корневых элементах) объекта, находящегося по указанному адресу.<br /><br /> Команда **GCRoot** анализирует всю управляемую кучу и таблицу дескрипторов в поисках дескрипторов, находящихся в других объектах или в стеке. Затем каждый стек просматривается в поисках указателей на объекты; также просматривается и очередь метода завершения.<br /><br /> Данная команда не определяет, является ли корень стека допустимым или удален ли он. Используйте команды **clrstack** и **U**, чтобы дизассемблировать кадр, к которому принадлежит локальное значение или значение аргумента, и определить, используется ли еще корень стека.<br /><br /> Параметр **-nostacks** ограничивает поиск дескрипторами сборщика мусора и достижимыми объектами.<br /><br /> Параметр **-all** задает отображение всех корневых элементов, а не только уникальных.|
|**GCWhere**  *\<object address>*|Отображает расположение и размер переданного аргумента в куче для сборки мусора. Если аргумент располагается в управляемой куче, но не является адресом допустимого объекта, размер отображается как "0" (нуль).|
|**Help** (**soshelp**) [\<*command*>] [`faq`]|Отображает все доступные команды при отсутствии параметров или, если указана команда, — подробные справочные сведения об этой команде.<br /><br /> Параметр `faq` задает отображение ответов на часто задаваемые вопросы.|
|**HeapStat** [ **- inclUnrooted** &#124; **-iu**]|Отображает размеры поколений для каждой кучи и общий объем свободного места в каждом поколении каждой кучи. Если указан параметр -**inclUnrooted**, отчет содержит сведения об управляемых объектах в куче для сборки мусора, которая больше не является корневой. Поддерживается только в Windows.|
|**HistClear**|Освобождает все ресурсы, используемые семейством команд `Hist`.<br /><br /> Как правило, прямой вызов `HistClear` не требуется, так как каждая команда `HistInit` очищает предыдущие ресурсы.|
|**HistInit**|Инициализирует структуры SOS из журнала нагрузки, сохраненного в отлаживаемом объекте.|
|**HistObj** *<адрес_объекта>*|Проверяет все записи журнала перемещения нагрузки и отображает цепочку перемещений сборки мусора, которые могли привести к адресу, переданному в качестве аргумента.|
|**HistObjFind** *<адрес_объекта>*|Отображает все записи журнала, ссылающиеся на объект по указанному адресу.|
|**HistRoot** *\<root>*|Отображает сведения о повышениях и перемещениях указанного корневого элемента.<br /><br /> Корневое значение можно использовать для отслеживания движения объекта в сборках мусора.|
|**IP2MD** (**ip2md**) \<*Code address*>|Отображает структуру `MethodDesc` по указанному адресу в коде после его JIT-компиляции.|
|**ListNearObj** (**lno**) *<адрес_объекта>*|Отображает объекты перед указанным адресом и после него. Команда находит в куче для сборки мусора адрес, напоминающий допустимое начало управляемого объекта (в зависимости от таблицы допустимых методов), и объект, следующий за адресом аргумента. Поддерживается только в Windows.|
|**MinidumpMode** [**0**] [**1**]|Запрещает выполнение небезопасных команд при использовании минидампа.<br /><br /> Значение **0** отключает этот режим, а значение **1** включает его. По умолчанию значение **MinidumpMode** равно **0**.<br /><br /> Минидампы, созданные с помощью команды **.dump /m** или **.dump**, содержат ограниченный набор данных, связанных с CLR, и позволяют корректно выполнять лишь часть команд SOS. Выполнение некоторых команд может завершаться сбоем из-за непредвиденных ошибок, вызываемых тем, что требуемые области памяти не сопоставлены или сопоставлены лишь частично. Данный параметр блокирует запуск небезопасных команд для минидампов. <br /><br />Поддерживается только в WinDbg.|
|**Name2EE** (**name2ee**) \<*module name*> \<*type or method name*><br /><br /> -или-<br /><br /> **Name2EE** \<*module name*> **!** \<*type or method name*>|Отображает структуры `MethodTable` и `EEClass` для указанного типа или метода в указанном модуле.<br /><br /> Указанный модуль должен быть загружен в процесс.<br /><br /> Чтобы получить правильное имя типа, просмотрите модуль с помощью [Ildasm.exe (дизассемблера IL)](../../../docs/framework/tools/ildasm-exe-il-disassembler.md). Можно также передать `*` в качестве параметра имени модуля, чтобы просматривались все загруженные управляемые модули. Параметр *имя модуля* может также содержать имя отладчика для модуля, например `mscorlib` или `image00400000`.<br /><br /> Данная команда поддерживает следующий синтаксис отладчика Windows: <`module`>`!`<`type`>. Имя типа должно быть полным.|
|**ObjSize** [\<*Object address*>] &#124; [ **-aggregate**] [ **-stat**]|Отображает размер указанного объекта. Если параметры не указаны, команда **ObjSize** отображает размеры всех объектов, найденных в управляемых потоках, все дескрипторы сборщика мусора в данном процессе, а также общий размер всех объектов, указываемых этими дескрипторами. Команда **ObjSize** включает в размер каждого родительского объекта размер всех его дочерних объектов.<br /><br /> Параметр **-aggregate** можно использовать в сочетании с аргументом **-stat**, чтобы получить подробное представление типов, которые по-прежнему являются корневыми. С помощью **!dumpheap -stat** и **!objsize -aggregate -stat** можно определить, какие объекты больше не являются корневыми, и провести диагностику различных проблем с памятью. <br /><br /> Поддерживается только в Windows.|
|**PrintException** [ **-nested**] [ **-lines**] [\<*Exception object address*>]<br /><br /> -или-<br /><br /> **PE** [ **-nested**] [\<*Exception object address*>]|Отображает и форматирует поля всех производных объектов класса <xref:System.Exception>, находящегося по указанному адресу. Если адрес не задан, команда **PrintException** отображает последнее исключение, возникшее в текущем потоке.<br /><br /> Параметр **-nested** задает отображение сведений о вложенных объектах исключений.<br /><br /> Если доступен, параметр **-lines** отображает сведения об источнике.<br /><br /> С помощью этой команды можно форматировать и просматривать поле `_stackTrace`, представляющее собой двоичный массив.|
|**ProcInfo** [ **-env**] [ **-time**] [ **-mem**]|Отображает переменные среды для статистики процесса, процессорного времени ядра и использования памяти. Поддерживается только в WinDbg.|
|**RCWCleanupList** \<*RCWCleanupList address*>|Отображает список вызываемых оболочек среды выполнения по указанному адресу, ожидающих очистки. Поддерживается только в WinDbg.|
|**SaveModule** \<*Base address*> \<*Filename*>|Записывает в указанный файл образ, загруженный в память по указанному адресу. Поддерживается только в WinDbg.|
|**SetHostRuntime** [\<runtime-directory\>]|Эта команда задает путь к среде выполнения .NET Core, которая будет использоваться для размещения управляемого кода, выполняющегося в составе SOS в отладчике (lldb). Среда выполнения должна иметь версию не ниже 2.1.0. Если в имени каталога есть пробелы, необходимо использовать одинарные кавычки (').<br/><br/>Как правило, SOS пытается найти установленную среду выполнения .NET Core для автоматического запуска управляемого кода, а эту команду можно использовать в случае неудачного поиска. По умолчанию используется та же среда выполнения (libcoreclr), для которой выполняется отладка. Используйте эту команду, если среды выполнения, для которой выполняется отладка, недостаточно для выполнения кода SOS или если она имеет версию ниже 2.1.0.<br/><br/>Если при выполнении команды SOS возникает следующее сообщение об ошибке, используйте эту команду, чтобы задать путь к среде выполнения .NET Core 2.1.0 или более поздней версии. <br/><br/>`(lldb) clrstack`<br/>`Error: Fail to initialize CoreCLR 80004005 ClrStack failed`<br/><br/>`(lldb) sethostruntime /usr/share/dotnet/shared/Microsoft.NETCore.App/2.1.6`<br/><br/>Для поиска пути к установленной среде выполнения .NET Core можно использовать команду "dotnet --info" в командной оболочке.|
|**SetSymbolServer** [ **-ms**] [ **-disable**] [ **-log**] [ **-loadsymbols**] [ **-cache** \<cache-path>] [ **-directory** \<search-directory>] [ **-sympath** \<windows-symbol-path>] [\<symbol-server-URL>]|Включает поддержку скачивания с сервера символов.<br/><br/>Параметр **-ms** разрешает скачивание с общедоступного сервера символов Майкрософт.<br/><br/>Параметр **-disable** включает поддержку скачивания символов.<br/><br/>Параметр **-cache** \<cache-path> задает каталог кэша символов. Если этот каталог не задан, по умолчанию используется $HOME/.dotnet/symbolcache.<br/><br/>Параметр **-directory** добавляет путь для поиска символов. Можно задавать несколько путей.<br/><br/>Параметр **-sympath** добавляет пути к серверу, кэшу и каталогу в формате пути к символам Windows.<br/><br/>Параметр **-log** включает ведение журнала скачивания символов.<br/><br/>Параметр **-loadsymbols** пытается скачать собственные символы .NET Core для среды выполнения. Поддерживается в lldb и dotnet-dump|
|**SOSFlush**|Очищает внутренний кэш SOS.|
|**SOSStatus** [ **-reset**]|Отображает внутреннее состояние SOS или сбрасывает внутреннее кэшированное состояние.|
|**StopOnException** [ **-derived**] [ **-create** &#124; **-create2**] \<*Exception*> \<*Pseudo-register number*>|Предписывает отладчику остановиться при возникновении указанного исключения и продолжать работу при возникновении других исключений.<br /><br /> Параметр **-derived** задает перехват указанного исключения и всех производных от него исключений. <br /><br /> Поддерживается только в WinDbg.|
|**SyncBlk** [ **-all** &#124; \<*syncblk number*>]|Отображает указанную структуру `SyncBlock` или все структуры `SyncBlock`.  При отсутствии аргументов команда **SyncBlk** отображает структуру `SyncBlock`, соответствующую объектам, владельцем которых является поток.<br /><br /> Структура `SyncBlock` представляет собой контейнер для дополнительной информации, которую необязательно создавать для каждого объекта. Она может включать данные COM-взаимодействия и сведения о блокировке для потокобезопасных операций.|
|**ThreadPool**|Отображает сведения о пуле управляемых потоков, включая число рабочих запросов в очереди, число потоков портов завершения и число таймеров.|
|**Threads** (**clrthreads**) [ **-live**] [ **-special**]|Отображает все управляемые потоки в процессе.<br /><br /> Команда **Threads** отображает сокращенный идентификатор отладчика, идентификатор потока среды CLR и идентификатор потока операционной системы.  Кроме того, команда **Threads** отображает столбец Domain, содержащий домен приложения, в котором выполняется поток, столбец APT, в котором показан режим COM-контейнера, и столбец Exception, где указано последнее исключение, возникшее в потоке.<br /><br /> Параметр **-live** задает отображение потоков, связанных с активным потоком.<br /><br /> Параметр **-special** задает отображение всех специальных потоков, созданных средой CLR. К специальным потокам относятся потоки сборки мусора (для параллельной сборки мусора и серверной сборки мусора), вспомогательные потоки отладчика, потоки метода завершения, потоки выгрузки <xref:System.AppDomain> и потоки таймера пула потоков.|
|**ThreadState \<** *State value field* **>**|Отображает состояние потока. Параметр `value` представляет собой значение поля `State` в выводе отчета **Потоки**.|
|**Token2EE** \<*module name*> \<*token*>|Преобразует указанный токен метаданных указанного модуля в структуру `MethodTable` или `MethodDesc`.<br /><br /> В качестве параметра имени модуля можно указать `*`, чтобы узнать, с чем сопоставляется токен в каждом из загруженных управляемых модулей. Можно также задать имя отладчика для модуля, например `mscorlib` или `image00400000`.|
|**U** [ **-gcinfo**] [ **-ehinfo**] [ **-n**] \<*MethodDesc address*> &#124; \<*Code address*>|Отображает дизассемблированный код с примечаниями для управляемого метода, заданного указателем структуры `MethodDesc` или адресом кода в теле метода. Команда **U** отображает весь метод от начала до конца, с примечаниями, преобразующими токены метаданных в имена.<br /><br /> Параметр **-gcinfo** предписывает команде **U** отобразить структуру `GCInfo` метода.<br /><br /> Параметр **-ehinfo** задает отображение сведений об исключениях в методе. Эту информацию можно также получить с помощью команды **EHInfo**.<br /><br /> Параметр **-n** отключает отображение имен исходных файлов и номеров строк. Если для отладчика указан параметр "SYMOPT_LOAD_LINES", расширение отладчика SOS ищет символы для каждого управляемого кадра и в случае успеха отображает соответствующее имя исходного файла и номер строки. Чтобы отключить это поведение, можно указать параметр **-n**.|
|**VerifyHeap**|Проверяет кучу сборщика мусора на наличие признаков повреждения и отображает обнаруженные ошибки.<br /><br /> Повреждения кучи могут быть вызваны неправильно созданными вызовами неуправляемого кода. |
|**VerifyObj** \<*object address*>|Проверяет объект, передаваемый в качестве аргумента, на наличие повреждений. Поддерживается только в Windows.|
|**VMMap**|Выполняет обход виртуального адресного пространства и отображает тип защиты для каждого региона. Поддерживается только в WinDbg.|
|**VMStat**|Создает сводное представление виртуального адресного пространства, упорядоченное по типам защиты соответствующих видов памяти (свободная, зарезервированная, выделенная, закрытая, отображаемая, образ). В столбце "TOTAL" содержится результат умножения значения в столбце "AVERAGE" на значение в столбце "BLK COUNT". Поддерживается только в WinDbg.|

### <a name="dotnet-dump"></a>Dotnet-Dump

Список доступных команд SOS с `dotnet-dump analyze` см. в разделе [dotnet-dump](dotnet-dump.md#analyze-sos-commands).

### <a name="windows-debugger"></a>Отладчик Windows

Расширение отладки SOS можно также загрузить в [отладчик WinDbg/db](/windows-hardware/drivers/debugger/debugger-download-tools) и выполнять команды в отладчике Windows.  Команды SOS можно использовать для активных процессов или дампов.

Чтобы загрузить расширение отладки SOS в отладчик Windows, выполните в программе следующую команду:

```console
.loadby sos clr
```

Отладчик WinDbg.exe и Visual Studio используют версию библиотеки "SOS.dll", которая соответствует текущей версии "Mscorwks.dll". По умолчанию следует использовать версию библиотеки "SOS.dll", которая соответствует текущей версии "Mscorwks.dll".

Чтобы использовать файл дампа, созданный на другом компьютере, убедитесь, что файл "Mscorwks.dll", поступивший вместе с этой установленной копией, указан в пути к символам в данной системе, и загрузите соответствующую версию библиотеки "SOS.dll".

Чтобы загрузить определенную версию библиотеки "SOS.dll", введите в окне отладчика Windows следующую команду:

```console
.load <full path to sos.dll>
```

### <a name="lldb-debugger"></a>Отладчик LLDB

Инструкции по настройке расширения SOS для LLDB см. в разделе [dotnet-sos](dotnet-sos.md). Команды SOS можно использовать для активных процессов или дампов.

По умолчанию можно получить доступ ко всем командам SOS, введя `sos [command\_name]`. Тем не менее стандартные команды имеют псевдонимы, в связи с чем префикс `sos` не нужен:

| Команда                               | Функция
| ------------------------------------- | ---------------------------------------------------------------------------------------------
|    `bpmd`                             | Создание точки останова в указанном управляемом методе указанного модуля.
|    `clrstack`                         | Обеспечивает трассировку стека только для управляемого кода.
|    `clrthreads`                       | Вывод списка выполняемых управляемых потоков.
|    `clru`                             | Отображение дизассемблированного кода с аннотациями для управляемого метода.
|    `dso`                              | Отображает все управляемые объекты, обнаруженные в пределах границ текущего стека.
|    `dumpasync`                        | Отображение сведений об асинхронных конечных автоматах для кучи со сборкой мусора.
|    `dumpclass`                        | Отображение сведений о структуре `EEClass`, находящейся по указанному адресу.
|    `dumpdomain`                       | Отображение сведений обо всех доменах приложений и всех сборках в указанных доменах.
|    `dumpheap`                         | Отображение сведений о куче со сборкой мусора и статистики сборки мусора по объектам.
|    `dumpil`                           | Отображает язык CIL, связанный с управляемым методом.
|    `dumplog`                          | Записывает в указанный файл содержимое журнала нагрузок, хранящегося в памяти.
|    `dumpmd`                           | Отображение сведений о структуре `MethodDesc`, находящейся по указанному адресу.
|    `dumpmodule`                       | Отображение сведений о модуле, находящемся по указанному адресу.
|    `dumpmt`                           | Отображение сведений о таблице методов, расположенной по указанному адресу.
|    `dumpobj`                          | Отображение сведений об объекте, находящемся по указанному адресу.
|    `dumpstack`                        | Отображение трассировки машинного и управляемого стека.
|    `eeheap`                           | Отображение сведений о памяти процессов, занятой внутренними структурами данных среды выполнения.
|    `eestack`                          | Выполнение команды `dumpstack` для всех потоков в составе процесса.
|    `gcroot`                           | Отображение сведений о ссылках (или корневых элементах) объекта, который расположен по указанному адресу.
|    `histclear`                        | Освобождение всех ресурсов, используемых семейством команд Hist.
|    `histinit`                         | Инициализирует структуры SOS из журнала нагрузки, сохраненного в отлаживаемом объекте.
|    `histobj`                          | Проверяет все записи журнала перемещения нагрузки и отображает цепочку перемещений сборки мусора, которые могли привести к адресу, переданному в качестве аргумента.
|    `histobjfind`                      | Отображение всех записей журнала, ссылающихся на объект по указанному адресу.
|    `histroot`                         | Отображает сведения о повышениях и перемещениях указанного корневого элемента.
|    `ip2md`                            | Отображает структуру `MethodDesc` по указанному адресу в коде после его JIT-компиляции.
|    `loadsymbols`                      | Загрузка машинных символов модуля .NET Core.
|    `name2ee`                          | Отображение структур `MethodTable` и `EEClass` для указанного типа или метода в указанном модуле.
|    `pe`                               | Отображает и форматирует поля всех производных объектов класса <xref:System.Exception>, находящегося по указанному адресу.
|    `setclrpath`                       | Задание пути для загрузки файлов coreclr dac/dbi. `setclrpath <path>`
|    `sethostruntime`                   | Задание или отображение каталога среды выполнения .NET Core, который используется для запуска управляемого кода в SOS.
|    `setsymbolserver`                  | Включение поддержки сервера символов.
|    `setsostid`                        | Задание текущего индекса TID или потока операционной системы вместо предоставляемого средством lldb. `setsostid <tid> <index>`
|    `sos`                              | Различные команды отладки coreclr. Дополнительные сведения можно получить с помощью команды soshelp. `sos <command-name> <args>`
|    `soshelp`                          | Отображает все доступные команды при отсутствии параметров или, если указана команда, — подробные справочные сведения об этой команде: `soshelp <command>`
|    `syncblk`                          | Отображение сведений о заполнителе SyncBlock.

## <a name="windbgcdb-example-usage"></a>Пример использования Windbg/cdb

| Get-Help  | Описание
| - | -
| `!dumparray -start 2 -length 5 -detail 00ad28d0` | Отображение содержимого массива по адресу `00ad28d0`.  Отображаются данные для пяти элементов массива, начиная со второго.
| `!dumpassembly 1ca248` | Отображение содержимого сборки по адресу `1ca248`.
| `!dumpheap` | Отображение сведений о куче сборщика мусора.
| `!DumpLog` | Запись содержимого журнала нагрузок в памяти в файл "StressLog.txt" (по умолчанию), расположенный в текущем каталоге.
 `!dumpmd 902f40` | Отображение структуры `MethodDesc` по адресу `902f40`.
| `!dumpmodule 1caa50` | Отображение сведений о модуле, находящемся по адресу `1caa50`.
| `!DumpObj a79d40` | Отображение сведений об объекте, находящемся по адресу `a79d40`.
| `!DumpVC 0090320c 00a79d9c` | Отображение полей класса значений по адресу `00a79d9c` с использованием таблицы методов по адресу `0090320c`.
| `!eeheap` -gc | Отображение памяти процесса, используемой сборщиком мусора.
| `!finalizequeue` | Отображение всех объектов, запланированных для заключительной обработки.
| `!findappdomain 00a79d98` |  Определение домена приложения для объекта, находящегося по адресу `00a79d98`.
| `!gcinfo 5b68dbb8` | Отображение всех дескрипторов сборщика мусора в текущем процессе.
| `!name2ee unittest.exe MainClass.Main` | Отображение структур `MethodTable` и `EEClass` для метода `Main` класса `MainClass` в модуле `unittest.exe`.
| `!token2ee unittest.exe 02000003` | Отображение сведений о токене метаданных по адресу `02000003` в модуле `unittest.exe`.

## <a name="lldb-example-usage"></a>Пример использования LLDB

| Get-Help  | Описание
| - | -
| `sos DumpArray -start 2 -length 5 -detail 00ad28d0` | Отображение содержимого массива по адресу `00ad28d0`.  Отображаются данные для пяти элементов массива, начиная со второго.
| `sos DumpAssembly 1ca248` | Отображение содержимого сборки по адресу `1ca248`.
| `dumpheap` | Отображение сведений о куче сборщика мусора.
| `dumplog` | Запись содержимого журнала нагрузок в памяти в файл "StressLog.txt" (по умолчанию), расположенный в текущем каталоге.
| `dumpmd 902f40` | Отображение структуры `MethodDesc` по адресу `902f40`.
| `dumpmodule 1caa50` | Отображение сведений о модуле, находящемся по адресу `1caa50`.
| `dumpobj a79d40` | Отображение сведений об объекте, находящемся по адресу `a79d40`.
| `sos DumpVC 0090320c 00a79d9c` | Отображение полей класса значений по адресу `00a79d9c` с использованием таблицы методов по адресу `0090320c`.
| `eeheap -gc` | Отображение памяти процесса, используемой сборщиком мусора.
| `sos FindAppDomain 00a79d98` | Определение домена приложения для объекта, находящегося по адресу `00a79d98`.
| `sos GCInfo 5b68dbb8` | Отображение всех дескрипторов сборщика мусора в текущем процессе.
| `name2ee unittest.exe MainClass.Main` | Отображение структур `MethodTable` и `EEClass` для метода `Main` класса `MainClass` в модуле `unittest.exe`.
| `sos Token2EE unittest.exe 02000003` | Отображение сведений о токене метаданных по адресу `02000003` в модуле `unittest.exe`.
| `clrthreads` | Отображение управляемых потоков.

## <a name="see-also"></a>См. также раздел

- [Общие сведения о дампах в .NET](dumps.md)
- [Отладка утечек памяти в .NET Core](debug-memory-leak.md)
- [Сбор и анализ блога дампов памяти](https://devblogs.microsoft.com/dotnet/collecting-and-analyzing-memory-dumps/)
- [Средство анализа дампа (dotnet-dump)](dotnet-dump.md)
- [Средство установки SOS (dotnet-sos)](dotnet-sos.md)
- [Средство анализа кучи (dotnet-gcdump)](dotnet-gcdump.md)
