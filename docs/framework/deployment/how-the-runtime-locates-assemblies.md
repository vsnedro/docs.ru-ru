---
title: Обнаружение сборок в среде выполнения
description: Сведения о том, как среда CLR находит и привязывает сборки, формирующие ваше приложение в .NET.
ms.date: 03/30/2017
helpviewer_keywords:
- app.config files, assembly locations
- deploying applications [.NET Framework], assembly locations
- application configuration files, locating assemblies
- .NET Framework application deployment, locating assemblies
- locating assemblies
- assemblies [.NET Framework], location
ms.assetid: 772ac6f4-64d2-4cfb-92fd-58096dcd6c34
ms.openlocfilehash: 4cf1e5787fe2e430d20208d8e79b610e9126c67c
ms.sourcegitcommit: e02d17b2cf9c1258dadda4810a5e6072a0089aee
ms.contentlocale: ru-RU
ms.lasthandoff: 07/01/2020
ms.locfileid: "85622631"
---
# <a name="how-the-runtime-locates-assemblies"></a><span data-ttu-id="ac649-103">Обнаружение сборок в среде выполнения</span><span class="sxs-lookup"><span data-stu-id="ac649-103">How the Runtime Locates Assemblies</span></span>

<span data-ttu-id="ac649-104">Для успешного развертывания приложения .NET Framework необходимо понимать, как среда CLR обнаруживает сборки, из которых состоит приложение, и выполняет привязку к ним.</span><span class="sxs-lookup"><span data-stu-id="ac649-104">To successfully deploy your .NET Framework application, you must understand how the common language runtime locates and binds to the assemblies that make up your application.</span></span> <span data-ttu-id="ac649-105">По умолчанию среда выполнения пытается выполнить привязку к той самой версии сборки, с помощью которой было создано приложение.</span><span class="sxs-lookup"><span data-stu-id="ac649-105">By default, the runtime attempts to bind with the exact version of an assembly that the application was built with.</span></span> <span data-ttu-id="ac649-106">Это поведение по умолчанию можно переопределить с помощью параметров файла конфигурации.</span><span class="sxs-lookup"><span data-stu-id="ac649-106">This default behavior can be overridden by configuration file settings.</span></span>

<span data-ttu-id="ac649-107">При попытке найти сборку и разрешить ссылку на нее среда CLR выполняет ряд действий.</span><span class="sxs-lookup"><span data-stu-id="ac649-107">The common language runtime performs a number of steps when attempting to locate an assembly and resolve an assembly reference.</span></span> <span data-ttu-id="ac649-108">Каждый этап подробно описывается в приведенных ниже разделах.</span><span class="sxs-lookup"><span data-stu-id="ac649-108">Each step is explained in the following sections.</span></span> <span data-ttu-id="ac649-109">Термин "проверка" часто используется при описании того, как среда выполнения ищет сборки. Под ним понимается набор эвристических правил, используемых для обнаружения сборки на основе ее имени и языка и региональных параметров.</span><span class="sxs-lookup"><span data-stu-id="ac649-109">The term probing is often used when describing how the runtime locates assemblies; it refers to the set of heuristics used to locate the assembly based on its name and culture.</span></span>

> [!NOTE]
> <span data-ttu-id="ac649-110">Сведения о привязке можно просмотреть в файле журнала с помощью [средства просмотра журнала привязок сборки (Fuslogvw.exe)](../tools/fuslogvw-exe-assembly-binding-log-viewer.md), которое включено в Windows SDK.</span><span class="sxs-lookup"><span data-stu-id="ac649-110">You can view binding information in the log file using the [Assembly Binding Log Viewer (Fuslogvw.exe)](../tools/fuslogvw-exe-assembly-binding-log-viewer.md), which is included in the Windows SDK.</span></span>

## <a name="initiating-the-bind"></a><span data-ttu-id="ac649-111">Инициирование привязки</span><span class="sxs-lookup"><span data-stu-id="ac649-111">Initiating the Bind</span></span>

<span data-ttu-id="ac649-112">Процесс обнаружения и привязки к сборке начинается, когда среда выполнения пытается разрешить ссылку на другую сборку.</span><span class="sxs-lookup"><span data-stu-id="ac649-112">The process of locating and binding to an assembly begins when the runtime attempts to resolve a reference to another assembly.</span></span> <span data-ttu-id="ac649-113">Эта ссылка может быть статической или динамической.</span><span class="sxs-lookup"><span data-stu-id="ac649-113">This reference can be either static or dynamic.</span></span> <span data-ttu-id="ac649-114">Компилятор записывает статические ссылки в метаданные манифеста сборки во время сборки.</span><span class="sxs-lookup"><span data-stu-id="ac649-114">The compiler records static references in the assembly manifest's metadata at build time.</span></span> <span data-ttu-id="ac649-115">Динамические ссылки создаются в режиме реального времени в результате вызова различных методов, таких как <xref:System.Reflection.Assembly.Load%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ac649-115">Dynamic references are constructed on the fly as a result of calling various methods, such as <xref:System.Reflection.Assembly.Load%2A?displayProperty=nameWithType>.</span></span>

<span data-ttu-id="ac649-116">Предпочтительным способом обращения к сборке является использование полной ссылки, включая имя, версию, язык и региональные параметры сборки и токен открытого ключа (при наличии).</span><span class="sxs-lookup"><span data-stu-id="ac649-116">The preferred way to reference an assembly is to use a full reference, including the assembly name, version, culture, and public key token (if one exists).</span></span> <span data-ttu-id="ac649-117">Среда выполнения использует эти сведения для обнаружения сборки с помощью описанных далее в этом разделе действий.</span><span class="sxs-lookup"><span data-stu-id="ac649-117">The runtime uses this information to locate the assembly, following the steps described later in this section.</span></span> <span data-ttu-id="ac649-118">Она использует один и тот же процесс разрешения независимо от того, указывает ли ссылка на статическую или динамическую сборку.</span><span class="sxs-lookup"><span data-stu-id="ac649-118">The runtime uses the same resolution process regardless of whether the reference is for a static or dynamic assembly.</span></span>

<span data-ttu-id="ac649-119">Динамическую ссылку на сборку также можно создать, предоставив вызывающему методу только часть сведений о сборке, например только ее имя.</span><span class="sxs-lookup"><span data-stu-id="ac649-119">You can also make a dynamic reference to an assembly by providing the calling method with only partial information about the assembly, such as specifying only the assembly name.</span></span> <span data-ttu-id="ac649-120">В этом случае сборка ищется только в каталоге приложения. Другие проверки не производятся.</span><span class="sxs-lookup"><span data-stu-id="ac649-120">In this case, only the application directory is searched for the assembly, and no other checking occurs.</span></span> <span data-ttu-id="ac649-121">Создать частичную ссылку можно с помощью различных методов загрузки сборок, таких как <xref:System.Reflection.Assembly.Load%2A?displayProperty=nameWithType> или <xref:System.AppDomain.Load%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="ac649-121">You make a partial reference using any of the various methods for loading assemblies such as <xref:System.Reflection.Assembly.Load%2A?displayProperty=nameWithType> or <xref:System.AppDomain.Load%2A?displayProperty=nameWithType>.</span></span>

<span data-ttu-id="ac649-122">Наконец, можно создать динамическую ссылку, используя такой метод, как <xref:System.Reflection.Assembly.Load%2A?displayProperty=nameWithType>, и предоставить только частичные сведения. Затем ссылку определяют полностью с помощью элемента [\<qualifyAssembly>](../configure-apps/file-schema/runtime/qualifyassembly-element.md) в файле конфигурации приложения.</span><span class="sxs-lookup"><span data-stu-id="ac649-122">Finally, you can make a dynamic reference using a method such as <xref:System.Reflection.Assembly.Load%2A?displayProperty=nameWithType> and provide only partial information; you then qualify the reference using the [\<qualifyAssembly>](../configure-apps/file-schema/runtime/qualifyassembly-element.md) element in the application configuration file.</span></span> <span data-ttu-id="ac649-123">Этот элемент позволяет предоставлять полные данные ссылки (имя, версию, язык и региональные параметры и, при наличии, токен открытого ключа) в файле конфигурации приложения, а не в коде.</span><span class="sxs-lookup"><span data-stu-id="ac649-123">This element allows you to provide the full reference information (name, version, culture and, if applicable, the public key token) in your application configuration file instead of in your code.</span></span> <span data-ttu-id="ac649-124">Такой подход можно использовать, если требуется определить полную ссылку на сборку вне каталога приложения или сослаться на сборку в глобальном кэше сборок, используя преимущества определения полной ссылки в файле конфигурации, а не в коде.</span><span class="sxs-lookup"><span data-stu-id="ac649-124">You would use this technique if you wanted to fully qualify a reference to an assembly outside the application directory, or if you wanted to reference an assembly in the global assembly cache but you wanted the convenience of specifying the full reference in the configuration file instead of in your code.</span></span>

> [!NOTE]
> <span data-ttu-id="ac649-125">Частичные ссылки этого типа не следует использовать для сборок, которые являются общими для нескольких приложений.</span><span class="sxs-lookup"><span data-stu-id="ac649-125">This type of partial reference should not be used with assemblies that are shared among several applications.</span></span> <span data-ttu-id="ac649-126">Так как параметры конфигурации применяются к приложениям, а не к сборкам, сведения об общей сборке, использующей такой тип частичной ссылки, потребуется включить в файлы конфигурации всех приложений, использующих эту сборку.</span><span class="sxs-lookup"><span data-stu-id="ac649-126">Because configuration settings are applied per application and not per assembly, a shared assembly using this type of partial reference would require each application using the shared assembly to have the qualifying information in its configuration file.</span></span>

<span data-ttu-id="ac649-127">Для разрешения ссылки на сборку среда выполнения выполняет указанные ниже действия.</span><span class="sxs-lookup"><span data-stu-id="ac649-127">The runtime uses the following steps to resolve an assembly reference:</span></span>

1. <span data-ttu-id="ac649-128">[Определяет правильную версию сборки](#step1) , анализируя применимые файлы конфигурации, включая файл конфигурации приложения, файл политики издателя и файл конфигурации компьютера.</span><span class="sxs-lookup"><span data-stu-id="ac649-128">[Determines the correct assembly version](#step1) by examining applicable configuration files, including the application configuration file, publisher policy file, and machine configuration file.</span></span> <span data-ttu-id="ac649-129">Если файл конфигурации расположен на удаленном компьютере, сначала среде выполнения нужно найти и скачать файл конфигурации приложения.</span><span class="sxs-lookup"><span data-stu-id="ac649-129">If the configuration file is located on a remote machine, the runtime must locate and download the application configuration file first.</span></span>

2. <span data-ttu-id="ac649-130">[Проверяет, выполнялась ли привязка к имени сборки прежде](#step2) , и если да, использует ранее загруженную сборку.</span><span class="sxs-lookup"><span data-stu-id="ac649-130">[Checks whether the assembly name has been bound to before](#step2) and, if so, uses the previously loaded assembly.</span></span> <span data-ttu-id="ac649-131">Если предыдущий запрос загрузки сборки закончился неудачей, запрос немедленно прерывается без попытки загрузить сборку.</span><span class="sxs-lookup"><span data-stu-id="ac649-131">If a previous request to load the assembly failed, the request is failed immediately without attempting to load the assembly.</span></span>

    > [!NOTE]
    > <span data-ttu-id="ac649-132">Кэширование ошибок привязки к сборкам появилось в .NET Framework 2.0.</span><span class="sxs-lookup"><span data-stu-id="ac649-132">The caching of assembly binding failures is new in the .NET Framework version 2.0.</span></span>

3. <span data-ttu-id="ac649-133">[Проверяет глобальный кэш сборок](#step3).</span><span class="sxs-lookup"><span data-stu-id="ac649-133">[Checks the global assembly cache](#step3).</span></span> <span data-ttu-id="ac649-134">Если в нем удается найти сборку, среда выполнения использует ее.</span><span class="sxs-lookup"><span data-stu-id="ac649-134">If the assembly is found there, the runtime uses this assembly.</span></span>

4. <span data-ttu-id="ac649-135">[Проверяет наличие сборки](#step4) , выполняя указанные ниже действия.</span><span class="sxs-lookup"><span data-stu-id="ac649-135">[Probes for the assembly](#step4) using the following steps:</span></span>

    1. <span data-ttu-id="ac649-136">Если конфигурация и политика издателя не влияют на исходную ссылку и запрос привязки создан с помощью метода <xref:System.Reflection.Assembly.LoadFrom%2A?displayProperty=nameWithType> , среда выполнения пытается найти косвенные упоминания о расположении сборки.</span><span class="sxs-lookup"><span data-stu-id="ac649-136">If configuration and publisher policy do not affect the original reference and if the bind request was created using the <xref:System.Reflection.Assembly.LoadFrom%2A?displayProperty=nameWithType> method, the runtime checks for location hints.</span></span>

    2. <span data-ttu-id="ac649-137">Если база кода находится в файлах конфигурации, среда выполнения проверяет только это расположение.</span><span class="sxs-lookup"><span data-stu-id="ac649-137">If a codebase is found in the configuration files, the runtime checks only this location.</span></span> <span data-ttu-id="ac649-138">Если происходит сбой проверки, среда выполнения определяет, что запрос привязки не выполнен, и другие проверки не производятся.</span><span class="sxs-lookup"><span data-stu-id="ac649-138">If this probe fails, the runtime determines that the binding request failed and no other probing occurs.</span></span>

    3. <span data-ttu-id="ac649-139">Проверяет наличие сборки с помощью эвристических правил, описанных в разделе, посвященном [проверке](#step4).</span><span class="sxs-lookup"><span data-stu-id="ac649-139">Probes for the assembly using the heuristics described in the [probing section](#step4).</span></span> <span data-ttu-id="ac649-140">Если сборку не удается найти с помощью проверки, среда выполнения запрашивает предоставление сборки у установщика Windows.</span><span class="sxs-lookup"><span data-stu-id="ac649-140">If the assembly is not found after probing, the runtime requests the Windows Installer to provide the assembly.</span></span> <span data-ttu-id="ac649-141">Эта операция напоминает функцию установки по запросу.</span><span class="sxs-lookup"><span data-stu-id="ac649-141">This acts as an install-on-demand feature.</span></span>

        > [!NOTE]
        > <span data-ttu-id="ac649-142">Если сборки не являются сборками со строгими именами, для них не проводятся ни проверка версии, ни поиск в глобальном кэше сборок.</span><span class="sxs-lookup"><span data-stu-id="ac649-142">There is no version checking for assemblies without strong names, nor does the runtime check in the global assembly cache for assemblies without strong names.</span></span>

<a name="step1"></a>

## <a name="step-1-examining-the-configuration-files"></a><span data-ttu-id="ac649-143">Шаг 1. Проверка файлов конфигурации</span><span class="sxs-lookup"><span data-stu-id="ac649-143">Step 1: Examining the Configuration Files</span></span>

<span data-ttu-id="ac649-144">Поведение привязки сборок можно настроить на разных уровнях, используя три XML-файла:</span><span class="sxs-lookup"><span data-stu-id="ac649-144">Assembly binding behavior can be configured at different levels based on three XML files:</span></span>

- <span data-ttu-id="ac649-145">файл конфигурации приложения;</span><span class="sxs-lookup"><span data-stu-id="ac649-145">Application configuration file.</span></span>

- <span data-ttu-id="ac649-146">файл политики издателя;</span><span class="sxs-lookup"><span data-stu-id="ac649-146">Publisher policy file.</span></span>

- <span data-ttu-id="ac649-147">файл конфигурации компьютера.</span><span class="sxs-lookup"><span data-stu-id="ac649-147">Machine configuration file.</span></span>

<span data-ttu-id="ac649-148">Эти файлы имеют одинаковый синтаксис и содержат такие сведения, как перенаправления привязки, расположение кода и режимы привязки для конкретных сборок.</span><span class="sxs-lookup"><span data-stu-id="ac649-148">These files follow the same syntax and provide information such as binding redirects, the location of code, and binding modes for particular assemblies.</span></span> <span data-ttu-id="ac649-149">Каждый файл конфигурации может содержать [элемент \<assemblyBinding>](../configure-apps/file-schema/runtime/assemblybinding-element-for-runtime.md), перенаправляющий процесс привязки.</span><span class="sxs-lookup"><span data-stu-id="ac649-149">Each configuration file can contain an [\<assemblyBinding> element](../configure-apps/file-schema/runtime/assemblybinding-element-for-runtime.md) that redirects the binding process.</span></span> <span data-ttu-id="ac649-150">Дочерние элементы [элемента \<assemblyBinding>](../configure-apps/file-schema/runtime/assemblybinding-element-for-runtime.md) включают [элемент \<dependentAssembly>](../configure-apps/file-schema/runtime/dependentassembly-element.md).</span><span class="sxs-lookup"><span data-stu-id="ac649-150">The child elements of the [\<assemblyBinding> element](../configure-apps/file-schema/runtime/assemblybinding-element-for-runtime.md) include the [\<dependentAssembly> element](../configure-apps/file-schema/runtime/dependentassembly-element.md).</span></span> <span data-ttu-id="ac649-151">Дочерние элементы [элемента \<dependentAssembly>](../configure-apps/file-schema/runtime/dependentassembly-element.md) включают [элемент \<assemblyIdentity>](/visualstudio/deployment/assemblyidentity-element-clickonce-deployment), [элемент \<bindingRedirect>](../configure-apps/file-schema/runtime/bindingredirect-element.md) и [элемент \<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md).</span><span class="sxs-lookup"><span data-stu-id="ac649-151">The children of [\<dependentAssembly> element](../configure-apps/file-schema/runtime/dependentassembly-element.md) include the [\<assemblyIdentity> element](/visualstudio/deployment/assemblyidentity-element-clickonce-deployment), the [\<bindingRedirect> element](../configure-apps/file-schema/runtime/bindingredirect-element.md), and the [\<codeBase> element](../configure-apps/file-schema/runtime/codebase-element.md).</span></span>

> [!NOTE]
> <span data-ttu-id="ac649-152">Сведения о конфигурации хранятся во всех трех файлах конфигурации, но не все элементы можно использовать во всех этих файлах.</span><span class="sxs-lookup"><span data-stu-id="ac649-152">Configuration information can be found in the three configuration files; not all elements are valid in all configuration files.</span></span> <span data-ttu-id="ac649-153">Например, сведения о режиме привязки и частном пути могут находиться только в файле конфигурации приложения.</span><span class="sxs-lookup"><span data-stu-id="ac649-153">For example, binding mode and private path information can only be in the application configuration file.</span></span> <span data-ttu-id="ac649-154">Полный список сведений, которые содержатся в каждом файле, см. в разделе [Настройка приложений с использованием файлов конфигурации](../configure-apps/index.md).</span><span class="sxs-lookup"><span data-stu-id="ac649-154">For a complete list of the information that is contained in each file, see [Configuring Apps by Using Configuration Files](../configure-apps/index.md).</span></span>

### <a name="application-configuration-file"></a><span data-ttu-id="ac649-155">Файл конфигурации приложения</span><span class="sxs-lookup"><span data-stu-id="ac649-155">Application Configuration File</span></span>

<span data-ttu-id="ac649-156">В первую очередь среда CLR пытается найти в файле конфигурации приложения данные, которые переопределяют сведения о версии, хранящиеся в манифесте вызывающей сборки.</span><span class="sxs-lookup"><span data-stu-id="ac649-156">First, the common language runtime checks the application configuration file for information that overrides the version information stored in the calling assembly's manifest.</span></span> <span data-ttu-id="ac649-157">Файл конфигурации приложения можно развертывать вместе с приложением, но он не требуется для выполнения приложения.</span><span class="sxs-lookup"><span data-stu-id="ac649-157">The application configuration file can be deployed with an application, but is not required for application execution.</span></span> <span data-ttu-id="ac649-158">Обычно получение этого файла происходит почти мгновенно, однако если приложение размещено на удаленном компьютере, например при работе с веб-приложением через Internet Explorer, файл конфигурации необходимо скачивать.</span><span class="sxs-lookup"><span data-stu-id="ac649-158">Usually the retrieval of this file is almost instantaneous, but in situations where the application base is on a remote computer, such as in an Internet Explorer Web-based scenario, the configuration file must be downloaded.</span></span>

<span data-ttu-id="ac649-159">В случае клиентских приложений файл конфигурации приложения расположен в том же каталоге, что и исполняемый файл приложения, и имеет такое же базовое имя, но с расширением CONFIG.</span><span class="sxs-lookup"><span data-stu-id="ac649-159">For client executables, the application configuration file resides in the same directory as the application's executable and has the same base name as the executable with a .config extension.</span></span> <span data-ttu-id="ac649-160">Например, файл конфигурации для C:\Program Files\Myapp\Myapp.exe называется C:\Program Files\Myapp\Myapp.exe.config. При работе через браузер в HTML-файле должен использоваться элемент **\<link>** , явным образом указывающий на файл конфигурации.</span><span class="sxs-lookup"><span data-stu-id="ac649-160">For example, the configuration file for C:\Program Files\Myapp\Myapp.exe is C:\Program Files\Myapp\Myapp.exe.config. In a browser-based scenario, the HTML file must use the **\<link>** element to explicitly point to the configuration file.</span></span>

<span data-ttu-id="ac649-161">Ниже показан пример кода простого файла конфигурации приложения.</span><span class="sxs-lookup"><span data-stu-id="ac649-161">The following code provides a simple example of an application configuration file.</span></span> <span data-ttu-id="ac649-162">В этом примере элемент <xref:System.Diagnostics.TextWriterTraceListener> добавляется в коллекцию <xref:System.Diagnostics.Debug.Listeners%2A> , чтобы включить запись отладочной информации в файл.</span><span class="sxs-lookup"><span data-stu-id="ac649-162">This example adds a <xref:System.Diagnostics.TextWriterTraceListener> to the <xref:System.Diagnostics.Debug.Listeners%2A> collection to enable recording debug information to a file.</span></span>

```xml
<configuration>
   <system.diagnostics>
      <trace useGlobalLock="false" autoflush="true" indentsize="0">
         <listeners>
            <add name="myListener" type="System.Diagnostics.TextWriterTraceListener, system version=1.0.3300.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" initializeData="c:\myListener.log" />
         </listeners>
      </trace>
   </system.diagnostics>
</configuration>
```

### <a name="publisher-policy-file"></a><span data-ttu-id="ac649-163">Файл политики издателя</span><span class="sxs-lookup"><span data-stu-id="ac649-163">Publisher Policy File</span></span>

<span data-ttu-id="ac649-164">Во вторую очередь среда выполнения проверяет файл политики издателя, если он существует.</span><span class="sxs-lookup"><span data-stu-id="ac649-164">Second, the runtime examines the publisher policy file, if one exists.</span></span> <span data-ttu-id="ac649-165">Файлы политики издателя распространяются издателем компонента в виде исправлений или обновлений для общего компонента.</span><span class="sxs-lookup"><span data-stu-id="ac649-165">Publisher policy files are distributed by a component publisher as a fix or update to a shared component.</span></span> <span data-ttu-id="ac649-166">Они содержат предоставляемые издателем сведения о совместимости, которые задают ссылки на новые версии сборок.</span><span class="sxs-lookup"><span data-stu-id="ac649-166">These files contain compatibility information issued by the publisher of the shared component that directs an assembly reference to a new version.</span></span> <span data-ttu-id="ac649-167">В отличие от файлов конфигурации компьютера и приложения файлы политики издателя хранятся в своей собственной сборке, которая должна быть установлена в глобальном кэше сборок.</span><span class="sxs-lookup"><span data-stu-id="ac649-167">Unlike application and machine configuration files, publisher policy files are contained in their own assembly that must be installed in the global assembly cache.</span></span>

<span data-ttu-id="ac649-168">Ниже приведен пример файла конфигурации политики издателя.</span><span class="sxs-lookup"><span data-stu-id="ac649-168">The following is an example of a Publisher Policy configuration file:</span></span>

```xml
<configuration>
    <runtime>
        <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">

            <dependentAssembly>
                <assemblyIdentity name="asm6" publicKeyToken="c0305c36380ba429" />
                <bindingRedirect oldVersion="3.0.0.0" newVersion="2.0.0.0"/>
            </dependentAssembly>

        </assemblyBinding>
    </runtime>
</configuration>
```

<span data-ttu-id="ac649-169">Чтобы создать сборку, можно воспользоваться [компоновщиком сборок (Al.exe)](../tools/al-exe-assembly-linker.md) и выполнить команду следующего вида:</span><span class="sxs-lookup"><span data-stu-id="ac649-169">To create an assembly, you can use the [Al.exe (Assembly Linker)](../tools/al-exe-assembly-linker.md) tool with a command such as the following:</span></span>

```console
Al.exe /link:asm6.exe.config /out:policy.3.0.asm6.dll /keyfile: compatkey.dat /v:3.0.0.0
```

<span data-ttu-id="ac649-170">`compatkey.dat` — это файл ключа строгого имени.</span><span class="sxs-lookup"><span data-stu-id="ac649-170">`compatkey.dat` is a strong-name key file.</span></span> <span data-ttu-id="ac649-171">Эта команда создает сборку со строгим именем, которую можно поместить в глобальный кэш сборок.</span><span class="sxs-lookup"><span data-stu-id="ac649-171">This command creates a strong-named assembly you can place in the global assembly cache.</span></span>

> [!NOTE]
> <span data-ttu-id="ac649-172">Политика издателя затрагивает все приложения, которые используют общий компонент.</span><span class="sxs-lookup"><span data-stu-id="ac649-172">Publisher policy affects all applications that use a shared component.</span></span>

<span data-ttu-id="ac649-173">Файл конфигурации политики издателя переопределяет сведения о версии, которые поступают от приложения (то есть из манифеста сборки или из файла конфигурации приложения).</span><span class="sxs-lookup"><span data-stu-id="ac649-173">The publisher policy configuration file overrides version information that comes from the application (that is, from the assembly manifest or from the application configuration file).</span></span> <span data-ttu-id="ac649-174">Если в файле конфигурации приложения нет оператора перенаправления версии, указанной в манифесте сборки, файл политики издателя переопределяет версию, указанную в манифесте сборки.</span><span class="sxs-lookup"><span data-stu-id="ac649-174">If there is no statement in the application configuration file to redirect the version specified in the assembly manifest, the publisher policy file overrides the version specified in the assembly manifest.</span></span> <span data-ttu-id="ac649-175">Однако если такой оператор имеется, политика издателя переопределяет эту версию, а не версию, указанную в манифесте.</span><span class="sxs-lookup"><span data-stu-id="ac649-175">However, if there is a redirecting statement in the application configuration file, publisher policy overrides that version rather than the one specified in the manifest.</span></span>

<span data-ttu-id="ac649-176">Файл политики издателя используется, если общий компонент обновляется и нужно, чтобы все использующие его приложения получили его новую версию.</span><span class="sxs-lookup"><span data-stu-id="ac649-176">A publisher policy file is used when a shared component is updated and the new version of the shared component should be picked up by all applications using that component.</span></span> <span data-ttu-id="ac649-177">Параметры в файле политики издателя переопределяют параметры в файле конфигурации приложения, если только в файле конфигурации приложения не задан безопасный режим.</span><span class="sxs-lookup"><span data-stu-id="ac649-177">The settings in the publisher policy file override settings in the application configuration file, unless the application configuration file enforces safe mode.</span></span>

#### <a name="safe-mode"></a><span data-ttu-id="ac649-178">Безопасный режим</span><span class="sxs-lookup"><span data-stu-id="ac649-178">Safe Mode</span></span>
<span data-ttu-id="ac649-179">Файлы политики издателя обычно явным образом устанавливаются как часть пакета обновления или обновления программы.</span><span class="sxs-lookup"><span data-stu-id="ac649-179">Publisher policy files are usually explicitly installed as part of a service pack or program update.</span></span> <span data-ttu-id="ac649-180">В случае возникновения проблем с обновленным общим компонентом можно проигнорировать изменения в файле политики издателя, используя безопасный режим.</span><span class="sxs-lookup"><span data-stu-id="ac649-180">If there is any problem with the upgraded shared component, you can ignore the overrides in the publisher policy file using safe mode.</span></span> <span data-ttu-id="ac649-181">Безопасный режим определяется элементом **\<publisherPolicy apply="yes**&#124;**no"/>** , расположенным только в файле конфигурации приложения.</span><span class="sxs-lookup"><span data-stu-id="ac649-181">Safe mode is determined by the **\<publisherPolicy apply="yes**&#124;**no"/>** element, located only in the application configuration file.</span></span> <span data-ttu-id="ac649-182">Он указывает, следует ли удалять сведения политики издателя из процесса привязки.</span><span class="sxs-lookup"><span data-stu-id="ac649-182">It specifies whether the publisher policy configuration information should be removed from the binding process.</span></span>

<span data-ttu-id="ac649-183">Безопасный режим можно задать для всего приложения или для выбранных сборок.</span><span class="sxs-lookup"><span data-stu-id="ac649-183">Safe mode can be set for the entire application or for selected assemblies.</span></span> <span data-ttu-id="ac649-184">То есть можно отключить политику для всех сборок, составляющих приложение, или включить ее для некоторых сборок, отключив для других.</span><span class="sxs-lookup"><span data-stu-id="ac649-184">That is, you can turn off the policy for all assemblies that make up the application, or turn it on for some assemblies but not others.</span></span> <span data-ttu-id="ac649-185">Чтобы применить политику издателя к отдельным сборкам приложения, задайте параметр **\<publisherPolicy apply\=no/>** и с помощью элемента \<**dependentAssembly**> укажите сборки, на которые должно распространяться действие политики.</span><span class="sxs-lookup"><span data-stu-id="ac649-185">To selectively apply publisher policy to assemblies that make up an application, set **\<publisherPolicy apply\=no/>** and specify which assemblies you want to be affected using the \<**dependentAssembly**> element.</span></span> <span data-ttu-id="ac649-186">Чтобы применить политику издателя ко всем сборкам приложения, задайте параметр **\<publisherPolicy apply\=no/>** без элементов зависимых сборок.</span><span class="sxs-lookup"><span data-stu-id="ac649-186">To apply publisher policy to all assemblies that make up the application, set **\<publisherPolicy apply\=no/>** with no dependent assembly elements.</span></span> <span data-ttu-id="ac649-187">Дополнительные сведения о конфигурации см. в разделе [Настройка приложений с использованием файлов конфигурации](../configure-apps/index.md).</span><span class="sxs-lookup"><span data-stu-id="ac649-187">For more about configuration, see [Configuring Apps by using Configuration Files](../configure-apps/index.md).</span></span>

### <a name="machine-configuration-file"></a><span data-ttu-id="ac649-188">Файл конфигурации компьютера</span><span class="sxs-lookup"><span data-stu-id="ac649-188">Machine Configuration File</span></span>
<span data-ttu-id="ac649-189">Файл конфигурации компьютера среда выполнения проверяет последним.</span><span class="sxs-lookup"><span data-stu-id="ac649-189">Third, the runtime examines the machine configuration file.</span></span> <span data-ttu-id="ac649-190">Этот файл с именем Machine.config находится на локальном компьютере в подкаталоге Config корневого каталога, где установлена среда выполнения.</span><span class="sxs-lookup"><span data-stu-id="ac649-190">This file, called Machine.config, resides on the local computer in the Config subdirectory of the root directory where the runtime is installed.</span></span> <span data-ttu-id="ac649-191">С помощью этого файла администраторы могут настраивать ограничения привязки сборок, действующие только на этом компьютере.</span><span class="sxs-lookup"><span data-stu-id="ac649-191">This file can be used by administrators to specify assembly binding restrictions that are local to that computer.</span></span> <span data-ttu-id="ac649-192">Параметры в файле конфигурации компьютера имеют приоритет над всеми остальными параметрами. Однако это не означает, что все параметры конфигурации должны быть помещены в этот файл.</span><span class="sxs-lookup"><span data-stu-id="ac649-192">The settings in the machine configuration file take precedence over all other configuration settings; however, this does not mean that all configuration settings should be put in this file.</span></span> <span data-ttu-id="ac649-193">Версия, определяемая файлом политики администратора, является окончательной и не может быть переопределена.</span><span class="sxs-lookup"><span data-stu-id="ac649-193">The version determined by the administrator policy file is final, and cannot be overridden.</span></span> <span data-ttu-id="ac649-194">Переопределения, заданные в файле Machine.config, влияют на все приложения.</span><span class="sxs-lookup"><span data-stu-id="ac649-194">Overrides specified in the Machine.config file affect all applications.</span></span> <span data-ttu-id="ac649-195">Дополнительные сведения о файлах конфигурации см. в разделе [Настройка приложений с использованием файлов конфигурации](../configure-apps/index.md).</span><span class="sxs-lookup"><span data-stu-id="ac649-195">For more information about configuration files, see [Configuring Apps by using Configuration Files](../configure-apps/index.md).</span></span>

<a name="step2"></a>

## <a name="step-2-checking-for-previously-referenced-assemblies"></a><span data-ttu-id="ac649-196">Шаг 2. Проверка наличия предыдущих ссылок на сборки</span><span class="sxs-lookup"><span data-stu-id="ac649-196">Step 2: Checking for Previously Referenced Assemblies</span></span>

<span data-ttu-id="ac649-197">Если запрошенная сборка уже запрашивалась в предыдущих вызовах, среда CLR использует уже загруженную сборку.</span><span class="sxs-lookup"><span data-stu-id="ac649-197">If the requested assembly has also been requested in previous calls, the common language runtime uses the assembly that is already loaded.</span></span> <span data-ttu-id="ac649-198">Это может иметь последствия при именовании сборок, составляющих приложение.</span><span class="sxs-lookup"><span data-stu-id="ac649-198">This can have ramifications when naming assemblies that make up an application.</span></span> <span data-ttu-id="ac649-199">Подробнее об именовании сборок см. в разделе [Имена сборок](../../standard/assembly/names.md).</span><span class="sxs-lookup"><span data-stu-id="ac649-199">For more information about naming assemblies, see [Assembly Names](../../standard/assembly/names.md).</span></span>

<span data-ttu-id="ac649-200">Если предыдущий запрос сборки завершился неудачей, последующие вызовы этой сборки немедленно прерываются без попытки загрузить сборку.</span><span class="sxs-lookup"><span data-stu-id="ac649-200">If a previous request for the assembly failed, subsequent requests for the assembly are failed immediately without attempting to load the assembly.</span></span> <span data-ttu-id="ac649-201">Начиная с .NET Framework версии 2.0 сбои привязки сборок кэшируются, и кэшированные сведения используются для определения целесообразности попытки загрузить сборку.</span><span class="sxs-lookup"><span data-stu-id="ac649-201">Starting with the .NET Framework version 2.0, assembly binding failures are cached, and the cached information is used to determine whether to attempt to load the assembly.</span></span>

> [!NOTE]
> <span data-ttu-id="ac649-202">Чтобы вернуться к алгоритму поведения, характерному для .NET Framework версий 1.0 и 1.1, в котором сбои привязки не кэшировались, включите в файл конфигурации [элемент \<disableCachingBindingFailures>](../configure-apps/file-schema/runtime/disablecachingbindingfailures-element.md).</span><span class="sxs-lookup"><span data-stu-id="ac649-202">To revert to the behavior of the .NET Framework versions 1.0 and 1.1, which did not cache binding failures, include the [\<disableCachingBindingFailures> Element](../configure-apps/file-schema/runtime/disablecachingbindingfailures-element.md) in your configuration file.</span></span>

<a name="step3"></a>

## <a name="step-3-checking-the-global-assembly-cache"></a><span data-ttu-id="ac649-203">Шаг 3. Проверка глобального кэша сборок</span><span class="sxs-lookup"><span data-stu-id="ac649-203">Step 3: Checking the Global Assembly Cache</span></span>

<span data-ttu-id="ac649-204">Для сборок со строгими именами процесс привязки продолжается поиском в глобальном кэше сборок.</span><span class="sxs-lookup"><span data-stu-id="ac649-204">For strong-named assemblies, the binding process continues by looking in the global assembly cache.</span></span> <span data-ttu-id="ac649-205">В глобальном кэше сборок сохраняются сборки, которые могут использоваться на компьютере несколькими приложениями.</span><span class="sxs-lookup"><span data-stu-id="ac649-205">The global assembly cache stores assemblies that can be used by several applications on a computer.</span></span> <span data-ttu-id="ac649-206">Все сборки в глобальном кэше сборок должны иметь строгие имена.</span><span class="sxs-lookup"><span data-stu-id="ac649-206">All assemblies in the global assembly cache must have strong names.</span></span>

<a name="step4"></a>

## <a name="step-4-locating-the-assembly-through-codebases-or-probing"></a><span data-ttu-id="ac649-207">Шаг 4. Обнаружение сборки с помощью базы кода или проверки</span><span class="sxs-lookup"><span data-stu-id="ac649-207">Step 4: Locating the Assembly through Codebases or Probing</span></span>

<span data-ttu-id="ac649-208">После определения правильной версии сборки с помощью сведений в ссылке вызывающей сборки и в файлах конфигурации, а также после проверки в глобальном кэше сборок (только для сборок со строгими именами) среда CLR попытается найти сборку.</span><span class="sxs-lookup"><span data-stu-id="ac649-208">After the correct assembly version has been determined by using the information in the calling assembly's reference and in the configuration files, and after it has checked in the global assembly cache (only for strong-named assemblies), the common language runtime attempts to find the assembly.</span></span> <span data-ttu-id="ac649-209">Процесс поиска расположения сборки включает в себя перечисленные ниже этапы.</span><span class="sxs-lookup"><span data-stu-id="ac649-209">The process of locating an assembly involves the following steps:</span></span>

1. <span data-ttu-id="ac649-210">Если элемент [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) найден в файле конфигурации приложения, среда выполнения проверяет указанное расположение.</span><span class="sxs-lookup"><span data-stu-id="ac649-210">If a [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element is found in the application configuration file, the runtime checks the specified location.</span></span> <span data-ttu-id="ac649-211">Если найдено совпадение, используется эта сборка, и дальнейший поиск не выполняется.</span><span class="sxs-lookup"><span data-stu-id="ac649-211">If a match is found, that assembly is used and no probing occurs.</span></span> <span data-ttu-id="ac649-212">Если сборку не удается обнаружить в этом файле, происходит сбой запроса привязки.</span><span class="sxs-lookup"><span data-stu-id="ac649-212">If the assembly is not found there, the binding request fails.</span></span>

2. <span data-ttu-id="ac649-213">Среда выполнения осуществляет проверку наличия связанной сборки, используя правила, описанные далее в этом разделе.</span><span class="sxs-lookup"><span data-stu-id="ac649-213">The runtime then probes for the referenced assembly using the rules specified later in this section.</span></span>

> [!NOTE]
> <span data-ttu-id="ac649-214">Если в каталоге есть несколько версий сборки и нужно сослаться на конкретную версию сборки, необходимо использовать элемент [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) вместо атрибута `privatePath` элемента [\<probing>](../configure-apps/file-schema/runtime/probing-element.md).</span><span class="sxs-lookup"><span data-stu-id="ac649-214">If you have multiple versions of an assembly in a directory and you want to reference a particular version of that assembly, you must use the [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element instead of the `privatePath` attribute of the [\<probing>](../configure-apps/file-schema/runtime/probing-element.md) element.</span></span> <span data-ttu-id="ac649-215">Если используется элемент [\<probing>](../configure-apps/file-schema/runtime/probing-element.md), среда выполнения останавливает проверку при первом обнаружении сборки, у которой совпадает упоминаемое в ссылке простое имя сборки, независимо от того, является ли совпадение точным.</span><span class="sxs-lookup"><span data-stu-id="ac649-215">If you use the [\<probing>](../configure-apps/file-schema/runtime/probing-element.md) element, the runtime stops probing the first time it finds an assembly that matches the simple assembly name referenced, whether it is a correct match or not.</span></span> <span data-ttu-id="ac649-216">Если совпадение точное, найденная сборка используется.</span><span class="sxs-lookup"><span data-stu-id="ac649-216">If it is a correct match, that assembly is used.</span></span> <span data-ttu-id="ac649-217">Если совпадение не является точным, проверка прекращается и происходит сбой привязки.</span><span class="sxs-lookup"><span data-stu-id="ac649-217">If it is not a correct match, probing stops and binding fails.</span></span>

### <a name="locating-the-assembly-through-codebases"></a><span data-ttu-id="ac649-218">Обнаружение сборки с помощью базы кода</span><span class="sxs-lookup"><span data-stu-id="ac649-218">Locating the Assembly through Codebases</span></span>

<span data-ttu-id="ac649-219">Сведения базы кода могут предоставляться с помощью элемента [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) в файле конфигурации.</span><span class="sxs-lookup"><span data-stu-id="ac649-219">Codebase information can be provided by using a [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element in a configuration file.</span></span> <span data-ttu-id="ac649-220">Эта база кода всегда проверяется, прежде чем среда выполнения переходит к проверке наличия связанной сборки.</span><span class="sxs-lookup"><span data-stu-id="ac649-220">This codebase is always checked before the runtime attempts to probe for the referenced assembly.</span></span> <span data-ttu-id="ac649-221">Если файл политики издателя, содержащий переадресацию конечной версии, содержит также элемент [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md), используется этот элемент [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md).</span><span class="sxs-lookup"><span data-stu-id="ac649-221">If a publisher policy file containing the final version redirect also contains a [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element, that [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element is the one that is used.</span></span> <span data-ttu-id="ac649-222">Например, если в файле конфигурации приложения указан элемент [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) и файл политики издателя, переопределяющий сведения приложения, также содержит элемент [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md), используется элемент [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) из файла политики издателя.</span><span class="sxs-lookup"><span data-stu-id="ac649-222">For example, if your application configuration file specifies a [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element, and a publisher policy file that is overriding the application information also specifies a [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element, the [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element in the publisher policy file is used.</span></span>

<span data-ttu-id="ac649-223">Если совпадение не найдено в расположении, заданном элементом [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md), запрос привязки не удается выполнить, а дополнительные действия не предпринимаются.</span><span class="sxs-lookup"><span data-stu-id="ac649-223">If no match is found at the location specified by the [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element, the bind request fails and no further steps are taken.</span></span> <span data-ttu-id="ac649-224">Если среда выполнения определяет, что сборка соответствует критерию вызывающей сборки, то используется эта сборка.</span><span class="sxs-lookup"><span data-stu-id="ac649-224">If the runtime determines that an assembly matches the calling assembly's criteria, it uses that assembly.</span></span> <span data-ttu-id="ac649-225">Когда загружается файл, указанный заданным элементом [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md), среда выполнения проверяет совпадение имени, версии, языка, региональных параметров и открытого ключа с соответствующими параметрами ссылки вызывающей сборки.</span><span class="sxs-lookup"><span data-stu-id="ac649-225">When the file specified by the given [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element is loaded, the runtime checks to make sure that the name, version, culture, and public key match the calling assembly's reference.</span></span>

> [!NOTE]
> <span data-ttu-id="ac649-226">Связанные сборки вне корневого каталога приложения должны иметь строгие имена и должны быть установлены в глобальном кэше сборок или заданы с помощью элемента [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md).</span><span class="sxs-lookup"><span data-stu-id="ac649-226">Referenced assemblies outside the application's root directory must have strong names and must either be installed in the global assembly cache or specified using the [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element.</span></span>

### <a name="locating-the-assembly-through-probing"></a><span data-ttu-id="ac649-227">Обнаружение сборки с помощью проверки</span><span class="sxs-lookup"><span data-stu-id="ac649-227">Locating the Assembly through Probing</span></span>

<span data-ttu-id="ac649-228">Если в файле конфигурации приложения нет элемента [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md), среда выполнения проверяет наличие сборки, используя следующие четыре критерия:</span><span class="sxs-lookup"><span data-stu-id="ac649-228">If there is no [\<codeBase>](../configure-apps/file-schema/runtime/codebase-element.md) element in the application configuration file, the runtime probes for the assembly using four criteria:</span></span>

- <span data-ttu-id="ac649-229">Базовая папка приложения, то есть корневой каталог, где выполняется приложение.</span><span class="sxs-lookup"><span data-stu-id="ac649-229">Application base, which is the root location where the application is being executed.</span></span>

- <span data-ttu-id="ac649-230">Язык и региональные параметры, то есть атрибут culture сборки, на которую задана ссылка.</span><span class="sxs-lookup"><span data-stu-id="ac649-230">Culture, which is the culture attribute of the assembly being referenced.</span></span>

- <span data-ttu-id="ac649-231">Имя, то есть имя сборки, на которую задана ссылка.</span><span class="sxs-lookup"><span data-stu-id="ac649-231">Name, which is the name of the referenced assembly.</span></span>

- <span data-ttu-id="ac649-232">Атрибут `privatePath` элемента [\<probing>](../configure-apps/file-schema/runtime/probing-element.md), который является определяемым пользователем списком подкаталогов в корневой папке.</span><span class="sxs-lookup"><span data-stu-id="ac649-232">The `privatePath` attribute of the [\<probing>](../configure-apps/file-schema/runtime/probing-element.md) element, which is the user-defined list of subdirectories under the root location.</span></span> <span data-ttu-id="ac649-233">Это расположение может быть задано в файле конфигурации приложения и в управляемом коде с помощью свойства <xref:System.AppDomainSetup.PrivateBinPath?displayProperty=nameWithType> для домена приложения.</span><span class="sxs-lookup"><span data-stu-id="ac649-233">This location can be specified in the application configuration file and in managed code using the <xref:System.AppDomainSetup.PrivateBinPath?displayProperty=nameWithType> property for an application domain.</span></span> <span data-ttu-id="ac649-234">При указании в управляемом коде путь `privatePath` управляемого кода проверяется первым. Затем проверяется путь, указанный в файле конфигурации приложения.</span><span class="sxs-lookup"><span data-stu-id="ac649-234">When specified in managed code, the managed code `privatePath` is probed first, followed by the path specified in the application configuration file.</span></span>

#### <a name="probing-the-application-base-and-culture-directories"></a><span data-ttu-id="ac649-235">Проверка базовой папки приложения и каталогов языков и региональных параметров</span><span class="sxs-lookup"><span data-stu-id="ac649-235">Probing the Application Base and Culture Directories</span></span>

<span data-ttu-id="ac649-236">Среда выполнения всегда начинает проверку с базовой папки приложения, которая может быть URL-адресом или корневым каталогом приложения на компьютере.</span><span class="sxs-lookup"><span data-stu-id="ac649-236">The runtime always begins probing in the application's base, which can be either a URL or the application's root directory on a computer.</span></span> <span data-ttu-id="ac649-237">Если связанная сборка не найдена в базовой папке приложения и не предоставлены сведения о языке и региональных параметрах, среда выполнения осуществляет поиск во всех подкаталогах с именем сборки.</span><span class="sxs-lookup"><span data-stu-id="ac649-237">If the referenced assembly is not found in the application base and no culture information is provided, the runtime searches any subdirectories with the assembly name.</span></span> <span data-ttu-id="ac649-238">В число проверяемых каталогов входят следующие:</span><span class="sxs-lookup"><span data-stu-id="ac649-238">The directories probed include:</span></span>

- <span data-ttu-id="ac649-239">[базовая папка приложения] / [имя сборки].dll</span><span class="sxs-lookup"><span data-stu-id="ac649-239">[application base] / [assembly name].dll</span></span>

- <span data-ttu-id="ac649-240">[базовая папка приложения] / [имя сборки] / [имя сборки].dll</span><span class="sxs-lookup"><span data-stu-id="ac649-240">[application base] / [assembly name] / [assembly name].dll</span></span>

<span data-ttu-id="ac649-241">Если указаны сведения о языке и региональных параметрах, проверяются только следующие каталоги:</span><span class="sxs-lookup"><span data-stu-id="ac649-241">If culture information is specified for the referenced assembly, only the following directories are probed:</span></span>

- <span data-ttu-id="ac649-242">[базовая папка приложения] / [язык и региональные параметры] / [имя сборки].dll</span><span class="sxs-lookup"><span data-stu-id="ac649-242">[application base] / [culture] / [assembly name].dll</span></span>

- <span data-ttu-id="ac649-243">[базовая папка приложения] / [язык и региональные параметры] / [имя сборки] / [имя сборки].dll</span><span class="sxs-lookup"><span data-stu-id="ac649-243">[application base] / [culture] / [assembly name] / [assembly name].dll</span></span>

#### <a name="probing-with-the-privatepath-attribute"></a><span data-ttu-id="ac649-244">Проверка с помощью атрибута privatePath</span><span class="sxs-lookup"><span data-stu-id="ac649-244">Probing with the privatePath Attribute</span></span>

<span data-ttu-id="ac649-245">Помимо подкаталогов языков и региональных параметров, а также подкаталогов, называемых по связанной сборке, среда выполнения проверяет каталоги, задаваемые с помощью атрибута `privatePath` элемента [\<probing>](../configure-apps/file-schema/runtime/probing-element.md).</span><span class="sxs-lookup"><span data-stu-id="ac649-245">In addition to the culture subdirectories and the subdirectories named for the referenced assembly, the runtime also probes directories specified using the `privatePath` attribute of the [\<probing>](../configure-apps/file-schema/runtime/probing-element.md) element.</span></span> <span data-ttu-id="ac649-246">Каталоги, заданные с помощью атрибута `privatePath` , должны быть подкаталогами корневого каталога приложения.</span><span class="sxs-lookup"><span data-stu-id="ac649-246">The directories specified using the `privatePath` attribute must be subdirectories of the application's root directory.</span></span> <span data-ttu-id="ac649-247">Проверяемые каталоги зависят от того, включены ли сведения о языке и региональных параметрах в запрос связанной сборки.</span><span class="sxs-lookup"><span data-stu-id="ac649-247">The directories probed vary depending on whether culture information is included in the referenced assembly request.</span></span>

<span data-ttu-id="ac649-248">Среда выполнения останавливает проверку при первом обнаружении сборки, у которой совпадает упоминаемое в ссылке простое имя сборки, независимо от того, является ли совпадение точным или нет.</span><span class="sxs-lookup"><span data-stu-id="ac649-248">The runtime stops probing the first time it finds an assembly that matches the simple assembly name referenced, whether it is a correct match or not.</span></span> <span data-ttu-id="ac649-249">Если совпадение точное, найденная сборка используется.</span><span class="sxs-lookup"><span data-stu-id="ac649-249">If it is a correct match, that assembly is used.</span></span> <span data-ttu-id="ac649-250">Если совпадение не является точным, проверка прекращается и происходит сбой привязки.</span><span class="sxs-lookup"><span data-stu-id="ac649-250">If it is not a correct match, probing stops and binding fails.</span></span>

<span data-ttu-id="ac649-251">Если язык и региональные параметры включены, проверяются следующие каталоги:</span><span class="sxs-lookup"><span data-stu-id="ac649-251">If culture is included, the following directories are probed:</span></span>

- <span data-ttu-id="ac649-252">[базовая папка приложения] / [binpath] / [язык и региональные параметры] / [имя сборки].dll</span><span class="sxs-lookup"><span data-stu-id="ac649-252">[application base] / [binpath] / [culture] / [assembly name].dll</span></span>

- <span data-ttu-id="ac649-253">[базовая папка приложения] / [binpath] / [язык и региональные параметры] / [имя сборки] / [имя сборки].dll</span><span class="sxs-lookup"><span data-stu-id="ac649-253">[application base] / [binpath] / [culture] / [assembly name] / [assembly name].dll</span></span>

<span data-ttu-id="ac649-254">Если язык и региональные параметры не включены, проверяются следующие каталоги:</span><span class="sxs-lookup"><span data-stu-id="ac649-254">If culture information is not included, the following directories are probed:</span></span>

- <span data-ttu-id="ac649-255">[базовая папка приложения] / [binpath] / [имя сборки].dll</span><span class="sxs-lookup"><span data-stu-id="ac649-255">[application base] / [binpath] / [assembly name].dll</span></span>

- <span data-ttu-id="ac649-256">[базовая папка приложения] / [binpath] / [имя сборки] / [имя сборки].dll</span><span class="sxs-lookup"><span data-stu-id="ac649-256">[application base] / [binpath] / [assembly name] / [assembly name].dll</span></span>

#### <a name="probing-examples"></a><span data-ttu-id="ac649-257">Примеры проверки</span><span class="sxs-lookup"><span data-stu-id="ac649-257">Probing Examples</span></span>

<span data-ttu-id="ac649-258">Заданы следующие сведения:</span><span class="sxs-lookup"><span data-stu-id="ac649-258">Given the following information:</span></span>

- <span data-ttu-id="ac649-259">Имя сборки, на которую указывает ссылка: myAssembly</span><span class="sxs-lookup"><span data-stu-id="ac649-259">Referenced assembly name: myAssembly</span></span>

- <span data-ttu-id="ac649-260">Корневой каталог приложения: `http://www.code.microsoft.com`</span><span class="sxs-lookup"><span data-stu-id="ac649-260">Application root directory: `http://www.code.microsoft.com`</span></span>

- <span data-ttu-id="ac649-261">Значение элемента [\<probing>](../configure-apps/file-schema/runtime/probing-element.md) в файле конфигурации: bin.</span><span class="sxs-lookup"><span data-stu-id="ac649-261">[\<probing>](../configure-apps/file-schema/runtime/probing-element.md) element in configuration file specifies: bin</span></span>

- <span data-ttu-id="ac649-262">Язык и региональные параметры: de</span><span class="sxs-lookup"><span data-stu-id="ac649-262">Culture: de</span></span>

<span data-ttu-id="ac649-263">Среда выполнения проверяет следующие URL-адреса:</span><span class="sxs-lookup"><span data-stu-id="ac649-263">The runtime probes the following URLs:</span></span>

- `http://www.code.microsoft.com/de/myAssembly.dll`

- `http://www.code.microsoft.com/de/myAssembly/myAssembly.dll`

- `http://www.code.microsoft.com/bin/de/myAssembly.dll`

- `http://www.code.microsoft.com/bin/de/myAssembly/myAssembly.dll`

##### <a name="multiple-assemblies-with-the-same-name"></a><span data-ttu-id="ac649-264">Несколько сборок с одинаковыми именами</span><span class="sxs-lookup"><span data-stu-id="ac649-264">Multiple Assemblies with the Same Name</span></span>

<span data-ttu-id="ac649-265">В примере ниже показано, как настроить несколько сборок с одинаковыми именами.</span><span class="sxs-lookup"><span data-stu-id="ac649-265">The following example shows how to configure multiple assemblies with the same name.</span></span>

```xml
<dependentAssembly>
   <assemblyIdentity name="Server" publicKeyToken="c0305c36380ba429" />
   <codeBase version="1.0.0.0" href="v1/Server.dll" />
   <codeBase version="2.0.0.0" href="v2/Server.dll" />
</dependentAssembly>
```

#### <a name="other-locations-probed"></a><span data-ttu-id="ac649-266">Другие проверяемые расположения</span><span class="sxs-lookup"><span data-stu-id="ac649-266">Other Locations Probed</span></span>

<span data-ttu-id="ac649-267">Расположение сборки также может быть установлено с помощью текущего контекста привязки.</span><span class="sxs-lookup"><span data-stu-id="ac649-267">Assembly location can also be determined using the current binding context.</span></span> <span data-ttu-id="ac649-268">Это часто происходит при использовании метода <xref:System.Reflection.Assembly.LoadFrom%2A?displayProperty=nameWithType> и в сценариях COM-взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="ac649-268">This most often occurs when the <xref:System.Reflection.Assembly.LoadFrom%2A?displayProperty=nameWithType> method is used and in COM interop scenarios.</span></span> <span data-ttu-id="ac649-269">Если сборка использует метод <xref:System.Reflection.Assembly.LoadFrom%2A> для ссылки на другую сборку, расположение вызывающей сборки считается подсказкой для поиска расположения сборки, на которую задана ссылка.</span><span class="sxs-lookup"><span data-stu-id="ac649-269">If an assembly uses the <xref:System.Reflection.Assembly.LoadFrom%2A> method to reference another assembly, the calling assembly's location is considered to be a hint about where to find the referenced assembly.</span></span> <span data-ttu-id="ac649-270">Если удается найти совпадение, эта сборка загружается.</span><span class="sxs-lookup"><span data-stu-id="ac649-270">If a match is found, that assembly is loaded.</span></span> <span data-ttu-id="ac649-271">Если совпадение не найдено, среда выполнения продолжает поиск в соответствии с семантикой, а затем запрашивает установщик Windows о предоставлении сборки.</span><span class="sxs-lookup"><span data-stu-id="ac649-271">If no match is found, the runtime continues with its search semantics and then queries the Windows Installer to provide the assembly.</span></span> <span data-ttu-id="ac649-272">Если не удается предоставить сборку, соответствующую запросу привязки, создается исключение.</span><span class="sxs-lookup"><span data-stu-id="ac649-272">If no assembly is provided that matches the binding request, an exception is thrown.</span></span> <span data-ttu-id="ac649-273">Это исключение <xref:System.TypeLoadException> в управляемом коде, если была задана ссылка на тип, или <xref:System.IO.FileNotFoundException> , если загружаемая сборка не найдена.</span><span class="sxs-lookup"><span data-stu-id="ac649-273">This exception is a <xref:System.TypeLoadException> in managed code if a type was referenced, or a <xref:System.IO.FileNotFoundException> if an assembly being loaded was not found.</span></span>

<span data-ttu-id="ac649-274">Например, если сборка Assembly1 ссылается на сборку Assembly2 и сборка Assembly1 была скачана с адреса `http://www.code.microsoft.com/utils`, это расположение считается подсказкой для поиска Assembly2.dll.</span><span class="sxs-lookup"><span data-stu-id="ac649-274">For example, if Assembly1 references Assembly2 and Assembly1 was downloaded from `http://www.code.microsoft.com/utils`, that location is considered to be a hint about where to find Assembly2.dll.</span></span> <span data-ttu-id="ac649-275">После этого среда выполнения проверяет наличие сборки в `http://www.code.microsoft.com/utils/Assembly2.dll` и `http://www.code.microsoft.com/utils/Assembly2/Assembly2.dll`.</span><span class="sxs-lookup"><span data-stu-id="ac649-275">The runtime then probes for the assembly in `http://www.code.microsoft.com/utils/Assembly2.dll` and `http://www.code.microsoft.com/utils/Assembly2/Assembly2.dll`.</span></span> <span data-ttu-id="ac649-276">Если сборка Assembly2 не обнаружена ни в одном из этих расположений, среда выполнения отправляет запрос установщику Windows.</span><span class="sxs-lookup"><span data-stu-id="ac649-276">If Assembly2 is not found at either of those locations, the runtime queries the Windows Installer.</span></span>

## <a name="see-also"></a><span data-ttu-id="ac649-277">См. также</span><span class="sxs-lookup"><span data-stu-id="ac649-277">See also</span></span>

- [<span data-ttu-id="ac649-278">Рекомендации для загрузки сборок</span><span class="sxs-lookup"><span data-stu-id="ac649-278">Best Practices for Assembly Loading</span></span>](best-practices-for-assembly-loading.md)
- [<span data-ttu-id="ac649-279">Развертывание</span><span class="sxs-lookup"><span data-stu-id="ac649-279">Deployment</span></span>](index.md)
