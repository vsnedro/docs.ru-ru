---
title: Диагностика транзакционных приложений
ms.date: 03/30/2017
ms.assetid: 4a993492-1088-4d10-871b-0c09916af05f
ms.openlocfilehash: 696ebe7249a8388eaaf38a678581e28d472e821a
ms.sourcegitcommit: bc293b14af795e0e999e3304dd40c0222cf2ffe4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/26/2020
ms.locfileid: "96290248"
---
# <a name="diagnosing-transactional-applications"></a>Диагностика транзакционных приложений

В этом разделе описывается использование компонента управления и диагностики Windows Communication Foundation (WCF) для устранения неполадок в транзакционном приложении.  
  
## <a name="performance-counters"></a>Счетчики производительности  

 WCF предоставляет стандартный набор счетчиков производительности для измерения производительности транзакционного приложения. Дополнительные сведения см. в статье [Performance Counters](../diagnostics/performance-counters/index.md).  
  
 Счетчики производительности группируются по трем различным уровням области действия: служба, конечная точка и операция, как описано в приведенных далее таблицах.  
  
### <a name="service-performance-counters"></a>Счетчики производительности службы  
  
|Счетчик производительности|Описание|  
|-------------------------|-----------------|  
|Количество поступивших транзакций|Количество транзакций в операциях для данной службы. Значение этого счетчика увеличивается каждый раз, когда в сообщении, отправленном в службу, имеется транзакция.|  
|Количество поступивших транзакций в секунду|Количество транзакций в операциях для данной службы за каждую секунду. Значение этого счетчика увеличивается каждый раз, когда в сообщении, отправленном в службу, имеется транзакция.|  
|Количество зафиксированных операций с поддержкой транзакций|Количество выполненных операций с поддержкой транзакций, транзакции которых были завершены с результатом, зафиксированным в этой службе. Работа, выполненная в таких операциях, полностью зафиксирована. Ресурсы обновлены в соответствии с работой, выполненной в операции.|  
|Количество зафиксированных операций с поддержкой транзакций в секунду|Количество выполненных операций с поддержкой транзакций, транзакции которых были завершены с результатом, зафиксированным в этой службе в течение каждой секунды. Работа, выполненная в таких операциях, полностью зафиксирована. Ресурсы обновлены в соответствии с работой, выполненной в операции.|  
|Количество прерванных операций с поддержкой транзакций|Количество выполненных операций с поддержкой транзакций, транзакции которых были завершены с прерыванием в этой службе. Для работы, выполненной в таких операциях, производится откат. Для ресурсов восстанавливается предыдущее состояние.|  
|Количество прерванных операций с поддержкой транзакций в секунду|Количество выполненных операций с поддержкой транзакций, транзакции которых были завершены прерыванием в этой службе в течение каждой секунды. Для работы, выполненной в таких операциях, производится откат. Для ресурсов восстанавливается предыдущее состояние.|  
|Количество операций с поддержкой транзакций с сомнительным результатом|Количество выполненных операций с поддержкой транзакций, транзакции которых были завершены с сомнительным результатом в этой службе. Работа, выполненная с результатом "сомнительно", находится в неопределенном состоянии. Ресурсы находятся в состоянии ожидания результата.|  
|Количество операций с поддержкой транзакций с сомнительным результатом в секунду|Количество выполненных операций с поддержкой транзакций, транзакции которых были завершены с результатом "сомнительно" в этой службе в течение каждой секунды. Работа, выполненная с результатом "сомнительно", находится в неопределенном состоянии. Ресурсы находятся в состоянии ожидания результата.|  
  
### <a name="endpoint-performance-counters"></a>Счетчики производительности конечных точек  
  
|Счетчик производительности|Описание|  
|-------------------------|-----------------|  
|Количество поступивших транзакций|Количество транзакций, поступивших в операции на этой конечной точке. Значение этого счетчика увеличивается каждый раз, когда в сообщении, отправленном на эту конечную точку, содержится транзакция.|  
|Количество поступивших транзакций в секунду|Количество транзакций в операциях для данной конечной точки за каждую секунду. Значение этого счетчика увеличивается каждый раз, когда в сообщении, отправленном на эту конечную точку, содержится транзакция.|  
  
### <a name="operation-performance-counters"></a>Счетчики производительности операций  
  
|Счетчик производительности|Описание|  
|-------------------------|-----------------|  
|Количество поступивших транзакций|Количество транзакций, поступивших в операции на этой конечной точке. Значение этого счетчика увеличивается каждый раз, когда в сообщении, отправленном на эту конечную точку, содержится транзакция.|  
|Количество поступивших транзакций в секунду|Количество транзакций в операциях для данной конечной точки за каждую секунду. Значение этого счетчика увеличивается каждый раз, когда в сообщении, отправленном на эту конечную точку, содержится транзакция.|  
  
## <a name="windows-management-instrumentation"></a>Инструментарий управления Windows (WMI)  

 WCF предоставляет данные проверки службы во время выполнения с помощью поставщика инструментарий управления Windows (WMI) WCF (WMI). Дополнительные сведения о доступе к данным WMI см. [в разделе использование инструментарий управления Windows (WMI) для диагностики](../diagnostics/wmi/index.md).  
  
 Ряд свойств WMI только для чтения показывает применяемые в службе параметры транзакции. В приведенных ниже таблицах перечислены эти параметры.  
  
 В службе атрибут `ServiceBehaviorAttribute` имеет следующие свойства.  
  
|Имя|Тип|Описание|  
|----------|----------|-----------------|  
|ReleaseServiceInstanceOnTransactionComplete|Логическое значение|Указывает, производится ли повторное использование объекта службы после завершения текущей транзакции.|  
|TransactionAutoCompleteOnSessionClose|Логическое значение|Указывает, завершаются ли ожидающие транзакции при закрытии текущего сеанса.|  
|TransactionIsolationLevel|Строка, содержащая допустимое значение перечисления <xref:System.Transactions.IsolationLevel>.|Задает уровень изоляции транзакции, поддерживаемый этой службой.|  
|TransactionTimeout|<xref:System.DateTime>|Задает период времени, в течение которого транзакция должна быть завершена.|  
  
 Атрибут `ServiceTimeoutsBehavior` имеет следующее свойство.  
  
|Имя|Тип|Описание|  
|----------|----------|-----------------|  
|TransactionTimeout|<xref:System.DateTime>|Задает период времени, в течение которого транзакция должна быть завершена.|  
  
 В привязке атрибут `TransactionFlowBindingElement` имеет следующие свойства.  
  
|Имя|Тип|Описание|  
|----------|----------|-----------------|  
|TransactionProtocol|Строка, содержащая допустимое значение типа <xref:System.ServiceModel.TransactionProtocol>.|Указывает протокол транзакций, используемый при передаче транзакций.|  
|TransactionFlow|Логическое значение|Задает, включен ли входящий поток транзакций.|  
  
 В операции атрибут `OperationBehaviorAttribute` имеет следующие свойства.  
  
|Имя|Тип|Описание|  
|----------|----------|-----------------|  
|TransactionAutoComplete|Логическое значение|Указывает, следует ли автоматически фиксировать текущую транзакцию при отсутствии необработанных исключений.|  
|TransactionScopeRequired|Логическое значение|Указывает, требует ли операция транзакции.|  
  
 В операции атрибут `TransactionFlowAttribute` имеет следующие свойства.  
  
|Имя|Тип|Описание|  
|----------|----------|-----------------|  
|TransactionFlowOption|Строка, содержащая допустимое значение перечисления <xref:System.ServiceModel.TransactionFlowOption>.|Задает область, к которой требуется поток транзакций.|  
  
## <a name="tracing"></a>Трассировка  

 Трассировка позволяет контролировать и анализировать ошибки в транзакционных приложениях. Трассировку можно включить следующими способами.  
  
- Стандартная трассировка WCF  
  
     Этот тип трассировки аналогичен трассировке любого приложения WCF. Для получения дополнительной информации см. [Configuring Tracing](../diagnostics/tracing/configuring-tracing.md).  
  
- Трассировка WS-AtomicTransaction  
  
     Трассировку WS-AtomicTransaction можно включить с помощью [служебной программы настройки WS-AtomicTransaction (wsatConfig.exe)](../ws-atomictransaction-configuration-utility-wsatconfig-exe.md). Такая трассировка позволяет контролировать состояние транзакций и участников внутри системы. Чтобы включить также и трассировку модели службы, можно задать для ключа реестра `HKLM\SOFTWARE\Microsoft\WSAT\3.0\ServiceModelDiagnosticTracing` допустимое значение перечисления <xref:System.Diagnostics.SourceLevels>. Ведение журнала сообщений можно включить точно так же, как и другие приложения WCF.  
  
- Трассировка `System.Transactions`  
  
     При использовании протокола OleTransactions возможна трассировка сообщений протокола. Поддержка трассировки, предоставляемая инфраструктурой <xref:System.Transactions> (которая использует протокол OleTransactions), позволяет пользователям просматривать события, происходящие с транзакциями. Чтобы включить трассировку для приложения <xref:System.Transactions>, поместите приведенный ниже код в файл конфигурации `App.config`.  
  
    ```xml  
    <configuration>  
      <system.diagnostics>  
         <sources>  
            <source name="System.Transactions" switchValue="Verbose, ActivityTracing">  
               <listeners>  
                  <add name="Text"  
                     type="System.Diagnostics.XmlWriterTraceListener"  
                     initializeData="SysTx.log"  
                     traceOutputOptions="Callstack" />  
               </listeners>  
            </source>  
         </sources>  
         <trace autoflush="true" indentsize="4">  
         </trace>  
      </system.diagnostics>  
    </configuration>  
    ```  
  
     Это также обеспечивает трассировку WCF, так как WCF также использует <xref:System.Transactions> инфраструктуру.  
  
## <a name="see-also"></a>См. также

- [Администрирование и диагностика](../diagnostics/index.md)
- [Настройка трассировки](../diagnostics/tracing/configuring-tracing.md)
- [Программа конфигурации WS-AtomicTransaction (wsatConfig.exe)](../ws-atomictransaction-configuration-utility-wsatconfig-exe.md)
