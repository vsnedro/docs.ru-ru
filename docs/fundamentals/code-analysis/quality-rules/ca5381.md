---
title: 'CA5381: Убедитесь, что сертификаты не добавлены в корневое хранилище (анализ кода)'
description: Содержит сведения о CA5381 правил анализа кода, включая причины, способы устранения нарушений и время их подавления.
ms.date: 08/14/2019
ms.topic: reference
author: filipsebesta
ms.author: filipse
dev_langs:
- CSharp
f1_keywords:
- CA5381
- DoNotInstallRootCert
ms.openlocfilehash: 992395d0424a120962fe3f76734b6a5731b9e618
ms.sourcegitcommit: 4df8e005c074ceb1f978f007b222fe253be2baf3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/04/2021
ms.locfileid: "99543661"
---
# <a name="ca5381-ensure-certificates-are-not-added-to-root-store"></a>CA5381. Убедиться, что сертификаты не добавлены в корневое хранилище

| | Значение |
|-|-|
| **Идентификатор правила** |CA5381|
| **Категория** |[Microsoft.Security](security-warnings.md)|
| **Исправление не критическое или не критическое** |Не критическое|

## <a name="cause"></a>Причина

Добавление сертификатов в Доверенные корневые сертификаты операционной системы повышает риск легитимизинг недоверенного центра сертификации.

По умолчанию это правило анализирует всю базу кода, но это можно [настроить](#configure-code-to-analyze).

## <a name="rule-description"></a>Описание правила

Это правило обнаруживает код, который потенциально добавляет сертификат в хранилище сертификатов доверенных корневых центров сертификации. По умолчанию хранилище сертификатов доверенных корневых центров сертификации настроено с набором общедоступных центров сертификации (ЦС), удовлетворяющих требованиям программы корневых сертификатов Майкрософт. Поскольку все доверенные корневые центры сертификации могут выдавать сертификаты для любого домена, злоумышленник может выбрать слабый или принудительно установленный ЦС, который вы установили самостоятельно для атаки, и один уязвимый, вредоносный или принудительный ЦС отменяет безопасность всей системы.

## <a name="how-to-fix-violations"></a>Устранение нарушений

Не устанавливайте сертификаты в хранилище сертификатов доверенных корневых центров сертификации.

## <a name="when-to-suppress-warnings"></a>Когда следует подавлять предупреждения

Не рекомендуется подавить это правило.

## <a name="configure-code-to-analyze"></a>Настройка анализируемого кода

Используйте следующие параметры, чтобы настроить, на какие части базы кода следует запускать это правило.

- [Исключить конкретные символы](#exclude-specific-symbols)
- [Исключить определенные типы и их производные типы](#exclude-specific-types-and-their-derived-types)

Эти параметры можно настроить только для этого правила, для всех правил или для всех правил в этой категории ([Безопасность](security-warnings.md)). Дополнительные сведения см. в разделе [Параметры конфигурации правила качества кода](../code-quality-rule-options.md).

[!INCLUDE[excluded-symbol-names](~/includes/code-analysis/excluded-symbol-names.md)]

[!INCLUDE[excluded-type-names-with-derived-types](~/includes/code-analysis/excluded-type-names-with-derived-types.md)]

## <a name="pseudo-code-examples"></a>Примеры псевдо-кода

### <a name="violation"></a>Нарушение

В следующем примере псевдо-кода показан шаблон, обнаруженный этим правилом.

```csharp
using System;
using System.Security.Cryptography.X509Certificates;

class TestClass
{
    public void TestMethod()
    {
        var storeName = StoreName.Root;
        Random r = new Random();

        if (r.Next(6) == 4)
        {
            storeName = StoreName.My;
        }

        var x509Store = new X509Store(storeName);
        x509Store.Add(new X509Certificate2());
    }
}
```

### <a name="solution"></a>Решение

```csharp
using System.Security.Cryptography.X509Certificates;

class TestClass
{
    public void TestMethod()
    {
        var storeName = StoreName.My;
        var x509Store = new X509Store(storeName);
        x509Store.Add(new X509Certificate2());
    }
}
```
