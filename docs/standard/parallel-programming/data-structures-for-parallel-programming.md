---
title: Структуры данных для параллельного программирования
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- data structures, multi-threading
ms.assetid: bdc82f2f-4754-45a1-a81e-fe2e9c30cef9
ms.openlocfilehash: cea9264a30469881e3ec54fc378af3ddb70bff8e
ms.sourcegitcommit: 6d09ae36acba0b0e2ba47999f8f1a725795462a2
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2020
ms.locfileid: "92925328"
---
# <a name="data-structures-for-parallel-programming"></a><span data-ttu-id="95d88-102">Структуры данных для параллельного программирования</span><span class="sxs-lookup"><span data-stu-id="95d88-102">Data Structures for Parallel Programming</span></span>

<span data-ttu-id="95d88-103">Платформа .NET предоставляет несколько типов для параллельного программирования, включая набор классов параллельных коллекций, упрощенные примитивы синхронизации и типы отложенной инициализации.</span><span class="sxs-lookup"><span data-stu-id="95d88-103">.NET provides several types that are useful in parallel programming, including a set of concurrent collection classes, lightweight synchronization primitives, and types for lazy initialization.</span></span> <span data-ttu-id="95d88-104">Эти типы можно использовать с любым кодом многопоточного приложения, включая библиотеку параллельных задач и PLINQ.</span><span class="sxs-lookup"><span data-stu-id="95d88-104">You can use these types with any multithreaded application code, including the Task Parallel Library and PLINQ.</span></span>  
  
## <a name="concurrent-collection-classes"></a><span data-ttu-id="95d88-105">Классы параллельных коллекций</span><span class="sxs-lookup"><span data-stu-id="95d88-105">Concurrent Collection Classes</span></span>  
 <span data-ttu-id="95d88-106">Классы коллекций в пространства имен <xref:System.Collections.Concurrent?displayProperty=nameWithType> поддерживают потокобезопасные операции добавления и удаления, которые избегают блокировок везде, где это возможно, и применяют только детально настроенные блокировки.</span><span class="sxs-lookup"><span data-stu-id="95d88-106">The collection classes in the <xref:System.Collections.Concurrent?displayProperty=nameWithType> namespace provide thread-safe add and remove operations that avoid locks wherever possible and use fine-grained locking where locks are necessary.</span></span> <span data-ttu-id="95d88-107">Класс параллельных коллекций не требует использовать блокировки в пользовательском коде для доступа к элементам.</span><span class="sxs-lookup"><span data-stu-id="95d88-107">A concurrent collection class does not require user code to take any locks when it accesses items.</span></span> <span data-ttu-id="95d88-108">Классы параллельных коллекций могут значительно повысить производительность по сравнению с типами <xref:System.Collections.ArrayList?displayProperty=nameWithType> и <xref:System.Collections.Generic.List%601?displayProperty=nameWithType> (где блокировка реализуется пользователем) в сценариях одновременного добавления и удаления элементов коллекции из нескольких потоков.</span><span class="sxs-lookup"><span data-stu-id="95d88-108">The concurrent collection classes can significantly improve performance over types such as <xref:System.Collections.ArrayList?displayProperty=nameWithType> and <xref:System.Collections.Generic.List%601?displayProperty=nameWithType> (with user-implemented locking) in scenarios where multiple threads add and remove items from a collection.</span></span>  
  
 <span data-ttu-id="95d88-109">В приведенной ниже таблице перечислены классы параллельных коллекций.</span><span class="sxs-lookup"><span data-stu-id="95d88-109">The following table lists the concurrent collection classes:</span></span>  
  
|<span data-ttu-id="95d88-110">Type</span><span class="sxs-lookup"><span data-stu-id="95d88-110">Type</span></span>|<span data-ttu-id="95d88-111">Описание:</span><span class="sxs-lookup"><span data-stu-id="95d88-111">Description</span></span>|  
|----------|-----------------|  
|<xref:System.Collections.Concurrent.BlockingCollection%601?displayProperty=nameWithType>|<span data-ttu-id="95d88-112">Предоставляет возможности блокировки и ограничения для потокобезопасных коллекций, реализующих <xref:System.Collections.Concurrent.IProducerConsumerCollection%601?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="95d88-112">Provides blocking and bounding capabilities for thread-safe collections that implement <xref:System.Collections.Concurrent.IProducerConsumerCollection%601?displayProperty=nameWithType>.</span></span> <span data-ttu-id="95d88-113">Потоки-производителя блокируются, если нет доступных слотов или коллекция заполнена.</span><span class="sxs-lookup"><span data-stu-id="95d88-113">Producer threads block if no slots are available or if the collection is full.</span></span> <span data-ttu-id="95d88-114">Потоки-потребители блокируются, если коллекция пуста.</span><span class="sxs-lookup"><span data-stu-id="95d88-114">Consumer threads block if the collection is empty.</span></span> <span data-ttu-id="95d88-115">Этот тип также поддерживает неблокирующий доступ для потребителей и производителей.</span><span class="sxs-lookup"><span data-stu-id="95d88-115">This type also supports non-blocking access by consumers and producers.</span></span> <span data-ttu-id="95d88-116"><xref:System.Collections.Concurrent.BlockingCollection%601> можно использовать в качестве базового класса или резервного хранилища с поддержкой блокировок и ограничений для любого класса коллекции с поддержкой <xref:System.Collections.Generic.IEnumerable%601>.</span><span class="sxs-lookup"><span data-stu-id="95d88-116"><xref:System.Collections.Concurrent.BlockingCollection%601> can be used as a base class or backing store to provide blocking and bounding for any collection class that supports <xref:System.Collections.Generic.IEnumerable%601>.</span></span>|  
|<xref:System.Collections.Concurrent.ConcurrentBag%601?displayProperty=nameWithType>|<span data-ttu-id="95d88-117">Потокобезопасная реализация контейнера, которая предоставляет масштабируемые операции добавления и получения.</span><span class="sxs-lookup"><span data-stu-id="95d88-117">A thread-safe bag implementation that provides scalable add and get operations.</span></span>|  
|<xref:System.Collections.Concurrent.ConcurrentDictionary%602?displayProperty=nameWithType>|<span data-ttu-id="95d88-118">Тип параллельного и масштабируемого словаря.</span><span class="sxs-lookup"><span data-stu-id="95d88-118">A concurrent and scalable dictionary type.</span></span>|  
|<xref:System.Collections.Concurrent.ConcurrentQueue%601?displayProperty=nameWithType>|<span data-ttu-id="95d88-119">Параллельная и масштабируемая очередь FIFO.</span><span class="sxs-lookup"><span data-stu-id="95d88-119">A concurrent and scalable FIFO queue.</span></span>|  
|<xref:System.Collections.Concurrent.ConcurrentStack%601?displayProperty=nameWithType>|<span data-ttu-id="95d88-120">Параллельный и масштабируемый стек LIFO.</span><span class="sxs-lookup"><span data-stu-id="95d88-120">A concurrent and scalable LIFO stack.</span></span>|  
  
 <span data-ttu-id="95d88-121">Дополнительные сведения см. в разделе [Потокобезопасные коллекции](../collections/thread-safe/index.md).</span><span class="sxs-lookup"><span data-stu-id="95d88-121">For more information, see [Thread-Safe Collections](../collections/thread-safe/index.md).</span></span>  
  
## <a name="synchronization-primitives"></a><span data-ttu-id="95d88-122">Примитивы синхронизации</span><span class="sxs-lookup"><span data-stu-id="95d88-122">Synchronization Primitives</span></span>  
 <span data-ttu-id="95d88-123">Примитивы синхронизации в пространстве имен <xref:System.Threading?displayProperty=nameWithType> обеспечивают детально настраиваемый параллелизм и более высокую производительность за счет устранения ресурсоемких механизмов блокировки из старого кода для многопоточной работы.</span><span class="sxs-lookup"><span data-stu-id="95d88-123">The synchronization primitives in the <xref:System.Threading?displayProperty=nameWithType> namespace enable fine-grained concurrency and faster performance by avoiding expensive locking mechanisms found in legacy multithreading code.</span></span>
  
 <span data-ttu-id="95d88-124">В приведенной ниже таблице перечислены типы синхронизации.</span><span class="sxs-lookup"><span data-stu-id="95d88-124">The following table lists the synchronization types:</span></span>  
  
|<span data-ttu-id="95d88-125">Тип</span><span class="sxs-lookup"><span data-stu-id="95d88-125">Type</span></span>|<span data-ttu-id="95d88-126">Описание</span><span class="sxs-lookup"><span data-stu-id="95d88-126">Description</span></span>|  
|----------|-----------------|  
|<xref:System.Threading.Barrier?displayProperty=nameWithType>|<span data-ttu-id="95d88-127">Позволяет нескольким потокам работать над выполнением алгоритма параллельно, поддерживая точку регистрации, в которой каждая задача отмечает свою доступность и ожидает новых задач.</span><span class="sxs-lookup"><span data-stu-id="95d88-127">Enables multiple threads to work on an algorithm in parallel by providing a point at which each task can signal its arrival and then block until some or all tasks have arrived.</span></span> <span data-ttu-id="95d88-128">Дополнительные сведения см. в разделе [Барьер](../threading/barrier.md).</span><span class="sxs-lookup"><span data-stu-id="95d88-128">For more information, see [Barrier](../threading/barrier.md).</span></span>|  
|<xref:System.Threading.CountdownEvent?displayProperty=nameWithType>|<span data-ttu-id="95d88-129">Упрощает сценарии ветвления и соединения, предоставляя удобный механизм взаимодействия.</span><span class="sxs-lookup"><span data-stu-id="95d88-129">Simplifies fork and join scenarios by providing an easy rendezvous mechanism.</span></span> <span data-ttu-id="95d88-130">Более подробную информацию можно найти в [описании события CountdownEvent](../threading/countdownevent.md).</span><span class="sxs-lookup"><span data-stu-id="95d88-130">For more information, see [CountdownEvent](../threading/countdownevent.md).</span></span>|  
|<xref:System.Threading.ManualResetEventSlim?displayProperty=nameWithType>|<span data-ttu-id="95d88-131">Примитив синхронизации, аналогичный <xref:System.Threading.ManualResetEvent?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="95d88-131">A synchronization primitive similar to <xref:System.Threading.ManualResetEvent?displayProperty=nameWithType>.</span></span> <span data-ttu-id="95d88-132"><xref:System.Threading.ManualResetEventSlim> менее требователен к ресурсам, но пригоден только для обмена данными внутри процесса.</span><span class="sxs-lookup"><span data-stu-id="95d88-132"><xref:System.Threading.ManualResetEventSlim> is lighter-weight but can only be used for intra-process communication.</span></span>|  
|<xref:System.Threading.SemaphoreSlim?displayProperty=nameWithType>|<span data-ttu-id="95d88-133">Примитив синхронизации, который ограничивает количество потоков, одновременно обращающихся к ресурсу или пулу ресурсов.</span><span class="sxs-lookup"><span data-stu-id="95d88-133">A synchronization primitive that limits the number of threads that can concurrently access a resource or a pool of resources.</span></span> <span data-ttu-id="95d88-134">Дополнительные сведения см. в [описании классов Semaphore и SemaphoreSlim](../threading/semaphore-and-semaphoreslim.md).</span><span class="sxs-lookup"><span data-stu-id="95d88-134">For more information, see [Semaphore and SemaphoreSlim](../threading/semaphore-and-semaphoreslim.md).</span></span>|  
|<xref:System.Threading.SpinLock?displayProperty=nameWithType>|<span data-ttu-id="95d88-135">Примитив взаимоисключающей блокировки, при использовании которого поток, который пытается получить блокировку, применяет *цикл ожидания* в течение заданного времени, прежде чем получить свою часть времени.</span><span class="sxs-lookup"><span data-stu-id="95d88-135">A mutual exclusion lock primitive that causes the thread that is trying to acquire the lock to wait in a loop, or *spin* , for a period of time before yielding its quantum.</span></span> <span data-ttu-id="95d88-136">В сценариях, где прогнозируется короткий период ожидания блокировки, <xref:System.Threading.SpinLock> обеспечит более высокую производительность по сравнению с другими формами блокировки.</span><span class="sxs-lookup"><span data-stu-id="95d88-136">In scenarios where the wait for the lock is expected to be short, <xref:System.Threading.SpinLock> offers better performance than other forms of locking.</span></span> <span data-ttu-id="95d88-137">Дополнительные сведения см. в [описании SpinLock](../threading/spinlock.md).</span><span class="sxs-lookup"><span data-stu-id="95d88-137">For more information, see [SpinLock](../threading/spinlock.md).</span></span>|  
|<xref:System.Threading.SpinWait?displayProperty=nameWithType>|<span data-ttu-id="95d88-138">Небольшой и нетребовательный к ресурсам тип, который реализует небольшую паузу, и только по истечении заданного времени переходит в состояние ожидания.</span><span class="sxs-lookup"><span data-stu-id="95d88-138">A small, lightweight type that will spin for a specified time and eventually put the thread into a wait state if the spin count is exceeded.</span></span>  <span data-ttu-id="95d88-139">Дополнительные сведения см. в [описании SpinWait](../threading/spinwait.md).</span><span class="sxs-lookup"><span data-stu-id="95d88-139">For more information, see [SpinWait](../threading/spinwait.md).</span></span>|  
  
 <span data-ttu-id="95d88-140">Дополнительные сведения см. в разделе:</span><span class="sxs-lookup"><span data-stu-id="95d88-140">For more information, see:</span></span>  
  
- [<span data-ttu-id="95d88-141">Практическое руководство. SpinLock и низкоуровневая синхронизация</span><span class="sxs-lookup"><span data-stu-id="95d88-141">How to: Use SpinLock for Low-Level Synchronization</span></span>](../threading/how-to-use-spinlock-for-low-level-synchronization.md)  
  
- <span data-ttu-id="95d88-142">[Практическое руководство. Синхронизация параллельных операций с барьером](../threading/how-to-synchronize-concurrent-operations-with-a-barrier.md).</span><span class="sxs-lookup"><span data-stu-id="95d88-142">[How to: Synchronize Concurrent Operations with a Barrier](../threading/how-to-synchronize-concurrent-operations-with-a-barrier.md).</span></span>  
  
## <a name="lazy-initialization-classes"></a><span data-ttu-id="95d88-143">Классы отложенной инициализации</span><span class="sxs-lookup"><span data-stu-id="95d88-143">Lazy Initialization Classes</span></span>  
 <span data-ttu-id="95d88-144">При использовании отложенной инициализации память выделяется объекту только в тот момент, когда она нужна.</span><span class="sxs-lookup"><span data-stu-id="95d88-144">With lazy initialization, the memory for an object is not allocated until it is needed.</span></span> <span data-ttu-id="95d88-145">Отложенная инициализация позволяет повысить производительность, равномерно распределяя процессы выделения объектов на вест период существования программы.</span><span class="sxs-lookup"><span data-stu-id="95d88-145">Lazy initialization can improve performance by spreading object allocations evenly across the lifetime of a program.</span></span> <span data-ttu-id="95d88-146">Чтобы включить отложенную инициализацию для любого пользовательского типа, упакуйте в него тип <xref:System.Lazy%601>.</span><span class="sxs-lookup"><span data-stu-id="95d88-146">You can enable lazy initialization for any custom type by wrapping the type <xref:System.Lazy%601>.</span></span>  
  
 <span data-ttu-id="95d88-147">В следующей таблице перечислены типы отложенной инициализации.</span><span class="sxs-lookup"><span data-stu-id="95d88-147">The following table lists the lazy initialization types:</span></span>  
  
|<span data-ttu-id="95d88-148">Тип</span><span class="sxs-lookup"><span data-stu-id="95d88-148">Type</span></span>|<span data-ttu-id="95d88-149">Описание</span><span class="sxs-lookup"><span data-stu-id="95d88-149">Description</span></span>|  
|----------|-----------------|  
|<xref:System.Lazy%601?displayProperty=nameWithType>|<span data-ttu-id="95d88-150">Легкая и потокобезопасная реализация отложенной инициализации.</span><span class="sxs-lookup"><span data-stu-id="95d88-150">Provides lightweight, thread-safe lazy-initialization.</span></span>|  
|<xref:System.Threading.ThreadLocal%601?displayProperty=nameWithType>|<span data-ttu-id="95d88-151">Предоставляет отложенно инициализированное значение для каждого потока, при этом каждый поток вызывает функцию отложенной инициализации.</span><span class="sxs-lookup"><span data-stu-id="95d88-151">Provides a lazily-initialized value on a per-thread basis, with each thread lazily-invoking the initialization function.</span></span>|  
|<xref:System.Threading.LazyInitializer?displayProperty=nameWithType>|<span data-ttu-id="95d88-152">Предоставляет статические методы, которые избавляют от необходимости выделять экземпляр отложенной инициализации.</span><span class="sxs-lookup"><span data-stu-id="95d88-152">Provides static methods that avoid the need to allocate a dedicated, lazy-initialization instance.</span></span> <span data-ttu-id="95d88-153">Вместо этого он использует ссылки, гарантирующие инициализацию целевых объектов при первом обращении к ним.</span><span class="sxs-lookup"><span data-stu-id="95d88-153">Instead, they use references to ensure targets have been initialized as they are accessed.</span></span>|  
  
 <span data-ttu-id="95d88-154">Дополнительные сведения см. в статье [Отложенная инициализация](../../framework/performance/lazy-initialization.md).</span><span class="sxs-lookup"><span data-stu-id="95d88-154">For more information, see [Lazy Initialization](../../framework/performance/lazy-initialization.md).</span></span>  
  
## <a name="aggregate-exceptions"></a><span data-ttu-id="95d88-155">Агрегатные исключения</span><span class="sxs-lookup"><span data-stu-id="95d88-155">Aggregate Exceptions</span></span>  
 <span data-ttu-id="95d88-156">Тип <xref:System.AggregateException?displayProperty=nameWithType> позволяет захватить несколько исключений, создаваемых одновременно в нескольких отдельных потоках, и передать их в присоединяемый поток в виде одного исключения.</span><span class="sxs-lookup"><span data-stu-id="95d88-156">The <xref:System.AggregateException?displayProperty=nameWithType> type can be used to capture multiple exceptions that are thrown concurrently on separate threads, and return them to the joining thread as a single exception.</span></span> <span data-ttu-id="95d88-157">Типы <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> и <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType>, а также PLINQ, широко используют для этой цели <xref:System.AggregateException>.</span><span class="sxs-lookup"><span data-stu-id="95d88-157">The <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType> types and PLINQ use <xref:System.AggregateException> extensively for this purpose.</span></span> <span data-ttu-id="95d88-158">Дополнительные сведения см. в статьях [Обработка исключений](exception-handling-task-parallel-library.md) и [Практическое руководство. Обработка исключений в запросах PLINQ](how-to-handle-exceptions-in-a-plinq-query.md).</span><span class="sxs-lookup"><span data-stu-id="95d88-158">For more information, see [Exception Handling](exception-handling-task-parallel-library.md) and [How to: Handle Exceptions in a PLINQ Query](how-to-handle-exceptions-in-a-plinq-query.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="95d88-159">См. также</span><span class="sxs-lookup"><span data-stu-id="95d88-159">See also</span></span>

- <xref:System.Collections.Concurrent?displayProperty=nameWithType>
- <xref:System.Threading?displayProperty=nameWithType>
- [<span data-ttu-id="95d88-160">Параллельное программирование</span><span class="sxs-lookup"><span data-stu-id="95d88-160">Parallel Programming</span></span>](index.md)
