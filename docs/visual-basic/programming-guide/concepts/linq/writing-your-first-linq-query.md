---
title: Написание первого запроса LINQ
ms.date: 07/20/2015
helpviewer_keywords:
- queries [LINQ in Visual Basic], writing
- LINQ queries [Visual Basic]
- LINQ [Visual Basic], writing queries
ms.assetid: 4affb732-3e9b-4479-aa31-1f9bd8183cbe
ms.openlocfilehash: 9d85f9c0390a659e59e372ad949cffdd17715189
ms.sourcegitcommit: f8c270376ed905f6a8896ce0fe25b4f4b38ff498
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/04/2020
ms.locfileid: "84413262"
---
# <a name="writing-your-first-linq-query-visual-basic"></a>Написание первого запроса LINQ (Visual Basic)
*Запрос* представляет собой выражение, извлекающее данные из источника данных. Запросы выражаются на языке выделенных запросов. Со временем разрабатываются разные языки для различных типов источников данных, например SQL для реляционных баз данных и XQuery для XML. Это позволяет разработчику приложения изучать новый язык запросов для каждого поддерживаемого типа источника данных или формата данных.  
  
 LINQ упрощает ситуацию, предлагая согласованную модель для работы с данными в различных видах источников данных и форматов. В запросе LINQ вы всегда работаете с объектами. Одни и те же базовые шаблоны кодирования используются для запроса и преобразования данных в XML-документах, базах данных SQL, ADO.NETх наборов данных и сущностях, .NET Framework коллекциях, а также в любом другом источнике или формате, для которого доступен поставщик LINQ. В этом документе описаны три фазы создания и использования базовых запросов LINQ.  
  
## <a name="three-stages-of-a-query-operation"></a>Три этапа операции запроса  
 Операции запросов LINQ состоят из трех действий:  
  
1. Получение источника данных или источников.  
  
2. создание запроса;  
  
3. выполнение запроса.  
  
 В LINQ выполнение запроса отличается от создания запроса. Данные не извлекаются просто путем создания запроса. Эта особенность обсуждается более подробно далее в этом разделе.  
  
 В следующем примере показаны три части операции запроса. В примере в качестве удобного источника данных для демонстрационных целей используется массив целых чисел. Тем не менее те же принципы применимы и к другим источникам данных.  
  
> [!NOTE]
> На [странице Компиляция в конструкторе проектов (Visual Basic)](/visualstudio/ide/reference/compile-page-project-designer-visual-basic)убедитесь, что **параметр Infer** имеет значение **On**.  
  
 [!code-vb[VbLINQFirstQuery#1](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbLINQFirstQuery/VB/Class1.vb#1)]  
  
 Выходные данные:  
  
 `0 2 4 6`  
  
## <a name="the-data-source"></a>Источник данных  
 Поскольку источник данных в предыдущем примере является массивом, он неявно поддерживает универсальный <xref:System.Collections.Generic.IEnumerable%601> интерфейс. Это тот факт, что позволяет использовать массив в качестве источника данных для запроса LINQ. Типы, которые поддерживают <xref:System.Collections.Generic.IEnumerable%601> или производный интерфейс, например универсальный интерфейс <xref:System.Linq.IQueryable%601>, называются *запрашиваемыми типами*.  
  
 В качестве неявного запрашиваемого типа массив не требует изменения или специальной обработки, чтобы служить источником данных LINQ. Это справедливо и для любого типа коллекции, который поддерживает <xref:System.Collections.Generic.IEnumerable%601> , включая универсальный <xref:System.Collections.Generic.List%601> класс, <xref:System.Collections.Generic.Dictionary%602> и другие классы в библиотеке классов .NET Framework.  
  
 Если исходные данные еще не реализованы <xref:System.Collections.Generic.IEnumerable%601> , поставщик LINQ необходим для реализации функциональности *стандартных операторов запросов* для этого источника данных. Например, [!INCLUDE[sqltecxlinq](~/includes/sqltecxlinq-md.md)] обрабатывает работу по загрузке XML-документа в запрашиваемый <xref:System.Xml.Linq.XElement> тип, как показано в следующем примере. Дополнительные сведения о стандартных операторах запросов см. в разделе [Общие сведения о стандартных операторах запросов (Visual Basic)](standard-query-operators-overview.md).  
  
 [!code-vb[VbLINQFirstQuery#2](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbLINQFirstQuery/VB/Class1.vb#2)]  
  
 С помощью [!INCLUDE[vbtecdlinq](~/includes/vbtecdlinq-md.md)] вы сначала создаете объектно-реляционное сопоставление во время разработки либо вручную, либо с помощью [средств LINQ to SQL в Visual Studio](/visualstudio/data-tools/linq-to-sql-tools-in-visual-studio2) в Visual Studio. Вы создаете запросы к объектам, а [!INCLUDE[vbtecdlinq](~/includes/vbtecdlinq-md.md)] во время выполнения обрабатывает взаимодействие с базой данных. В следующем примере `customers` представляет определенную таблицу в базе данных и <xref:System.Data.Linq.Table%601> поддерживает универсальный <xref:System.Linq.IQueryable%601> .  
  
```vb  
' Create a data source from a SQL table.  
Dim db As New DataContext("C:\Northwind\Northwnd.mdf")  
Dim customers As Table(Of Customer) = db.GetTable(Of Customer)  
```  
  
 Дополнительные сведения о способах создания определенных типов источников данных см. в документации для различных поставщиков LINQ. (Список этих поставщиков см. в разделе [LINQ (интегрированный в язык запрос)](index.md).) Простое правило: источник данных LINQ — это любой объект, который поддерживает универсальный <xref:System.Collections.Generic.IEnumerable%601> интерфейс, или интерфейс, наследующий от него.  
  
> [!NOTE]
> Типы, такие как <xref:System.Collections.ArrayList> , поддерживающие неуниверсальный <xref:System.Collections.IEnumerable> интерфейс, также можно использовать в качестве источников данных LINQ. Пример, в котором используется <xref:System.Collections.ArrayList> , см. [в разделе как выполнить запрос к ArrayList с помощью LINQ (Visual Basic)](how-to-query-an-arraylist-with-linq.md).  
  
## <a name="the-query"></a>Запрос  
 В запросе указывается, какие сведения необходимо получить из источника или из источников данных. Кроме того, можно указать способ сортировки, группировки или структурирования данных перед их возвратом. Чтобы включить создание запросов, Visual Basic включил в язык новый синтаксис запросов.  
  
 При выполнении запроса, приведенного в следующем примере, возвращаются все четные числа из массива целых чисел `numbers` .  
  
 [!code-vb[VbLINQFirstQuery#1](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbLINQFirstQuery/VB/Class1.vb#1)]  
  
 Выражение запроса содержит три предложения: `From` , `Where` и `Select` . Конкретная функция и назначение каждого предложения выражения запроса рассматриваются в разделе [основные операции запроса (Visual Basic)](basic-query-operations.md). Дополнительные сведения см. в разделе [запросы](../../../language-reference/queries/index.md). Обратите внимание, что в LINQ определение запроса часто хранится в переменной и выполняется позже. Переменная запроса, например `evensQuery` , в предыдущем примере, должна быть запрашиваемым типом. Тип `evensQuery` — `IEnumerable(Of Integer)` , назначенный компилятором с помощью определения локального типа.  
  
 Важно помнить, что сама переменная запроса не выполняет никаких действий и не возвращает никаких данных. Он сохраняет только определение запроса. В предыдущем примере это `For Each` цикл, выполняющий запрос.  
  
## <a name="query-execution"></a>Выполнение запроса  
 Выполнение запроса отделено от создания запроса. Создание запроса определяет запрос, но выполнение активируется другим механизмом. Запрос может быть выполнен, как только он определен (*немедленное выполнение*), либо можно сохранить определение, и запрос можно будет выполнить позже (*Отложенное выполнение*).  
  
### <a name="deferred-execution"></a>Отложенное выполнение  
 Типичный запрос LINQ напоминает тот, что был в предыдущем примере, в котором `evensQuery` определен. Он создает запрос, но не выполняет его немедленно. Вместо этого определение запроса хранится в переменной запроса `evensQuery` . Запрос выполняется позже, как правило, с помощью `For Each` цикла, который возвращает последовательность значений или применение стандартного оператора запроса, такого как `Count` или `Max` . Этот процесс называется *отложенным выполнением*.  
  
 [!code-vb[VbLINQFirstQuery#7](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbLINQFirstQuery/VB/Class1.vb#7)]  
  
 Для последовательности значений можно получить доступ к полученным данным с помощью переменной итерации в `For Each` цикле ( `number` в предыдущем примере). Так как переменная запроса, `evensQuery` содержит определение запроса, а не результаты запроса, можно выполнить запрос так часто, как требуется, используя переменную запроса более одного раза. Например, в приложении может быть база данных, которая постоянно обновляется отдельным приложением. После создания запроса, получающего данные из этой базы данных, можно использовать `For Each` цикл для многократного выполнения запроса, получая последние данные каждый раз.  
  
 В следующем примере показано, как работает отложенное выполнение. После `evensQuery2` определения и выполнения с помощью `For Each` цикла, как в предыдущих примерах, некоторые элементы в источнике данных `numbers` изменяются. Затем `For Each` снова запускается второй цикл `evensQuery2` . Результаты отличаются второй раз, так как `For Each` цикл выполняет запрос еще раз, используя новые значения в `numbers` .  
  
 [!code-vb[VbLINQFirstQuery#3](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbLINQFirstQuery/VB/Class1.vb#3)]  
  
 Выходные данные:  
  
 `Evens in original array:`  
  
 `0  2  4  6`  
  
 `Evens in changed array:`  
  
 `0  10  2  22  8`  
  
### <a name="immediate-execution"></a>Немедленное выполнение  
 При отложенном выполнении запросов определение запроса сохраняется в переменной запроса для последующего выполнения. При немедленном выполнении запрос выполняется во время его определения. Выполнение активируется при применении метода, который требует доступа к отдельным элементам результата запроса. Немедленное выполнение часто принудительно осуществляется с помощью одного из стандартных операторов запросов, возвращающих одиночные значения. Примеры: `Count` , `Max` , `Average` и `First` . Эти стандартные операторы запросов выполняют запрос сразу после применения, чтобы вычислить и вернуть одноэлементный результат. Дополнительные сведения о стандартных операторах запросов, возвращающих одиночные значения, см. в разделе [операции агрегирования](aggregation-operations.md), [операции с элементами](element-operations.md)и [Операции квантификаторов](quantifier-operations.md).  
  
 Следующий запрос возвращает число четных чисел в массиве целых чисел. Определение запроса не сохраняется и `numEvens` является простым `Integer` .  
  
 [!code-vb[VbLINQFirstQuery#4](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbLINQFirstQuery/VB/Class1.vb#4)]  
  
 Тот же результат можно получить с помощью `Aggregate` метода.  
  
 [!code-vb[VbLINQFirstQuery#5](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbLINQFirstQuery/VB/Class1.vb#5)]  
  
 Можно также принудительно выполнить запрос, вызвав `ToList` `ToArray` метод или для запроса (immediate) или переменной запроса (отложенной), как показано в следующем коде.  
  
 [!code-vb[VbLINQFirstQuery#6](~/samples/snippets/visualbasic/VS_Snippets_VBCSharp/VbLINQFirstQuery/VB/Class1.vb#6)]  
  
 В предыдущих примерах `evensQuery3` является переменной запроса, но `evensList` является списком и `evensArray` является массивом.  
  
 Использование `ToList` или `ToArray` для принудительного немедленного выполнения особенно полезно в сценариях, в которых необходимо немедленно выполнить запрос и кэшировать результаты в одном объекте коллекции. Дополнительные сведения об этих методах см. в разделе [Преобразование типов данных](converting-data-types.md).  
  
 Можно также вызвать выполнение запроса с помощью `IEnumerable` метода, такого как <xref:Microsoft.VisualBasic.Collection.System%23Collections%23IEnumerable%23GetEnumerator%2A> метод.  
  
## <a name="see-also"></a>См. также раздел

- [Приступая к работе с LINQ в Visual Basic](getting-started-with-linq.md)
- [Вывод локального типа](../../language-features/variables/local-type-inference.md)
- [Общие сведения о стандартных операторах запроса (Visual Basic)](standard-query-operators-overview.md)
- [Introduction to LINQ in Visual Basic](../../language-features/linq/introduction-to-linq.md) (Знакомство с LINQ в Visual Basic)
- [LINQ](../../language-features/linq/index.md)
- [Запросы](../../../language-reference/queries/index.md)
